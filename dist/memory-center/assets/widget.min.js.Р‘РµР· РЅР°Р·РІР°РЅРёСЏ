var ClbhObject=function(a,b,c){function d(a){var b=a.element,c=a.valueAccessor;return!!CBHCore.helpers.isFunction(c)&&(aa=new _({elemId:b,time:1e3*c(),template:"%minutes%:%seconds%:%ms%"}))}function e(a,b){if(window.location.hash){var c=window.location.hash.substring(1);"callbackhunter"===c&&setTimeout(function(){return f(a,b)}),"autocallback"!==c||CBHCore.cookies.get("hunter_autocallback")?CBHCore.logger.debug({message:"autoCallback failed, because cookie 'hunter_autocallback' is set!"}):(ma=!0,setTimeout(function(){return g(a,b)}))}}function f(a,b){window.location.hash="#callbackhunter-ok",b.showDialog(!0)}function g(a,b){if(ma){window.location.hash="#autocallback-ok";var c=CBHCore.params.mainSchedule,d=!1;if(ma=!1,CBHCore.cookies.set("hunter_autocallback","1",{expires:1}),void 0!==N.has_minutes&&(d=0!==parseInt(N.has_minutes,10)),!(a.hasCalls&&CBHCore.helpers.hasSubscription()&&c.isWorkTime()&&d))return void CBHCore.logger.debug({message:"autoCallback failed",hasCalls:a.hasCalls,hasSubscription:CBHCore.helpers.hasSubscription(),isWorkTime:c.isWorkTime(),hasMinutes:d});a.showReason(4),b.startCallback()}}function h(a){if(!CBHCore.extensionMode&&!H.disable_metrika_events){if(!H.yaMetrikaName)for(var b in window)if(window.hasOwnProperty(b)&&"string"==typeof b&&b.match(/^yaCounter\d+/)&&void 0!==window[b]&&window[b].reachGoal){H.yaMetrikaName=b;break}if(H.yaMetrikaName)try{window[H.yaMetrikaName].reachGoal(a)}catch(a){}}}function i(a,b,c,d){if(!CBHCore.extensionMode&&!H.disable_ga_events)if(void 0!==window.ga_cbh&&CBHCore.helpers.isFunction(window.ga_cbh)&&window.ga_cbh(a,b,c,d),CBHCore.helpers.isFunction(window.ga))try{for(var e=window.ga.getAll(),f=0;f<e.length;++f){var g=e[f];g.send(b,c,d)}}catch(a){}else if("object"===O(window._gaq)&&CBHCore.helpers.isFunction(window._gaq.push))try{window._gaq.push(["_trackEvent",c,d])}catch(a){}}function j(){na++,N.avg&&p()&&na>=parseInt(N.avg,10)-2&&(clearInterval(oa),ClbhObject.showWidgetExit())}function k(a,b){CBHCore.logger.debug(["sendMarketingEvent",a,b]),i("send","event",a,b),h(a)}function l(){CBHCore.CBHEvents.widgetOpened()}function m(a,b){var c=parseInt(N.popup_after,10),d=!1;if(void 0!==N.enable_popup_after&&(d=1===parseInt(N.enable_popup_after,10)),void 0!==N.show_enter&&(ja=1===parseInt(N.show_enter,10)),void 0!==N.show_exit&&(ka=1===parseInt(N.show_exit,10)),void 0!==N.min_popup_delay&&parseInt(N.min_popup_delay,10)>0){var f=Math.ceil((Number(new H.StrongDate)-CBHCore.storage.get("entrance_time","session"))/1e3);fa=parseInt(N.min_popup_delay,10)-f}d&&void 0!==N.popup_after&&c>0&&(ha=setTimeout(function(){b.showEnter()},1e3*c)),CBHCore.telemetry.on("inputFocus",function(){ea=!0}),void 0!==N.min_popup_delay&&parseInt(N.min_popup_delay,10)>0&&(fa=parseInt(N.min_popup_delay,10),CBHCore.logger.debug("min_popup_delay timer: "+fa+"s"),ga=setInterval(function(){--fa<=0&&(clearInterval(ga),CBHCore.logger.debug("min_popup_delay timer exhausted"))},1e3)),ja&&void 0!==N.min_popup_delay&&(ia=setTimeout(function(){clearTimeout(ia),b.showEnter()},1e3*(N.min_popup_delay+.3))),oa=setInterval(j,1e3),pa.blockAutoPopup=!CBHCore.helpers.checkIfCatchingAvailable(CBHCore.helpers.getWidgetMode()),a.sliderOpen.subscribe(function(){!1===a.sliderOpenedByDelay()&&o()}),ko.utils.registerEventHandler(window,"hashchange",function(){return e(a,b)}),ko.utils.registerEventHandler(window,"touchmove",la),ko.utils.registerEventHandler(window,"mousemove",la),e(a,b)}function n(){var a=CBHCore.helpers.getWidgetMode();"high"!==a&&(clearInterval(oa),o(),pa.blockAutoPopup=!0),CBHCore.helpers.setCatchingCookie(a)}function o(){clearInterval(ha),clearInterval(ia)}function p(){return!!ka&&(!!da&&(!ea&&(!pa.blockAutoPopup&&!(fa>0))))}function q(a){return{customGroup:a.customGroup||!1,pageId:a.pageId||null,pageLink:a.pageLink||null,chatLink:a.chatLink||null}}function r(){var a=CBHCore.db_params.gso_visitor_uid;return a?"VU_"+a:""}function s(){return"1"===CBHCore.db_params.is_amo_user}function t(a,b){function c(a){return CBHCore.storage.get(a,e)}function d(a,b){return CBHCore.storage.save(a,b,e)}var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"session";return{get:function(){return a.apply(void 0,Array.prototype.slice.call(arguments).concat([c]))},save:function(){return b.apply(void 0,Array.prototype.slice.call(arguments).concat([d]))}}}function u(a,b){return a.filter(function(a){return a.text&&a.text.length>0&&a.text.length<b})}function v(a,b){return b>0&&a[b].own===a[b-1].own}function w(a,b){return b<a.length-1&&a[b].own===a[b+1].own}function x(a){for(var b=null,c=a.sort(function(a,b){return a.ts-b.ts}).slice(),d=0;d<c.length;d++)d>0&&c[d].time()===c[d-1].time()&&c[d].own===c[d-1].own&&c[d-1].time(null),b&&b===c[d].day()?c[d].day(null):c[d].day()&&(b=c[d].day()),d===c.length-1?v(c,d)?c[d].position("last"):c[d].position("first"):v(c,d)?c[d].position("inner"):(c[d].position("first"),d>0&&"inner"===c[d-1].position()&&c[d-1].position("last"),w(c,d)||c[d].position("only"));return c}function y(a){a&&(a.scrollTop=a.scrollHeight)}function z(a,b){return a.length<2?a[0]:a[(a.indexOf(b)+1)%a.length]}function A(a,b){var c=parseInt(b(),10);return isNaN(c)?"auto":c+a+"px"}function B(a,b,c){var d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,e=null;try{return"insertRule"in a?e=a.insertRule(b+"{"+c+"}",d):"addRule"in a&&(e=a.addRule(b,c,d)),function(){"deleteRule"in a?a.deleteRule(e):"removeRule"in a&&a.removeRule(e)}}catch(a){}return function(){}}function C(a,b){var c=CBHCore.Masked;CBHCore.helpers.dontShowWidget()||CBHCore.db_params&&CBHCore.db_params.cbh_channels&&0===CBHCore.db_params.cbh_channels.length||(D(),c.phoneCodes.loadMasks("all",CBHCore.lang.langCode,function(){m(a,b),b.draw()}))}function D(){if(!H.disable_ga_events){if(void 0!==N.ga_disable&&1===parseInt(N.ga_disable,10))return!1;I=null,function(a,b,c,d,e,f,g){a.GoogleAnalyticsObject=e,a[e]=a[e]||function(){(a[e].q=a[e].q||[]).push(arguments)},a[e].l=Number(new Date),f=b.createElement(c),g=b.getElementsByTagName(c)[0],f.async=1,f.src="//www.google-analytics.com/analytics.js",g.parentNode.insertBefore(f,g)}(window,document,"script",0,"ga_cbh"),I=I||window.ga_cbh,I("create",CBHCore.opt.cbh_ga_id_v7||CBHCore.opt.cbh_ga_id,"callbackhunter.com"),I("send","pageview")}}function E(){ko.options.useOnlyNativeEvents=!0,ko.setTemplateEngine(new ko.nativeTemplateEngine)}var F,G,H={StrongDate:Date,vkAppId:"5854600",fbAppId:"100933113718536",fbPageId:"170295890097406",fbChatLink:"https://m.me/170295890097406/",vkGroupId:"132204360",vkChatLink:"https://vk.me/callbackhunterchat",tgDomain:"cbh7_bot",fbPageLink:"https://www.facebook.com/cbhmsgbot/",viberPA_URI:"Callbackhunter",skPageLink:"https://join.skype.com/bot/",disable_ga_events:!1,disable_metrika_events:!1,yaMetrikaName:null,socketIOLib:"https://cdn.callbackhunter.com/widgets/v9/socket.io-1.4.5.mod.js",socketIOEndpoint:{url:"https://n.callbackhunter.com",path:"/builtin/socket.io"},disableCustomColors:!1,fakeChatMessages:!1,bgCarrouselHostname:["callbackhunter.com","cbh8.ru"],bgCarrouselCount:17,bgCarrouselInterval:7e3,knownPhoneSliderShowDelay:3e3},I=function(){};!function(a,b){G=function(a){function b(){var a=navigator.userAgent;return a.search(/Edge/)>-1?"edge":a.search(/MSIE/)>-1?"ie":a.search(/Trident/)>-1?"ie11":a.search(/Firefox/)>-1?"firefox":a.search(/Opera/)>-1?"opera":a.search(/OPR/)>-1?"operaWebkit":a.search(/YaBrowser/)>-1?"yabrowser":a.search(/Chrome/)>-1?"chrome":a.search(/Safari/)>-1?"safari":a.search(/Maxthon/)>-1?"maxthon":"browser"}function c(a,b){var c=document.createElement("iframe");return c.src=b,c.id="hiddenIframe",c.style.display="none",a.appendChild(c),c}function d(a){navigator.msLaunchUri(a,function(){},function(){n(p.desktop)})}function e(){var a,b=-1,c=navigator.userAgent;return"Microsoft Internet Explorer"===navigator.appName?(a=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})"),null!==a.exec(c)&&(b=parseFloat(RegExp.$1))):"Netscape"===navigator.appName&&(a=new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})"),null!==a.exec(c)&&(b=parseFloat(RegExp.$1))),b}function f(a){10===e()?g(a):9===e()||11===e()?h(a):i(a)}function g(a){var b=setTimeout(function(){n(p.desktop)},1e3);window.addEventListener("blur",function(){clearTimeout(b)});var d=document.querySelector("#hiddenIframe");d||(d=c(document.body,"about:blank"));try{d.contentWindow.location.href=a}catch(a){n(p.desktop),clearTimeout(b)}}function h(a){function b(){clearTimeout(d),f.remove()}var d=setTimeout(function(){n(p.desktop),f.remove()},1e3),e=document.querySelector("#hiddenIframe");e||(e=c(document.body,"about:blank"));var f=l(window,"blur",b);e.contentWindow.location.href=a}function i(a){var b=window.open("","","width=0,height=0");b.document.write("<iframe src='"+a+"'></iframe>"),setTimeout(function(){try{b.location.href,b.setTimeout("window.close()",1e3)}catch(a){b.close(),n(p.desktop)}},1e3)}function j(a){var b=document.querySelector("#hiddenIframe");b||(b=c(document.body,"about:blank"));try{b.contentWindow.location.href=a}catch(a){"NS_ERROR_UNKNOWN_PROTOCOL"===a.name&&n(p.desktop)}}function k(a){for(var b=window;b!==b.parent;)b=b.parent;b.focus();var c,d;try{c=l(b,"blur",function(){clearTimeout(d),c.remove()})}catch(a){}c&&(d=setTimeout(function(){n(p.desktop),c.remove()},1e3)),s(a)}function l(a,b,c){return a.addEventListener?(a.addEventListener(b,c),{remove:function(){a.removeEventListener(b,c)}}):(a.attachEvent(b,c),{remove:function(){a.detachEvent(b,c)}})}function m(a){var b,c,d=CBHCore.helpers.parseUri(a),e=d.query,f=document.createElement("form");f.id="open-tab-fake-form",f.method="GET",f.action=a,f.target="_blank";for(var g in e)e.hasOwnProperty(g)&&(b=e[g],c=document.createElement("input"),c.setAttribute("type","hidden"),c.setAttribute("name",g),c.value=b,f.appendChild(c));return f}function n(a){if(a){var b=m(a);document.body.appendChild(b),b.submit(),void 0===Element.prototype.remove?document.body.removeChild(b):b.remove()}}if(a.document&&a.navigator){var o={windows:{},desktop:{},delay:1e3,delta:500},p={windows:{},desktop:""},q={windows:{store:{app:"ms-windows-store://pdp/?productid={id}",web:"https://www.microsoft.com/ru-ru/store/p/{name}/{id}"},test:/Windows\s+Phone|IEMobile/i}};Object.keys||(Object.keys=function(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(c);return b});var r=function(){for(var a in q)if(q.hasOwnProperty(a)&&navigator.userAgent.match(q[a].test))return a;return"desktop"},s=function(a){if(-1!==a.indexOf("http"))return void n(a);window.location.href=a},t=function(a,b){var c,d={};for(c in a)a.hasOwnProperty(c)&&(d[c]=a[c]);for(c in b)b.hasOwnProperty(c)&&(d[c]=b[c]);return d},u=function(){var a,b,c,d;for(a in o)if(o.hasOwnProperty(a)){b=o[a];var e=q[a];void 0!==e?(e=e.store,"object"==typeof b&&"object"==typeof e&&Object.keys(e).length>0&&(c=b.appId,d=b.appName,p[a].app=e.app.replace("{id}",c).replace("{name}",d),p[a].web=e.web.replace("{id}",c).replace("{name}",d))):"desktop"===a&&(p[a]=b.appUrl)}w()&&void 0!==o.windows.appId&&!1!==o.windows.appId&&(p.desktop=p.desktop.app)},v=function(){return"desktop"===r()},w=function(){var a=navigator.appVersion;return-1!==a.indexOf("Windows NT 6.2")||(-1!==a.indexOf("Windows NT 6.3")||-1!==a.indexOf("Windows NT 10.0"))},x=function(a){o=t(o,a),u()};return{setup:x,open:function(a,c){if(c&&x(c),v())if(navigator.msLaunchUri)d(a);else{var e=b();"firefox"===e?j(a):"chrome"===e||"yabrowser"===e||"opera"===e?k(a):"ie"===e?f(a):"safari"===e&&k(a)}return!0}}}}(a)}(window),function(){!function(a){var b=this||(0,eval)("this"),c=b.document,d=b.navigator,e=b.jQuery,f=b.JSON;!function(a){"function"==typeof F&&F.amd?F(["exports","require"],a):a(b.ko={})}(function(g,h){function i(a,b){return!!(null===a||typeof a in r)&&a===b}function j(b,c){var d;return function(){d||(d=q.utils.setTimeout(function(){d=a,b()},c))}}function k(a,b){var c;return function(){clearTimeout(c),c=q.utils.setTimeout(a,b)}}function l(a){var b=this;return a&&q.utils.objectForEach(a,function(a,c){var d=q.extenders[a];"function"==typeof d&&(b=d(b,c)||b)}),b}function m(a,b){b&&b!==s?"beforeChange"===b?this._limitBeforeChange(a):this._origNotifySubscribers(a,b):this._limitChange(a)}function n(a,b){null!==b&&b.dispose&&b.dispose()}function o(a,b){var c=this.computedObservable,d=c[y];d.isDisposed||(this.disposalCount&&this.disposalCandidates[b]?(c.addDependencyTracking(b,a,this.disposalCandidates[b]),this.disposalCandidates[b]=null,--this.disposalCount):d.dependencyTracking[b]||c.addDependencyTracking(b,a,d.isSleeping?{_target:a}:c.subscribeToDependency(a)))}function p(a,b,c,d){q.bindingHandlers[a]={init:function(a,e,f,g,h){var i,j;return q.computed(function(){var f=q.utils.unwrapObservable(e()),g=!c!=!f,k=!j;(k||b||g!==i)&&(k&&q.computedContext.getDependenciesCount()&&(j=q.utils.cloneNodes(q.virtualElements.childNodes(a),!0)),g?(k||q.virtualElements.setDomNodeChildren(a,q.utils.cloneNodes(j)),q.applyBindingsToDescendants(d?d(h,f):h,a)):q.virtualElements.emptyNode(a),i=g)},null,{disposeWhenNodeIsRemoved:a}),{controlsDescendantBindings:!0}}},q.expressionRewriting.bindingRewriteValidators[a]=!1,q.virtualElements.allowedBindings[a]=!0}var q=void 0!==g?g:{};q.exportSymbol=function(a,b){for(var c=a.split("."),d=q,e=0;e<c.length-1;e++)d=d[c[e]];d[c[c.length-1]]=b},q.exportProperty=function(a,b,c){a[b]=c},q.version="3.4.0",q.exportSymbol("version",q.version),q.options={deferUpdates:!1,useOnlyNativeEvents:!1},q.utils=function(){function g(a,b){for(var c in a)a.hasOwnProperty(c)&&b(c,a[c])}function h(a,b){if(b)for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a}function i(a,b){return a.__proto__=b,a}function j(a,b){if("input"!==q.utils.tagNameLower(a)||!a.type)return!1;if("click"!=b.toLowerCase())return!1;var c=a.type;return"checkbox"==c||"radio"==c}function k(a,b,c){var d;b&&("object"==typeof a.classList?(d=a.classList[c?"add":"remove"],q.utils.arrayForEach(b.match(v),function(b){d.call(a.classList,b)})):"string"==typeof a.className.baseVal?l(a.className,"baseVal",b,c):l(a,"className",b,c))}function l(a,b,c,d){var e=a[b].match(v)||[];q.utils.arrayForEach(c.match(v),function(a){q.utils.addOrRemoveItem(e,a,d)}),a[b]=e.join(" ")}var m={__proto__:[]}instanceof Array,n="function"==typeof Symbol,o={},p={};o[d&&/Firefox\/2/i.test(d.userAgent)?"KeyboardEvent":"UIEvents"]=["keyup","keydown","keypress"],o.MouseEvents=["click","dblclick","mousedown","mouseup","mousemove","mouseover","mouseout","mouseenter","mouseleave"],g(o,function(a,b){if(b.length)for(var c=0,d=b.length;c<d;c++)p[b[c]]=a});var r={propertychange:!0},s=c&&function(){for(var b=3,d=c.createElement("div"),e=d.getElementsByTagName("i");d.innerHTML="\x3c!--[if gt IE "+ ++b+"]><i></i><![endif]--\x3e",e[0];);return b>4?b:a}(),t=6===s,u=7===s,v=/\S+/g;return{fieldsIncludedWithJsonPost:["authenticity_token",/^__RequestVerificationToken(_.*)?$/],arrayForEach:function(a,b){for(var c=0,d=a.length;c<d;c++)b(a[c],c)},arrayIndexOf:function(a,b){if("function"==typeof Array.prototype.indexOf)return Array.prototype.indexOf.call(a,b);for(var c=0,d=a.length;c<d;c++)if(a[c]===b)return c;return-1},arrayFirst:function(a,b,c){for(var d=0,e=a.length;d<e;d++)if(b.call(c,a[d],d))return a[d];return null},arrayRemoveItem:function(a,b){var c=q.utils.arrayIndexOf(a,b);c>0?a.splice(c,1):0===c&&a.shift()},arrayGetDistinctValues:function(a){a=a||[];for(var b=[],c=0,d=a.length;c<d;c++)q.utils.arrayIndexOf(b,a[c])<0&&b.push(a[c]);return b},arrayMap:function(a,b){a=a||[];for(var c=[],d=0,e=a.length;d<e;d++)c.push(b(a[d],d));return c},arrayFilter:function(a,b){a=a||[];for(var c=[],d=0,e=a.length;d<e;d++)b(a[d],d)&&c.push(a[d]);return c},arrayPushAll:function(a,b){if(b instanceof Array)a.push.apply(a,b);else for(var c=0,d=b.length;c<d;c++)a.push(b[c]);return a},addOrRemoveItem:function(a,b,c){var d=q.utils.arrayIndexOf(q.utils.peekObservable(a),b);d<0?c&&a.push(b):c||a.splice(d,1)},canSetPrototype:m,extend:h,setPrototypeOf:i,setPrototypeOfOrExtend:m?i:h,objectForEach:g,objectMap:function(a,b){if(!a)return a;var c={};for(var d in a)a.hasOwnProperty(d)&&(c[d]=b(a[d],d,a));return c},emptyDomNode:function(a){for(;a.firstChild;)q.removeNode(a.firstChild)},moveCleanedNodesToContainerElement:function(a){for(var b=q.utils.makeArray(a),d=b[0]&&b[0].ownerDocument||c,e=d.createElement("div"),f=0,g=b.length;f<g;f++)e.appendChild(q.cleanNode(b[f]));return e},cloneNodes:function(a,b){for(var c=0,d=a.length,e=[];c<d;c++){var f=a[c].cloneNode(!0);e.push(b?q.cleanNode(f):f)}return e},setDomNodeChildren:function(a,b){if(q.utils.emptyDomNode(a),b)for(var c=0,d=b.length;c<d;c++)a.appendChild(b[c])},replaceDomNodes:function(a,b){var c=a.nodeType?[a]:a;if(c.length>0){for(var d=c[0],e=d.parentNode,f=0,g=b.length;f<g;f++)e.insertBefore(b[f],d);for(var f=0,g=c.length;f<g;f++)q.removeNode(c[f])}},fixUpContinuousNodeArray:function(a,b){if(a.length){for(b=8===b.nodeType&&b.parentNode||b;a.length&&a[0].parentNode!==b;)a.splice(0,1);for(;a.length>1&&a[a.length-1].parentNode!==b;)a.length--;if(a.length>1){var c=a[0],d=a[a.length-1];for(a.length=0;c!==d;)a.push(c),c=c.nextSibling;a.push(d)}}return a},setOptionNodeSelectionState:function(a,b){s<7?a.setAttribute("selected",b):a.selected=b},stringTrim:function(b){return null===b||b===a?"":b.trim?b.trim():b.toString().replace(/^[\s\xa0]+|[\s\xa0]+$/g,"")},stringStartsWith:function(a,b){return a=a||"",!(b.length>a.length)&&a.substring(0,b.length)===b},domNodeIsContainedBy:function(a,b){if(a===b)return!0;if(11===a.nodeType)return!1;if(b.contains)return b.contains(3===a.nodeType?a.parentNode:a);if(b.compareDocumentPosition)return 16==(16&b.compareDocumentPosition(a));for(;a&&a!=b;)a=a.parentNode;return!!a},domNodeIsAttachedToDocument:function(a){return q.utils.domNodeIsContainedBy(a,a.ownerDocument.documentElement)},anyDomNodeIsAttachedToDocument:function(a){return!!q.utils.arrayFirst(a,q.utils.domNodeIsAttachedToDocument)},tagNameLower:function(a){return a&&a.tagName&&a.tagName.toLowerCase()},catchFunctionErrors:function(a){return q.onError?function(){try{return a.apply(this,arguments)}catch(a){throw q.onError&&q.onError(a),a}}:a},setTimeout:function(a,b){return setTimeout(q.utils.catchFunctionErrors(a),b)},deferError:function(a){setTimeout(function(){throw q.onError&&q.onError(a),a},0)},registerEventHandler:function(a,b,c){var d=q.utils.catchFunctionErrors(c),f=s&&r[b];if(q.options.useOnlyNativeEvents||f||!e)if(f||"function"!=typeof a.addEventListener){if(void 0===a.attachEvent)throw new Error("Browser doesn't support addEventListener or attachEvent");var g=function(b){d.call(a,b)},h="on"+b;a.attachEvent(h,g),q.utils.domNodeDisposal.addDisposeCallback(a,function(){a.detachEvent(h,g)})}else a.addEventListener(b,d,!1);else e(a).bind(b,d)},triggerEvent:function(a,d){if(!a||!a.nodeType)throw new Error("element must be a DOM node when calling triggerEvent");var f=j(a,d);if(q.options.useOnlyNativeEvents||!e||f)if("function"==typeof c.createEvent){if("function"!=typeof a.dispatchEvent)throw new Error("The supplied element doesn't support dispatchEvent");var g=p[d]||"HTMLEvents",h=c.createEvent(g);h.initEvent(d,!0,!0,b,0,0,0,0,0,!1,!1,!1,!1,0,a),a.dispatchEvent(h)}else if(f&&a.click)a.click();else{if(void 0===a.fireEvent)throw new Error("Browser doesn't support triggering events");a.fireEvent("on"+d)}else e(a).trigger(d)},unwrapObservable:function(a){return q.isObservable(a)?a():a},peekObservable:function(a){return q.isObservable(a)?a.peek():a},toggleDomNodeCssClass:k,setTextContent:function(b,c){var d=q.utils.unwrapObservable(c);null!==d&&d!==a||(d="");var e=q.virtualElements.firstChild(b);!e||3!=e.nodeType||q.virtualElements.nextSibling(e)?q.virtualElements.setDomNodeChildren(b,[b.ownerDocument.createTextNode(d)]):e.data=d,q.utils.forceRefresh(b)},setElementName:function(a,b){if(a.name=b,s<=7)try{a.mergeAttributes(c.createElement("<input name='"+a.name+"'/>"),!1)}catch(a){}},forceRefresh:function(a){if(s>=9){var b=1==a.nodeType?a:a.parentNode;b.style&&(b.style.zoom=b.style.zoom)}},ensureSelectElementIsRenderedCorrectly:function(a){if(s){var b=a.style.width;a.style.width=0,a.style.width=b}},range:function(a,b){a=q.utils.unwrapObservable(a),b=q.utils.unwrapObservable(b);for(var c=[],d=a;d<=b;d++)c.push(d);return c},makeArray:function(a){for(var b=[],c=0,d=a.length;c<d;c++)b.push(a[c]);return b},createSymbolOrString:function(a){return n?Symbol(a):a},isIe6:t,isIe7:u,ieVersion:s,getFormFields:function(a,b){for(var c=q.utils.makeArray(a.getElementsByTagName("input")).concat(q.utils.makeArray(a.getElementsByTagName("textarea"))),d="string"==typeof b?function(a){return a.name===b}:function(a){return b.test(a.name)},e=[],f=c.length-1;f>=0;f--)d(c[f])&&e.push(c[f]);return e},parseJson:function(a){return"string"==typeof a&&(a=q.utils.stringTrim(a))?f&&f.parse?f.parse(a):new Function("return "+a)():null},stringifyJson:function(a,b,c){if(!f||!f.stringify)throw new Error("Cannot find JSON.stringify(). Some browsers (e.g., IE < 8) don't support it natively, but you can overcome this by adding a script reference to json2.js, downloadable from http://www.json.org/json2.js");return f.stringify(q.utils.unwrapObservable(a),b,c)},postJson:function(a,b,d){d=d||{};var e=d.params||{},f=d.includeFields||this.fieldsIncludedWithJsonPost,h=a;if("object"==typeof a&&"form"===q.utils.tagNameLower(a)){var i=a;h=i.action;for(var j=f.length-1;j>=0;j--)for(var k=q.utils.getFormFields(i,f[j]),l=k.length-1;l>=0;l--)e[k[l].name]=k[l].value}b=q.utils.unwrapObservable(b);var m=c.createElement("form");m.style.display="none",m.action=h,m.method="post";for(var n in b){var o=c.createElement("input");o.type="hidden",o.name=n,o.value=q.utils.stringifyJson(q.utils.unwrapObservable(b[n])),m.appendChild(o)}g(e,function(a,b){var d=c.createElement("input");d.type="hidden",d.name=a,d.value=b,m.appendChild(d)}),c.body.appendChild(m),d.submitter?d.submitter(m):m.submit(),setTimeout(function(){m.parentNode.removeChild(m)},0)}}}(),q.exportSymbol("utils",q.utils),q.exportSymbol("utils.arrayForEach",q.utils.arrayForEach),q.exportSymbol("utils.arrayFirst",q.utils.arrayFirst),q.exportSymbol("utils.arrayFilter",q.utils.arrayFilter),q.exportSymbol("utils.arrayGetDistinctValues",q.utils.arrayGetDistinctValues),q.exportSymbol("utils.arrayIndexOf",q.utils.arrayIndexOf),q.exportSymbol("utils.arrayMap",q.utils.arrayMap),q.exportSymbol("utils.arrayPushAll",q.utils.arrayPushAll),q.exportSymbol("utils.arrayRemoveItem",q.utils.arrayRemoveItem),q.exportSymbol("utils.extend",q.utils.extend),q.exportSymbol("utils.fieldsIncludedWithJsonPost",q.utils.fieldsIncludedWithJsonPost),q.exportSymbol("utils.getFormFields",q.utils.getFormFields),q.exportSymbol("utils.peekObservable",q.utils.peekObservable),q.exportSymbol("utils.postJson",q.utils.postJson),q.exportSymbol("utils.parseJson",q.utils.parseJson),q.exportSymbol("utils.registerEventHandler",q.utils.registerEventHandler),q.exportSymbol("utils.stringifyJson",q.utils.stringifyJson),q.exportSymbol("utils.range",q.utils.range),q.exportSymbol("utils.toggleDomNodeCssClass",q.utils.toggleDomNodeCssClass),q.exportSymbol("utils.triggerEvent",q.utils.triggerEvent),q.exportSymbol("utils.unwrapObservable",q.utils.unwrapObservable),q.exportSymbol("utils.objectForEach",q.utils.objectForEach),q.exportSymbol("utils.addOrRemoveItem",q.utils.addOrRemoveItem),q.exportSymbol("utils.setTextContent",q.utils.setTextContent),q.exportSymbol("unwrap",q.utils.unwrapObservable),Function.prototype.bind||(Function.prototype.bind=function(a){var b=this;if(1===arguments.length)return function(){return b.apply(a,arguments)};var c=Array.prototype.slice.call(arguments,1);return function(){var d=c.slice(0);return d.push.apply(d,arguments),b.apply(a,d)}}),q.utils.domData=new function(){function b(b,f){var g=b[d];if(!g||"null"===g||!e[g]){if(!f)return a;g=b[d]="ko"+c++,e[g]={}}return e[g]}var c=0,d="__ko__"+(new Date).getTime(),e={};return{get:function(c,d){var e=b(c,!1);return e===a?a:e[d]},set:function(c,d,e){if(e!==a||b(c,!1)!==a){b(c,!0)[d]=e}},clear:function(a){var b=a[d];return!!b&&(delete e[b],a[d]=null,!0)},nextKey:function(){return c+++d}}},q.exportSymbol("utils.domData",q.utils.domData),q.exportSymbol("utils.domData.clear",q.utils.domData.clear),q.utils.domNodeDisposal=new function(){function b(b,c){var d=q.utils.domData.get(b,g);return d===a&&c&&(d=[],q.utils.domData.set(b,g,d)),d}function c(b){q.utils.domData.set(b,g,a)}function d(a){var c=b(a,!1);if(c){c=c.slice(0);for(var d=0;d<c.length;d++)c[d](a)}q.utils.domData.clear(a),q.utils.domNodeDisposal.cleanExternalData(a),i[a.nodeType]&&f(a)}function f(a){for(var b,c=a.firstChild;b=c;)c=b.nextSibling,8===b.nodeType&&d(b)}var g=q.utils.domData.nextKey(),h={1:!0,8:!0,9:!0},i={1:!0,9:!0};return{addDisposeCallback:function(a,c){if("function"!=typeof c)throw new Error("Callback must be a function");b(a,!0).push(c)},removeDisposeCallback:function(a,d){var e=b(a,!1);e&&(q.utils.arrayRemoveItem(e,d),0==e.length&&c(a))},cleanNode:function(a){if(h[a.nodeType]&&(d(a),i[a.nodeType])){var b=[];q.utils.arrayPushAll(b,a.getElementsByTagName("*"));for(var c=0,e=b.length;c<e;c++)d(b[c])}return a},removeNode:function(a){q.cleanNode(a),a.parentNode&&a.parentNode.removeChild(a)},cleanExternalData:function(a){e&&"function"==typeof e.cleanData&&e.cleanData([a])}}},q.cleanNode=q.utils.domNodeDisposal.cleanNode,q.removeNode=q.utils.domNodeDisposal.removeNode,q.exportSymbol("cleanNode",q.cleanNode),q.exportSymbol("removeNode",q.removeNode),q.exportSymbol("utils.domNodeDisposal",q.utils.domNodeDisposal),q.exportSymbol("utils.domNodeDisposal.addDisposeCallback",q.utils.domNodeDisposal.addDisposeCallback),q.exportSymbol("utils.domNodeDisposal.removeDisposeCallback",q.utils.domNodeDisposal.removeDisposeCallback),function(){function d(a){var b=a.match(/^<([a-z]+)[ >]/);return b&&m[b[1]]||h}function f(a,e){e||(e=c);var f=e.parentWindow||e.defaultView||b,g=q.utils.stringTrim(a).toLowerCase(),h=e.createElement("div"),i=d(g),j=i[0],k="ignored<div>"+i[1]+a+i[2]+"</div>";for("function"==typeof f.innerShiv?h.appendChild(f.innerShiv(k)):(n&&e.appendChild(h),h.innerHTML=k,n&&h.parentNode.removeChild(h));j--;)h=h.lastChild;return q.utils.makeArray(h.lastChild.childNodes)}function g(a,b){if(e.parseHTML)return e.parseHTML(a,b)||[];var c=e.clean([a],b);if(c&&c[0]){for(var d=c[0];d.parentNode&&11!==d.parentNode.nodeType;)d=d.parentNode;d.parentNode&&d.parentNode.removeChild(d)}return c}var h=[0,"",""],i=[1,"<table>","</table>"],j=[2,"<table><tbody>","</tbody></table>"],k=[3,"<table><tbody><tr>","</tr></tbody></table>"],l=[1,"<select multiple='multiple'>","</select>"],m={thead:i,tbody:i,tfoot:i,tr:j,td:k,th:k,option:l,optgroup:l},n=q.utils.ieVersion<=8;q.utils.parseHtmlFragment=function(a,b){return e&&e.parseHTML?g(a,b):f(a,b)},q.utils.setHtml=function(b,c){if(q.utils.emptyDomNode(b),null!==(c=q.utils.unwrapObservable(c))&&c!==a)if("string"!=typeof c&&(c=c.toString()),e)e(b).html(c);else for(var d=q.utils.parseHtmlFragment(c,b.ownerDocument),f=0;f<d.length;f++)b.appendChild(d[f])}}(),q.exportSymbol("utils.parseHtmlFragment",q.utils.parseHtmlFragment),q.exportSymbol("utils.setHtml",q.utils.setHtml),q.memoization=function(){function b(){return(4294967296*(1+Math.random())|0).toString(16).substring(1)}function c(){return b()+b()}function d(a,b){if(a)if(8==a.nodeType){var c=q.memoization.parseMemoText(a.nodeValue);null!=c&&b.push({domNode:a,memoId:c})}else if(1==a.nodeType)for(var e=0,f=a.childNodes,g=f.length;e<g;e++)d(f[e],b)}var e={};return{memoize:function(a){if("function"!=typeof a)throw new Error("You can only pass a function to ko.memoization.memoize()");var b=c();return e[b]=a,"\x3c!--[ko_memo:"+b+"]--\x3e"},unmemoize:function(b,c){var d=e[b];if(d===a)throw new Error("Couldn't find any memo with ID "+b+". Perhaps it's already been unmemoized.");try{return d.apply(null,c||[]),!0}finally{delete e[b]}},unmemoizeDomNodeAndDescendants:function(a,b){var c=[];d(a,c);for(var e=0,f=c.length;e<f;e++){var g=c[e].domNode,h=[g];b&&q.utils.arrayPushAll(h,b),q.memoization.unmemoize(c[e].memoId,h),g.nodeValue="",g.parentNode&&g.parentNode.removeChild(g)}},parseMemoText:function(a){var b=a.match(/^\[ko_memo\:(.*?)\]$/);return b?b[1]:null}}}(),q.exportSymbol("memoization",q.memoization),q.exportSymbol("memoization.memoize",q.memoization.memoize),q.exportSymbol("memoization.unmemoize",q.memoization.unmemoize),q.exportSymbol("memoization.parseMemoText",q.memoization.parseMemoText),q.exportSymbol("memoization.unmemoizeDomNodeAndDescendants",q.memoization.unmemoizeDomNodeAndDescendants),q.tasks=function(){function a(){if(h)for(var a,b=h,c=0;j<h;)if(a=g[j++]){if(j>b){if(++c>=5e3){j=h,q.utils.deferError(Error("'Too much recursion' after processing "+c+" task groups."));break}b=h}try{a()}catch(a){q.utils.deferError(a)}}}function d(){a(),j=h=g.length=0}function e(){q.tasks.scheduler(d)}var f,g=[],h=0,i=1,j=0;return f=b.MutationObserver?function(a){var b=c.createElement("div");return new MutationObserver(a).observe(b,{attributes:!0}),function(){b.classList.toggle("foo")}}(d):c&&"onreadystatechange"in c.createElement("script")?function(a){var b=c.createElement("script");b.onreadystatechange=function(){b.onreadystatechange=null,c.documentElement.removeChild(b),b=null,a()},c.documentElement.appendChild(b)}:function(a){setTimeout(a,0)},{scheduler:f,schedule:function(a){return h||e(),g[h++]=a,i++},cancel:function(a){var b=a-(i-h);b>=j&&b<h&&(g[b]=null)},resetForTesting:function(){var a=h-j;return j=h=g.length=0,a},runEarly:a}}(),q.exportSymbol("tasks",q.tasks),q.exportSymbol("tasks.schedule",q.tasks.schedule),q.exportSymbol("tasks.runEarly",q.tasks.runEarly),q.extenders={throttle:function(a,b){a.throttleEvaluation=b;var c=null;return q.dependentObservable({read:a,write:function(d){clearTimeout(c),c=q.utils.setTimeout(function(){a(d)},b)}})},rateLimit:function(a,b){var c,d,e;"number"==typeof b?c=b:(c=b.timeout,d=b.method),a._deferUpdates=!1,e="notifyWhenChangesStop"==d?k:j,a.limit(function(a){return e(a,c)})},deferred:function(b,c){if(!0!==c)throw new Error("The 'deferred' extender only accepts the value 'true', because it is not supported to turn deferral off once enabled.");b._deferUpdates||(b._deferUpdates=!0,b.limit(function(c){var d;return function(){q.tasks.cancel(d),d=q.tasks.schedule(c),b.notifySubscribers(a,"dirty")}}))},notify:function(a,b){a.equalityComparer="always"==b?null:i}};var r={undefined:1,boolean:1,number:1,string:1};q.exportSymbol("extenders",q.extenders),q.subscription=function(a,b,c){this._target=a,this.callback=b,this.disposeCallback=c,this.isDisposed=!1,q.exportProperty(this,"dispose",this.dispose)},q.subscription.prototype.dispose=function(){this.isDisposed=!0,this.disposeCallback()},q.subscribable=function(){q.utils.setPrototypeOfOrExtend(this,t),t.init(this)};var s="change",t={init:function(a){a._subscriptions={},a._versionNumber=1},subscribe:function(a,b,c){var d=this;c=c||s;var e=b?a.bind(b):a,f=new q.subscription(d,e,function(){q.utils.arrayRemoveItem(d._subscriptions[c],f),d.afterSubscriptionRemove&&d.afterSubscriptionRemove(c)});return d.beforeSubscriptionAdd&&d.beforeSubscriptionAdd(c),d._subscriptions[c]||(d._subscriptions[c]=[]),d._subscriptions[c].push(f),f},notifySubscribers:function(a,b){if(b=b||s,b===s&&this.updateVersion(),this.hasSubscriptionsForEvent(b))try{q.dependencyDetection.begin();for(var c,d=this._subscriptions[b].slice(0),e=0;c=d[e];++e)c.isDisposed||c.callback(a)}finally{q.dependencyDetection.end()}},getVersion:function(){return this._versionNumber},hasChanged:function(a){return this.getVersion()!==a},updateVersion:function(){++this._versionNumber},limit:function(a){var b,c,d,e=this,f=q.isObservable(e);e._origNotifySubscribers||(e._origNotifySubscribers=e.notifySubscribers,e.notifySubscribers=m);var g=a(function(){e._notificationIsPending=!1,f&&d===e&&(d=e()),b=!1,e.isDifferent(c,d)&&e._origNotifySubscribers(c=d)});e._limitChange=function(a){e._notificationIsPending=b=!0,d=a,g()},e._limitBeforeChange=function(a){b||(c=a,e._origNotifySubscribers(a,"beforeChange"))}},hasSubscriptionsForEvent:function(a){return this._subscriptions[a]&&this._subscriptions[a].length},
getSubscriptionsCount:function(a){if(a)return this._subscriptions[a]&&this._subscriptions[a].length||0;var b=0;return q.utils.objectForEach(this._subscriptions,function(a,c){"dirty"!==a&&(b+=c.length)}),b},isDifferent:function(a,b){return!this.equalityComparer||!this.equalityComparer(a,b)},extend:l};q.exportProperty(t,"subscribe",t.subscribe),q.exportProperty(t,"extend",t.extend),q.exportProperty(t,"getSubscriptionsCount",t.getSubscriptionsCount),q.utils.canSetPrototype&&q.utils.setPrototypeOf(t,Function.prototype),q.subscribable.fn=t,q.isSubscribable=function(a){return null!=a&&"function"==typeof a.subscribe&&"function"==typeof a.notifySubscribers},q.exportSymbol("subscribable",q.subscribable),q.exportSymbol("isSubscribable",q.isSubscribable),q.computedContext=q.dependencyDetection=function(){function a(){return++f}function b(a){e.push(d),d=a}function c(){d=e.pop()}var d,e=[],f=0;return{begin:b,end:c,registerDependency:function(b){if(d){if(!q.isSubscribable(b))throw new Error("Only subscribable things can act as dependencies");d.callback.call(d.callbackTarget,b,b._id||(b._id=a()))}},ignore:function(a,d,e){try{return b(),a.apply(d,e||[])}finally{c()}},getDependenciesCount:function(){if(d)return d.computed.getDependenciesCount()},isInitial:function(){if(d)return d.isInitial}}}(),q.exportSymbol("computedContext",q.computedContext),q.exportSymbol("computedContext.getDependenciesCount",q.computedContext.getDependenciesCount),q.exportSymbol("computedContext.isInitial",q.computedContext.isInitial),q.exportSymbol("ignoreDependencies",q.ignoreDependencies=q.dependencyDetection.ignore);var u=q.utils.createSymbolOrString("_latestValue");q.observable=function(a){function b(){return arguments.length>0?(b.isDifferent(b[u],arguments[0])&&(b.valueWillMutate(),b[u]=arguments[0],b.valueHasMutated()),this):(q.dependencyDetection.registerDependency(b),b[u])}return b[u]=a,q.utils.canSetPrototype||q.utils.extend(b,q.subscribable.fn),q.subscribable.fn.init(b),q.utils.setPrototypeOfOrExtend(b,v),q.options.deferUpdates&&q.extenders.deferred(b,!0),b};var v={equalityComparer:i,peek:function(){return this[u]},valueHasMutated:function(){this.notifySubscribers(this[u])},valueWillMutate:function(){this.notifySubscribers(this[u],"beforeChange")}};q.utils.canSetPrototype&&q.utils.setPrototypeOf(v,q.subscribable.fn);var w=q.observable.protoProperty="__ko_proto__";v[w]=q.observable,q.hasPrototype=function(b,c){return null!==b&&b!==a&&b[w]!==a&&(b[w]===c||q.hasPrototype(b[w],c))},q.isObservable=function(a){return q.hasPrototype(a,q.observable)},q.isWriteableObservable=function(a){return"function"==typeof a&&a[w]===q.observable||!("function"!=typeof a||a[w]!==q.dependentObservable||!a.hasWriteFunction)},q.exportSymbol("observable",q.observable),q.exportSymbol("isObservable",q.isObservable),q.exportSymbol("isWriteableObservable",q.isWriteableObservable),q.exportSymbol("isWritableObservable",q.isWriteableObservable),q.exportSymbol("observable.fn",v),q.exportProperty(v,"peek",v.peek),q.exportProperty(v,"valueHasMutated",v.valueHasMutated),q.exportProperty(v,"valueWillMutate",v.valueWillMutate),q.observableArray=function(a){if("object"!=typeof(a=a||[])||!("length"in a))throw new Error("The argument passed when initializing an observable array must be an array, or null, or undefined.");var b=q.observable(a);return q.utils.setPrototypeOfOrExtend(b,q.observableArray.fn),b.extend({trackArrayChanges:!0})},q.observableArray.fn={remove:function(a){for(var b=this.peek(),c=[],d="function"!=typeof a||q.isObservable(a)?function(b){return b===a}:a,e=0;e<b.length;e++){var f=b[e];d(f)&&(0===c.length&&this.valueWillMutate(),c.push(f),b.splice(e,1),e--)}return c.length&&this.valueHasMutated(),c},removeAll:function(b){if(b===a){var c=this.peek(),d=c.slice(0);return this.valueWillMutate(),c.splice(0,c.length),this.valueHasMutated(),d}return b?this.remove(function(a){return q.utils.arrayIndexOf(b,a)>=0}):[]},destroy:function(a){var b=this.peek(),c="function"!=typeof a||q.isObservable(a)?function(b){return b===a}:a;this.valueWillMutate();for(var d=b.length-1;d>=0;d--){c(b[d])&&(b[d]._destroy=!0)}this.valueHasMutated()},destroyAll:function(b){return b===a?this.destroy(function(){return!0}):b?this.destroy(function(a){return q.utils.arrayIndexOf(b,a)>=0}):[]},indexOf:function(a){var b=this();return q.utils.arrayIndexOf(b,a)},replace:function(a,b){var c=this.indexOf(a);c>=0&&(this.valueWillMutate(),this.peek()[c]=b,this.valueHasMutated())}},q.utils.canSetPrototype&&q.utils.setPrototypeOf(q.observableArray.fn,q.observable.fn),q.utils.arrayForEach(["pop","push","reverse","shift","sort","splice","unshift"],function(a){q.observableArray.fn[a]=function(){var b=this.peek();this.valueWillMutate(),this.cacheDiffForKnownOperation(b,a,arguments);var c=b[a].apply(b,arguments);return this.valueHasMutated(),c===b?this:c}}),q.utils.arrayForEach(["slice"],function(a){q.observableArray.fn[a]=function(){var b=this();return b[a].apply(b,arguments)}}),q.exportSymbol("observableArray",q.observableArray);var x="arrayChange";q.extenders.trackArrayChanges=function(a,b){function c(){if(!f){f=!0;var b=a.notifySubscribers;a.notifySubscribers=function(a,c){return c&&c!==s||++h,b.apply(this,arguments)};var c=[].concat(a.peek()||[]);g=null,e=a.subscribe(function(b){if(b=[].concat(b||[]),a.hasSubscriptionsForEvent(x))var e=d(c,b);c=b,g=null,h=0,e&&e.length&&a.notifySubscribers(e,x)})}}function d(b,c){return(!g||h>1)&&(g=q.utils.compareArrays(b,c,a.compareArrayOptions)),g}if(a.compareArrayOptions={},b&&"object"==typeof b&&q.utils.extend(a.compareArrayOptions,b),a.compareArrayOptions.sparse=!0,!a.cacheDiffForKnownOperation){var e,f=!1,g=null,h=0,i=a.beforeSubscriptionAdd,j=a.afterSubscriptionRemove;a.beforeSubscriptionAdd=function(b){i&&i.call(a,b),b===x&&c()},a.afterSubscriptionRemove=function(b){j&&j.call(a,b),b!==x||a.hasSubscriptionsForEvent(x)||(e.dispose(),f=!1)},a.cacheDiffForKnownOperation=function(a,b,c){function d(a,b,c){return e[e.length]={status:a,value:b,index:c}}if(f&&!h){var e=[],i=a.length,j=c.length,k=0;switch(b){case"push":k=i;case"unshift":for(var l=0;l<j;l++)d("added",c[l],k+l);break;case"pop":k=i-1;case"shift":i&&d("deleted",a[k],k);break;case"splice":for(var m=Math.min(Math.max(0,c[0]<0?i+c[0]:c[0]),i),n=1===j?i:Math.min(m+(c[1]||0),i),o=m+j-2,p=Math.max(n,o),r=[],s=[],l=m,t=2;l<p;++l,++t)l<n&&s.push(d("deleted",a[l],l)),l<o&&r.push(d("added",c[t],l));q.utils.findMovesInArrayComparison(s,r);break;default:return}g=e}}}};var y=q.utils.createSymbolOrString("_state");q.computed=q.dependentObservable=function(b,c,d){function e(){if(arguments.length>0){if("function"!=typeof f)throw new Error("Cannot write a value to a ko.computed unless you specify a 'write' option. If you wish to read the current value, don't pass any parameters.");return f.apply(g.evaluatorFunctionTarget,arguments),this}return q.dependencyDetection.registerDependency(e),(g.isStale||g.isSleeping&&e.haveDependenciesChanged())&&e.evaluateImmediate(),g.latestValue}if("object"==typeof b?d=b:(d=d||{},b&&(d.read=b)),"function"!=typeof d.read)throw Error("Pass a function that returns the value of the ko.computed");var f=d.write,g={latestValue:a,isStale:!0,isBeingEvaluated:!1,suppressDisposalUntilDisposeWhenReturnsFalse:!1,isDisposed:!1,pure:!1,isSleeping:!1,readFunction:d.read,evaluatorFunctionTarget:c||d.owner,disposeWhenNodeIsRemoved:d.disposeWhenNodeIsRemoved||d.disposeWhenNodeIsRemoved||null,disposeWhen:d.disposeWhen||d.disposeWhen,domNodeDisposalCallback:null,dependencyTracking:{},dependenciesCount:0,evaluationTimeoutInstance:null};return e[y]=g,e.hasWriteFunction="function"==typeof f,q.utils.canSetPrototype||q.utils.extend(e,q.subscribable.fn),q.subscribable.fn.init(e),q.utils.setPrototypeOfOrExtend(e,z),d.pure?(g.pure=!0,g.isSleeping=!0,q.utils.extend(e,A)):d.deferEvaluation&&q.utils.extend(e,B),q.options.deferUpdates&&q.extenders.deferred(e,!0),g.disposeWhenNodeIsRemoved&&(g.suppressDisposalUntilDisposeWhenReturnsFalse=!0,g.disposeWhenNodeIsRemoved.nodeType||(g.disposeWhenNodeIsRemoved=null)),g.isSleeping||d.deferEvaluation||e.evaluateImmediate(),g.disposeWhenNodeIsRemoved&&e.isActive()&&q.utils.domNodeDisposal.addDisposeCallback(g.disposeWhenNodeIsRemoved,g.domNodeDisposalCallback=function(){e.dispose()}),e};var z={equalityComparer:i,getDependenciesCount:function(){return this[y].dependenciesCount},addDependencyTracking:function(a,b,c){if(this[y].pure&&b===this)throw Error("A 'pure' computed must not be called recursively");this[y].dependencyTracking[a]=c,c._order=this[y].dependenciesCount++,c._version=b.getVersion()},haveDependenciesChanged:function(){var a,b,c=this[y].dependencyTracking;for(a in c)if(c.hasOwnProperty(a)&&(b=c[a],b._target.hasChanged(b._version)))return!0},markDirty:function(){this._evalDelayed&&!this[y].isBeingEvaluated&&this._evalDelayed()},isActive:function(){return this[y].isStale||this[y].dependenciesCount>0},respondToChange:function(){this._notificationIsPending||this.evaluatePossiblyAsync()},subscribeToDependency:function(a){if(a._deferUpdates&&!this[y].disposeWhenNodeIsRemoved){var b=a.subscribe(this.markDirty,this,"dirty"),c=a.subscribe(this.respondToChange,this);return{_target:a,dispose:function(){b.dispose(),c.dispose()}}}return a.subscribe(this.evaluatePossiblyAsync,this)},evaluatePossiblyAsync:function(){var a=this,b=a.throttleEvaluation;b&&b>=0?(clearTimeout(this[y].evaluationTimeoutInstance),this[y].evaluationTimeoutInstance=q.utils.setTimeout(function(){a.evaluateImmediate(!0)},b)):a._evalDelayed?a._evalDelayed():a.evaluateImmediate(!0)},evaluateImmediate:function(a){var b=this,c=b[y],d=c.disposeWhen;if(!c.isBeingEvaluated&&!c.isDisposed){if(c.disposeWhenNodeIsRemoved&&!q.utils.domNodeIsAttachedToDocument(c.disposeWhenNodeIsRemoved)||d&&d()){if(!c.suppressDisposalUntilDisposeWhenReturnsFalse)return void b.dispose()}else c.suppressDisposalUntilDisposeWhenReturnsFalse=!1;c.isBeingEvaluated=!0;try{this.evaluateImmediate_CallReadWithDependencyDetection(a)}finally{c.isBeingEvaluated=!1}c.dependenciesCount||b.dispose()}},evaluateImmediate_CallReadWithDependencyDetection:function(b){var c=this,d=c[y],e=d.pure?a:!d.dependenciesCount,f={computedObservable:c,disposalCandidates:d.dependencyTracking,disposalCount:d.dependenciesCount};q.dependencyDetection.begin({callbackTarget:f,callback:o,computed:c,isInitial:e}),d.dependencyTracking={},d.dependenciesCount=0;var g=this.evaluateImmediate_CallReadThenEndDependencyDetection(d,f);c.isDifferent(d.latestValue,g)&&(d.isSleeping||c.notifySubscribers(d.latestValue,"beforeChange"),d.latestValue=g,d.isSleeping?c.updateVersion():b&&c.notifySubscribers(d.latestValue)),e&&c.notifySubscribers(d.latestValue,"awake")},evaluateImmediate_CallReadThenEndDependencyDetection:function(a,b){try{var c=a.readFunction;return a.evaluatorFunctionTarget?c.call(a.evaluatorFunctionTarget):c()}finally{q.dependencyDetection.end(),b.disposalCount&&!a.isSleeping&&q.utils.objectForEach(b.disposalCandidates,n),a.isStale=!1}},peek:function(){var a=this[y];return(a.isStale&&!a.dependenciesCount||a.isSleeping&&this.haveDependenciesChanged())&&this.evaluateImmediate(),a.latestValue},limit:function(a){q.subscribable.fn.limit.call(this,a),this._evalDelayed=function(){this._limitBeforeChange(this[y].latestValue),this[y].isStale=!0,this._limitChange(this)}},dispose:function(){var a=this[y];!a.isSleeping&&a.dependencyTracking&&q.utils.objectForEach(a.dependencyTracking,function(a,b){b.dispose&&b.dispose()}),a.disposeWhenNodeIsRemoved&&a.domNodeDisposalCallback&&q.utils.domNodeDisposal.removeDisposeCallback(a.disposeWhenNodeIsRemoved,a.domNodeDisposalCallback),a.dependencyTracking=null,a.dependenciesCount=0,a.isDisposed=!0,a.isStale=!1,a.isSleeping=!1,a.disposeWhenNodeIsRemoved=null}},A={beforeSubscriptionAdd:function(a){var b=this,c=b[y];if(!c.isDisposed&&c.isSleeping&&"change"==a){if(c.isSleeping=!1,c.isStale||b.haveDependenciesChanged())c.dependencyTracking=null,c.dependenciesCount=0,c.isStale=!0,b.evaluateImmediate();else{var d=[];q.utils.objectForEach(c.dependencyTracking,function(a,b){d[b._order]=a}),q.utils.arrayForEach(d,function(a,d){var e=c.dependencyTracking[a],f=b.subscribeToDependency(e._target);f._order=d,f._version=e._version,c.dependencyTracking[a]=f})}c.isDisposed||b.notifySubscribers(c.latestValue,"awake")}},afterSubscriptionRemove:function(b){var c=this[y];c.isDisposed||"change"!=b||this.hasSubscriptionsForEvent("change")||(q.utils.objectForEach(c.dependencyTracking,function(a,b){b.dispose&&(c.dependencyTracking[a]={_target:b._target,_order:b._order,_version:b._version},b.dispose())}),c.isSleeping=!0,this.notifySubscribers(a,"asleep"))},getVersion:function(){var a=this[y];return a.isSleeping&&(a.isStale||this.haveDependenciesChanged())&&this.evaluateImmediate(),q.subscribable.fn.getVersion.call(this)}},B={beforeSubscriptionAdd:function(a){"change"!=a&&"beforeChange"!=a||this.peek()}};q.utils.canSetPrototype&&q.utils.setPrototypeOf(z,q.subscribable.fn);var C=q.observable.protoProperty;q.computed[C]=q.observable,z[C]=q.computed,q.isComputed=function(a){return q.hasPrototype(a,q.computed)},q.isPureComputed=function(a){return q.hasPrototype(a,q.computed)&&a[y]&&a[y].pure},q.exportSymbol("computed",q.computed),q.exportSymbol("dependentObservable",q.computed),q.exportSymbol("isComputed",q.isComputed),q.exportSymbol("isPureComputed",q.isPureComputed),q.exportSymbol("computed.fn",z),q.exportProperty(z,"peek",z.peek),q.exportProperty(z,"dispose",z.dispose),q.exportProperty(z,"isActive",z.isActive),q.exportProperty(z,"getDependenciesCount",z.getDependenciesCount),q.pureComputed=function(a,b){return"function"==typeof a?q.computed(a,b,{pure:!0}):(a=q.utils.extend({},a),a.pure=!0,q.computed(a,b))},q.exportSymbol("pureComputed",q.pureComputed),function(){function b(e,f,g){if(g=g||new d,!!("object"!=typeof(e=f(e))||null===e||e===a||e instanceof RegExp||e instanceof Date||e instanceof String||e instanceof Number||e instanceof Boolean))return e;var h=e instanceof Array?[]:{};return g.save(e,h),c(e,function(c){var d=f(e[c]);switch(typeof d){case"boolean":case"number":case"string":case"function":h[c]=d;break;case"object":case"undefined":var i=g.get(d);h[c]=i!==a?i:b(d,f,g)}}),h}function c(a,b){if(a instanceof Array){for(var c=0;c<a.length;c++)b(c);"function"==typeof a.toJSON&&b("toJSON")}else for(var d in a)b(d)}function d(){this.keys=[],this.values=[]}q.toJS=function(a){if(0==arguments.length)throw new Error("When calling ko.toJS, pass the object you want to convert.");return b(a,function(a){for(var b=0;q.isObservable(a)&&b<10;b++)a=a();return a})},q.toJSON=function(a,b,c){var d=q.toJS(a);return q.utils.stringifyJson(d,b,c)},d.prototype={constructor:d,save:function(a,b){var c=q.utils.arrayIndexOf(this.keys,a);c>=0?this.values[c]=b:(this.keys.push(a),this.values.push(b))},get:function(b){var c=q.utils.arrayIndexOf(this.keys,b);return c>=0?this.values[c]:a}}}(),q.exportSymbol("toJS",q.toJS),q.exportSymbol("toJSON",q.toJSON),function(){q.selectExtensions={readValue:function(b){switch(q.utils.tagNameLower(b)){case"option":return!0===b.__ko__hasDomDataOptionValue__?q.utils.domData.get(b,q.bindingHandlers.options.optionValueDomDataKey):q.utils.ieVersion<=7?b.getAttributeNode("value")&&b.getAttributeNode("value").specified?b.value:b.text:b.value;case"select":return b.selectedIndex>=0?q.selectExtensions.readValue(b.options[b.selectedIndex]):a;default:return b.value}},writeValue:function(b,c,d){switch(q.utils.tagNameLower(b)){case"option":switch(typeof c){case"string":q.utils.domData.set(b,q.bindingHandlers.options.optionValueDomDataKey,a),"__ko__hasDomDataOptionValue__"in b&&delete b.__ko__hasDomDataOptionValue__,b.value=c;break;default:q.utils.domData.set(b,q.bindingHandlers.options.optionValueDomDataKey,c),b.__ko__hasDomDataOptionValue__=!0,b.value="number"==typeof c?c:""}break;case"select":""!==c&&null!==c||(c=a);for(var e,f=-1,g=0,h=b.options.length;g<h;++g)if((e=q.selectExtensions.readValue(b.options[g]))==c||""==e&&c===a){f=g;break}(d||f>=0||c===a&&b.size>1)&&(b.selectedIndex=f);break;default:null!==c&&c!==a||(c=""),b.value=c}}}}(),q.exportSymbol("selectExtensions",q.selectExtensions),q.exportSymbol("selectExtensions.readValue",q.selectExtensions.readValue),q.exportSymbol("selectExtensions.writeValue",q.selectExtensions.writeValue),q.expressionRewriting=function(){function a(a){if(q.utils.arrayIndexOf(d,a)>=0)return!1;var b=a.match(e);return null!==b&&(b[1]?"Object("+b[1]+")"+b[2]:a)}function b(a){var b=q.utils.stringTrim(a);123===b.charCodeAt(0)&&(b=b.slice(1,-1));var c,d=[],e=b.match(f),i=[],j=0;if(e){e.push(",");for(var k,l=0;k=e[l];++l){var m=k.charCodeAt(0);if(44===m){if(j<=0){d.push(c&&i.length?{key:c,value:i.join("")}:{unknown:c||i.join("")}),c=j=0,i=[];continue}}else if(58===m){if(!j&&!c&&1===i.length){c=i.pop();continue}}else if(47===m&&l&&k.length>1){var n=e[l-1].match(g);n&&!h[n[0]]&&(b=b.substr(b.indexOf(k)+1),e=b.match(f),e.push(","),l=-1,k="/")}else 40===m||123===m||91===m?++j:41===m||125===m||93===m?--j:c||i.length||34!==m&&39!==m||(k=k.slice(1,-1));i.push(k)}}return d}function c(c,d){function e(b,c){var d;if(!j){if(!function(a){return!a||!a.preprocess||(c=a.preprocess(c,b,e))}(q.getBindingHandler(b)))return;i[b]&&(d=a(c))&&g.push("'"+b+"':function(_z){"+d+"=_z}")}h&&(c="function(){return "+c+" }"),f.push("'"+b+"':"+c)}d=d||{};var f=[],g=[],h=d.valueAccessors,j=d.bindingParams,k="string"==typeof c?b(c):c;return q.utils.arrayForEach(k,function(a){e(a.key||a.unknown,a.value)}),g.length&&e("_ko_property_writers","{"+g.join(",")+" }"),f.join(",")}var d=["true","false","null","undefined"],e=/^(?:[$_a-z][$\w]*|(.+)(\.\s*[$_a-z][$\w]*|\[.+\]))$/i,f=RegExp("\"(?:[^\"\\\\]|\\\\.)*\"|'(?:[^'\\\\]|\\\\.)*'|/(?:[^/\\\\]|\\\\.)*/w*|[^\\s:,/][^,\"'{}()/:[\\]]*[^\\s,\"'{}()/:[\\]]|[^\\s]","g"),g=/[\])"'A-Za-z0-9_$]+$/,h={in:1,return:1,typeof:1},i={};return{bindingRewriteValidators:[],twoWayBindings:i,parseObjectLiteral:b,preProcessBindings:c,keyValueArrayContainsKey:function(a,b){for(var c=0;c<a.length;c++)if(a[c].key==b)return!0;return!1},writeValueToProperty:function(a,b,c,d,e){if(a&&q.isObservable(a))!q.isWriteableObservable(a)||e&&a.peek()===d||a(d);else{var f=b.get("_ko_property_writers");f&&f[c]&&f[c](d)}}}}(),q.exportSymbol("expressionRewriting",q.expressionRewriting),q.exportSymbol("expressionRewriting.bindingRewriteValidators",q.expressionRewriting.bindingRewriteValidators),q.exportSymbol("expressionRewriting.parseObjectLiteral",q.expressionRewriting.parseObjectLiteral),q.exportSymbol("expressionRewriting.preProcessBindings",q.expressionRewriting.preProcessBindings),q.exportSymbol("expressionRewriting._twoWayBindings",q.expressionRewriting.twoWayBindings),q.exportSymbol("jsonExpressionRewriting",q.expressionRewriting),q.exportSymbol("jsonExpressionRewriting.insertPropertyAccessorsIntoJson",q.expressionRewriting.preProcessBindings),function(){function a(a){return 8==a.nodeType&&h.test(g?a.text:a.nodeValue)}function b(a){return 8==a.nodeType&&i.test(g?a.text:a.nodeValue)}function d(c,d){for(var e=c,f=1,g=[];e=e.nextSibling;){if(b(e)&&0===--f)return g;g.push(e),a(e)&&f++}if(!d)throw new Error("Cannot find closing comment tag to match: "+c.nodeValue);return null}function e(a,b){var c=d(a,b);return c?c.length>0?c[c.length-1].nextSibling:a.nextSibling:null}function f(c){var d=c.firstChild,f=null;if(d)do{if(f)f.push(d);else if(a(d)){var g=e(d,!0);g?d=g:f=[d]}else b(d)&&(f=[d])}while(d=d.nextSibling);return f}var g=c&&"\x3c!--test--\x3e"===c.createComment("test").text,h=g?/^<!--\s*ko(?:\s+([\s\S]+))?\s*-->$/:/^\s*ko(?:\s+([\s\S]+))?\s*$/,i=g?/^<!--\s*\/ko\s*-->$/:/^\s*\/ko\s*$/,j={ul:!0,ol:!0};q.virtualElements={allowedBindings:{},childNodes:function(b){return a(b)?d(b):b.childNodes},emptyNode:function(b){if(a(b))for(var c=q.virtualElements.childNodes(b),d=0,e=c.length;d<e;d++)q.removeNode(c[d]);else q.utils.emptyDomNode(b)},setDomNodeChildren:function(b,c){if(a(b)){q.virtualElements.emptyNode(b);for(var d=b.nextSibling,e=0,f=c.length;e<f;e++)d.parentNode.insertBefore(c[e],d)}else q.utils.setDomNodeChildren(b,c)},prepend:function(b,c){a(b)?b.parentNode.insertBefore(c,b.nextSibling):b.firstChild?b.insertBefore(c,b.firstChild):b.appendChild(c)},insertAfter:function(b,c,d){d?a(b)?b.parentNode.insertBefore(c,d.nextSibling):d.nextSibling?b.insertBefore(c,d.nextSibling):b.appendChild(c):q.virtualElements.prepend(b,c)},firstChild:function(c){return a(c)?!c.nextSibling||b(c.nextSibling)?null:c.nextSibling:c.firstChild},nextSibling:function(c){return a(c)&&(c=e(c)),c.nextSibling&&b(c.nextSibling)?null:c.nextSibling},hasBindingValue:a,virtualNodeBindingValue:function(a){var b=(g?a.text:a.nodeValue).match(h);return b?b[1]:null},normaliseVirtualElementDomStructure:function(a){if(j[q.utils.tagNameLower(a)]){var b=a.firstChild;if(b)do{if(1===b.nodeType){var c=f(b);if(c)for(var d=b.nextSibling,e=0;e<c.length;e++)d?a.insertBefore(c[e],d):a.appendChild(c[e])}}while(b=b.nextSibling)}}}}(),q.exportSymbol("virtualElements",q.virtualElements),q.exportSymbol("virtualElements.allowedBindings",q.virtualElements.allowedBindings),q.exportSymbol("virtualElements.emptyNode",q.virtualElements.emptyNode),q.exportSymbol("virtualElements.insertAfter",q.virtualElements.insertAfter),q.exportSymbol("virtualElements.prepend",q.virtualElements.prepend),q.exportSymbol("virtualElements.setDomNodeChildren",q.virtualElements.setDomNodeChildren),function(){function a(a,c,d){var e=a+(d&&d.valueAccessors||"");return c[e]||(c[e]=b(a,d))}function b(a,b){var c=q.expressionRewriting.preProcessBindings(a,b),d="with($context){with($data||{}){return{"+c+"}}}";return new Function("$context","$element",d)}q.bindingProvider=function(){this.bindingCache={}},q.utils.extend(q.bindingProvider.prototype,{nodeHasBindings:function(a){switch(a.nodeType){case 1:return null!=a.getAttribute("data-bind")||q.components.getComponentNameForNode(a);case 8:return q.virtualElements.hasBindingValue(a);default:return!1}},getBindings:function(a,b){var c=this.getBindingsString(a,b),d=c?this.parseBindingsString(c,b,a):null;return q.components.addBindingsForCustomElement(d,a,b,!1)},getBindingAccessors:function(a,b){var c=this.getBindingsString(a,b),d=c?this.parseBindingsString(c,b,a,{valueAccessors:!0}):null;return q.components.addBindingsForCustomElement(d,a,b,!0)},getBindingsString:function(a,b){switch(a.nodeType){case 1:return a.getAttribute("data-bind");case 8:return q.virtualElements.virtualNodeBindingValue(a);default:return null}},parseBindingsString:function(b,c,d,e){try{return a(b,this.bindingCache,e)(c,d)}catch(a){throw a.message="Unable to parse bindings.\nBindings value: "+b+"\nMessage: "+a.message,a}}}),q.bindingProvider.instance=new q.bindingProvider}(),q.exportSymbol("bindingProvider",q.bindingProvider),function(){function c(a){return function(){return a}}function d(a){return a()}function f(a){return q.utils.objectMap(q.dependencyDetection.ignore(a),function(b,c){return function(){return a()[c]}})}function g(a,b,d){return"function"==typeof a?f(a.bind(null,b,d)):q.utils.objectMap(a,c)}function h(a,b){return f(this.getBindings.bind(this,a,b))}function i(a){if(!q.virtualElements.allowedBindings[a])throw new Error("The binding '"+a+"' cannot be used with virtual elements")}function j(a,b,c){var d,e=q.virtualElements.firstChild(b),f=q.bindingProvider.instance,g=f.preprocessNode;if(g){for(;d=e;)e=q.virtualElements.nextSibling(d),g.call(f,d);e=q.virtualElements.firstChild(b)}for(;d=e;)e=q.virtualElements.nextSibling(d),k(a,d,c)}function k(a,b,c){var d=!0,e=1===b.nodeType;e&&q.virtualElements.normaliseVirtualElementDomStructure(b),(e&&c||q.bindingProvider.instance.nodeHasBindings(b))&&(d=m(b,null,a,c).shouldBindDescendants),d&&!o[q.utils.tagNameLower(b)]&&j(a,b,!e)}function l(a){var b=[],c={},d=[];return q.utils.objectForEach(a,function e(f){if(!c[f]){var g=q.getBindingHandler(f);g&&(g.after&&(d.push(f),q.utils.arrayForEach(g.after,function(b){if(a[b]){if(-1!==q.utils.arrayIndexOf(d,b))throw Error("Cannot combine the following bindings, because they have a cyclic dependency: "+d.join(", "));e(b)}}),d.length--),b.push({key:f,handler:g})),c[f]=!0}}),b}function m(b,c,e,f){function g(){return q.utils.objectMap(o?o():k,d)}var j=q.utils.domData.get(b,p);if(!c){if(j)throw Error("You cannot apply bindings multiple times to the same element.");q.utils.domData.set(b,p,!0)}!j&&f&&q.storedBindingContextForNode(b,e);var k;if(c&&"function"!=typeof c)k=c;else{var m=q.bindingProvider.instance,n=m.getBindingAccessors||h,o=q.dependentObservable(function(){return k=c?c(e,b):n.call(m,b,e),k&&e._subscribable&&e._subscribable(),k},null,{disposeWhenNodeIsRemoved:b});k&&o.isActive()||(o=null)}var r;if(k){var s=o?function(a){return function(){return d(o()[a])}}:function(a){return k[a]};g.get=function(a){return k[a]&&d(s(a))},g.has=function(a){return a in k};var t=l(k);q.utils.arrayForEach(t,function(c){var d=c.handler.init,f=c.handler.update,h=c.key;8===b.nodeType&&i(h);try{"function"==typeof d&&q.dependencyDetection.ignore(function(){var c=d(b,s(h),g,e.$data,e);if(c&&c.controlsDescendantBindings){if(r!==a)throw new Error("Multiple bindings ("+r+" and "+h+") are trying to control descendant bindings of the same element. You cannot use these bindings together on the same element.");r=h}}),"function"==typeof f&&q.dependentObservable(function(){f(b,s(h),g,e.$data,e)},null,{disposeWhenNodeIsRemoved:b})}catch(a){throw a.message='Unable to process binding "'+h+": "+k[h]+'"\nMessage: '+a.message,a}})}return{shouldBindDescendants:r===a}}function n(a){return a&&a instanceof q.bindingContext?a:new q.bindingContext(a)}q.bindingHandlers={};var o={script:!0,textarea:!0,template:!0};q.getBindingHandler=function(a){return q.bindingHandlers[a]},q.bindingContext=function(b,c,d,e){function f(){var a=j?b():b,f=q.utils.unwrapObservable(a);return c?(c._subscribable&&c._subscribable(),q.utils.extend(i,c),k&&(i._subscribable=k)):(i.$parents=[],i.$root=f,i.ko=q),i.$rawData=a,i.$data=f,d&&(i[d]=f),e&&e(i,c,f),i.$data}function g(){return h&&!q.utils.anyDomNodeIsAttachedToDocument(h)}var h,i=this,j="function"==typeof b&&!q.isObservable(b),k=q.dependentObservable(f,null,{disposeWhen:g,disposeWhenNodeIsRemoved:!0});k.isActive()&&(i._subscribable=k,k.equalityComparer=null,h=[],k._addNode=function(b){h.push(b),q.utils.domNodeDisposal.addDisposeCallback(b,function(b){q.utils.arrayRemoveItem(h,b),h.length||(k.dispose(),i._subscribable=k=a)})})},q.bindingContext.prototype.createChildContext=function(a,b,c){return new q.bindingContext(a,this,b,function(a,b){a.$parentContext=b,a.$parent=b.$data,a.$parents=(b.$parents||[]).slice(0),a.$parents.unshift(a.$parent),c&&c(a)})},q.bindingContext.prototype.extend=function(a){return new q.bindingContext(this._subscribable||this.$data,this,null,function(b,c){b.$rawData=c.$rawData,q.utils.extend(b,"function"==typeof a?a():a)})};var p=q.utils.domData.nextKey(),r=q.utils.domData.nextKey();q.storedBindingContextForNode=function(a,b){if(2!=arguments.length)return q.utils.domData.get(a,r);q.utils.domData.set(a,r,b),b._subscribable&&b._subscribable._addNode(a)},q.applyBindingAccessorsToNode=function(a,b,c){return 1===a.nodeType&&q.virtualElements.normaliseVirtualElementDomStructure(a),m(a,b,n(c),!0)},q.applyBindingsToNode=function(a,b,c){var d=n(c);return q.applyBindingAccessorsToNode(a,g(b,d,a),d)},q.applyBindingsToDescendants=function(a,b){1!==b.nodeType&&8!==b.nodeType||j(n(a),b,!0)},q.applyBindings=function(a,c){if(!e&&b.jQuery&&(e=b.jQuery),c&&1!==c.nodeType&&8!==c.nodeType)throw new Error("ko.applyBindings: first parameter should be your view model; second parameter should be a DOM node");c=c||b.document.body,k(n(a),c,!0)},q.contextFor=function(b){switch(b.nodeType){case 1:case 8:var c=q.storedBindingContextForNode(b);if(c)return c;if(b.parentNode)return q.contextFor(b.parentNode)}return a},q.dataFor=function(b){var c=q.contextFor(b);return c?c.$data:a},q.exportSymbol("bindingHandlers",q.bindingHandlers),q.exportSymbol("applyBindings",q.applyBindings),q.exportSymbol("applyBindingsToDescendants",q.applyBindingsToDescendants),q.exportSymbol("applyBindingAccessorsToNode",q.applyBindingAccessorsToNode),q.exportSymbol("applyBindingsToNode",q.applyBindingsToNode),q.exportSymbol("contextFor",q.contextFor),q.exportSymbol("dataFor",q.dataFor)}(),function(a){function b(b,c){return b.hasOwnProperty(c)?b[c]:a}function c(a,c){var e,h=b(f,a);h?h.subscribe(c):(h=f[a]=new q.subscribable,h.subscribe(c),d(a,function(b,c){var d=!(!c||!c.synchronous);g[a]={definition:b,isSynchronousComponent:d},delete f[a],e||d?h.notifySubscribers(b):q.tasks.schedule(function(){h.notifySubscribers(b)})}),e=!0)}function d(a,b){e("getConfig",[a],function(c){c?e("loadComponent",[a,c],function(a){b(a,c)}):b(null,null)})}function e(b,c,d,f){f||(f=q.components.loaders.slice(0));var g=f.shift();if(g){var h=g[b];if(h){var i=!1;if(h.apply(g,c.concat(function(a){i?d(null):null!==a?d(a):e(b,c,d,f)}))!==a&&(i=!0,!g.suppressLoaderExceptions))throw new Error("Component loaders must supply values by invoking the callback, not by returning values synchronously.")}else e(b,c,d,f)}else d(null)}var f={},g={};q.components={get:function(a,d){var e=b(g,a);e?e.isSynchronousComponent?q.dependencyDetection.ignore(function(){d(e.definition)}):q.tasks.schedule(function(){d(e.definition)}):c(a,d)},clearCachedDefinition:function(a){delete g[a]},_getFirstResultFromLoaders:e},q.components.loaders=[],q.exportSymbol("components",q.components),q.exportSymbol("components.get",q.components.get),q.exportSymbol("components.clearCachedDefinition",q.components.clearCachedDefinition)}(),function(a){function d(a,b,c,d){var e={},f=2,g=function(){0==--f&&d(e)},h=c.template,i=c.viewModel;h?k(b,h,function(b){q.components._getFirstResultFromLoaders("loadTemplate",[a,b],function(a){e.template=a,g()})}):g(),i?k(b,i,function(b){q.components._getFirstResultFromLoaders("loadViewModel",[a,b],function(a){e[n]=a,g()})}):g()}function e(a,b,d){if("string"==typeof b)d(q.utils.parseHtmlFragment(b));else if(b instanceof Array)d(b);else if(j(b))d(q.utils.makeArray(b.childNodes));else if(b.element){var e=b.element;if(i(e))d(g(e));else if("string"==typeof e){var f=c.getElementById(e);f?d(g(f)):a("Cannot find element with ID "+e)}else a("Unknown element type: "+e)}else a("Unknown template value: "+b)}function f(a,b,c){if("function"==typeof b)c(function(a){return new b(a)});else if("function"==typeof b[n])c(b[n]);else if("instance"in b){var d=b.instance;c(function(a,b){return d})}else"viewModel"in b?f(a,b.viewModel,c):a("Unknown viewModel value: "+b)}function g(a){switch(q.utils.tagNameLower(a)){case"script":return q.utils.parseHtmlFragment(a.text);case"textarea":return q.utils.parseHtmlFragment(a.value);case"template":if(j(a.content))return q.utils.cloneNodes(a.content.childNodes)}return q.utils.cloneNodes(a.childNodes)}function i(a){return b.HTMLElement?a instanceof HTMLElement:a&&a.tagName&&1===a.nodeType}function j(a){return b.DocumentFragment?a instanceof DocumentFragment:a&&11===a.nodeType}function k(a,c,d){"string"==typeof c.require?h||b.require?(h||b.require)([c.require],d):a("Uses require, but no AMD loader is present"):d(c)}function l(a){return function(b){throw new Error("Component '"+a+"': "+b)}}var m={};q.components.register=function(a,b){if(!b)throw new Error("Invalid configuration for "+a);if(q.components.isRegistered(a))throw new Error("Component "+a+" is already registered");m[a]=b},q.components.isRegistered=function(a){return m.hasOwnProperty(a)},q.components.unregister=function(a){delete m[a],q.components.clearCachedDefinition(a)},q.components.defaultLoader={getConfig:function(a,b){b(m.hasOwnProperty(a)?m[a]:null)},loadComponent:function(a,b,c){var e=l(a);k(e,b,function(b){d(a,e,b,c)})},loadTemplate:function(a,b,c){e(l(a),b,c)},loadViewModel:function(a,b,c){f(l(a),b,c)}};var n="createViewModel";q.exportSymbol("components.register",q.components.register),q.exportSymbol("components.isRegistered",q.components.isRegistered),q.exportSymbol("components.unregister",q.components.unregister),
q.exportSymbol("components.defaultLoader",q.components.defaultLoader),q.components.loaders.push(q.components.defaultLoader),q.components._allRegisteredComponents=m}(),function(a){function b(a,b){var c=a.getAttribute("params");if(c){var e=d.parseBindingsString(c,b,a,{valueAccessors:!0,bindingParams:!0}),f=q.utils.objectMap(e,function(b,c){return q.computed(b,null,{disposeWhenNodeIsRemoved:a})}),g=q.utils.objectMap(f,function(b,c){var d=b.peek();return b.isActive()?q.computed({read:function(){return q.utils.unwrapObservable(b())},write:q.isWriteableObservable(d)&&function(a){b()(a)},disposeWhenNodeIsRemoved:a}):d});return g.hasOwnProperty("$raw")||(g.$raw=f),g}return{$raw:{}}}q.components.getComponentNameForNode=function(a){var b=q.utils.tagNameLower(a);if(q.components.isRegistered(b)&&(-1!=b.indexOf("-")||""+a=="[object HTMLUnknownElement]"||q.utils.ieVersion<=8&&a.tagName===b))return b},q.components.addBindingsForCustomElement=function(a,c,d,e){if(1===c.nodeType){var f=q.components.getComponentNameForNode(c);if(f){if(a=a||{},a.component)throw new Error('Cannot use the "component" binding on a custom element matching a component');var g={name:f,params:b(c,d)};a.component=e?function(){return g}:g}}return a};var d=new q.bindingProvider;q.utils.ieVersion<9&&(q.components.register=function(a){return function(b){return c.createElement(b),a.apply(this,arguments)}}(q.components.register),c.createDocumentFragment=function(a){return function(){var b=a(),c=q.components._allRegisteredComponents;for(var d in c)c.hasOwnProperty(d)&&b.createElement(d);return b}}(c.createDocumentFragment))}(),function(a){function b(a,b,c){var d=b.template;if(!d)throw new Error("Component '"+a+"' has no template");var e=q.utils.cloneNodes(d);q.virtualElements.setDomNodeChildren(c,e)}function c(a,b,c,d){var e=a.createViewModel;return e?e.call(a,d,{element:b,templateNodes:c}):d}var d=0;q.bindingHandlers.component={init:function(a,e,f,g,h){var i,j,k=function(){var a=i&&i.dispose;"function"==typeof a&&a.call(i),i=null,j=null},l=q.utils.makeArray(q.virtualElements.childNodes(a));return q.utils.domNodeDisposal.addDisposeCallback(a,k),q.computed(function(){var f,g,m=q.utils.unwrapObservable(e());if("string"==typeof m?f=m:(f=q.utils.unwrapObservable(m.name),g=q.utils.unwrapObservable(m.params)),!f)throw new Error("No component name specified");var n=j=++d;q.components.get(f,function(d){if(j===n){if(k(),!d)throw new Error("Unknown component '"+f+"'");b(f,d,a);var e=c(d,a,l,g),m=h.createChildContext(e,void 0,function(a){a.$component=e,a.$componentTemplateNodes=l});i=e,q.applyBindingsToDescendants(m,a)}})},null,{disposeWhenNodeIsRemoved:a}),{controlsDescendantBindings:!0}}},q.virtualElements.allowedBindings.component=!0}();var D={class:"className",for:"htmlFor"};q.bindingHandlers.attr={update:function(b,c,d){var e=q.utils.unwrapObservable(c())||{};q.utils.objectForEach(e,function(c,d){d=q.utils.unwrapObservable(d);var e=!1===d||null===d||d===a;e&&b.removeAttribute(c),q.utils.ieVersion<=8&&c in D?(c=D[c],e?b.removeAttribute(c):b[c]=d):e||b.setAttribute(c,d.toString()),"name"===c&&q.utils.setElementName(b,e?"":d.toString())})}},function(){q.bindingHandlers.checked={after:["value","attr"],init:function(b,c,d){function e(){var a=b.checked,e=n?g():a;if(!q.computedContext.isInitial()&&(!i||a)){var f=q.dependencyDetection.ignore(c);if(k){var h=l?f.peek():f;m!==e?(a&&(q.utils.addOrRemoveItem(h,e,!0),q.utils.addOrRemoveItem(h,m,!1)),m=e):q.utils.addOrRemoveItem(h,e,a),l&&q.isWriteableObservable(f)&&f(h)}else q.expressionRewriting.writeValueToProperty(f,d,"checked",e,!0)}}function f(){var a=q.utils.unwrapObservable(c());b.checked=k?q.utils.arrayIndexOf(a,g())>=0:h?a:g()===a}var g=q.pureComputed(function(){return d.has("checkedValue")?q.utils.unwrapObservable(d.get("checkedValue")):d.has("value")?q.utils.unwrapObservable(d.get("value")):b.value}),h="checkbox"==b.type,i="radio"==b.type;if(h||i){var j=c(),k=h&&q.utils.unwrapObservable(j)instanceof Array,l=!(k&&j.push&&j.splice),m=k?g():a,n=i||k;i&&!b.name&&q.bindingHandlers.uniqueName.init(b,function(){return!0}),q.computed(e,null,{disposeWhenNodeIsRemoved:b}),q.utils.registerEventHandler(b,"click",e),q.computed(f,null,{disposeWhenNodeIsRemoved:b}),j=a}}},q.expressionRewriting.twoWayBindings.checked=!0,q.bindingHandlers.checkedValue={update:function(a,b){a.value=q.utils.unwrapObservable(b())}}}();q.bindingHandlers.css={update:function(a,b){var c=q.utils.unwrapObservable(b());null!==c&&"object"==typeof c?q.utils.objectForEach(c,function(b,c){c=q.utils.unwrapObservable(c),q.utils.toggleDomNodeCssClass(a,b,c)}):(c=q.utils.stringTrim(String(c||"")),q.utils.toggleDomNodeCssClass(a,a.__ko__cssValue,!1),a.__ko__cssValue=c,q.utils.toggleDomNodeCssClass(a,c,!0))}},q.bindingHandlers.enable={update:function(a,b){var c=q.utils.unwrapObservable(b());c&&a.disabled?a.removeAttribute("disabled"):c||a.disabled||(a.disabled=!0)}},q.bindingHandlers.disable={update:function(a,b){q.bindingHandlers.enable.update(a,function(){return!q.utils.unwrapObservable(b())})}},q.bindingHandlers.event={init:function(a,b,c,d,e){var f=b()||{};q.utils.objectForEach(f,function(f){"string"==typeof f&&q.utils.registerEventHandler(a,f,function(a){var g,h=b()[f];if(h){try{var i=q.utils.makeArray(arguments);d=e.$data,i.unshift(d),g=h.apply(d,i)}finally{!0!==g&&(a.preventDefault?a.preventDefault():a.returnValue=!1)}!1!==c.get(f+"Bubble")||(a.cancelBubble=!0,a.stopPropagation&&a.stopPropagation())}})})}},q.bindingHandlers.foreach={makeTemplateValueAccessor:function(a){return function(){var b=a(),c=q.utils.peekObservable(b);return c&&"number"!=typeof c.length?(q.utils.unwrapObservable(b),{foreach:c.data,as:c.as,includeDestroyed:c.includeDestroyed,afterAdd:c.afterAdd,beforeRemove:c.beforeRemove,afterRender:c.afterRender,beforeMove:c.beforeMove,afterMove:c.afterMove,templateEngine:q.nativeTemplateEngine.instance}):{foreach:b,templateEngine:q.nativeTemplateEngine.instance}}},init:function(a,b,c,d,e){return q.bindingHandlers.template.init(a,q.bindingHandlers.foreach.makeTemplateValueAccessor(b))},update:function(a,b,c,d,e){return q.bindingHandlers.template.update(a,q.bindingHandlers.foreach.makeTemplateValueAccessor(b),c,d,e)}},q.expressionRewriting.bindingRewriteValidators.foreach=!1,q.virtualElements.allowedBindings.foreach=!0;q.bindingHandlers.hasfocus={init:function(a,b,c){var d=function(d){a.__ko_hasfocusUpdating=!0;var e=a.ownerDocument;if("activeElement"in e){var f;try{f=e.activeElement}catch(a){f=e.body}d=f===a}var g=b();q.expressionRewriting.writeValueToProperty(g,c,"hasfocus",d,!0),a.__ko_hasfocusLastValue=d,a.__ko_hasfocusUpdating=!1},e=d.bind(null,!0),f=d.bind(null,!1);q.utils.registerEventHandler(a,"focus",e),q.utils.registerEventHandler(a,"focusin",e),q.utils.registerEventHandler(a,"blur",f),q.utils.registerEventHandler(a,"focusout",f)},update:function(a,b){var c=!!q.utils.unwrapObservable(b());a.__ko_hasfocusUpdating||a.__ko_hasfocusLastValue===c||(c?a.focus():a.blur(),!c&&a.__ko_hasfocusLastValue&&a.ownerDocument.body.focus(),q.dependencyDetection.ignore(q.utils.triggerEvent,null,[a,c?"focusin":"focusout"]))}},q.expressionRewriting.twoWayBindings.hasfocus=!0,q.bindingHandlers.hasFocus=q.bindingHandlers.hasfocus,q.expressionRewriting.twoWayBindings.hasFocus=!0,q.bindingHandlers.html={init:function(){return{controlsDescendantBindings:!0}},update:function(a,b){q.utils.setHtml(a,b())}},p("if"),p("ifnot",!1,!0),p("with",!0,!1,function(a,b){return a.createChildContext(b)});var E={};q.bindingHandlers.options={init:function(a){if("select"!==q.utils.tagNameLower(a))throw new Error("options binding applies only to SELECT elements");for(;a.length>0;)a.remove(0);return{controlsDescendantBindings:!0}},update:function(b,c,d){function e(){return q.utils.arrayFilter(b.options,function(a){return a.selected})}function f(a,b,c){var d=typeof b;return"function"==d?b(a):"string"==d?a[b]:c}function g(c,e,g){g.length&&(s=!o&&g[0].selected?[q.selectExtensions.readValue(g[0])]:[],t=!0);var h=b.ownerDocument.createElement("option");if(c===E)q.utils.setTextContent(h,d.get("optionsCaption")),q.selectExtensions.writeValue(h,a);else{var i=f(c,d.get("optionsValue"),c);q.selectExtensions.writeValue(h,q.utils.unwrapObservable(i));var j=f(c,d.get("optionsText"),i);q.utils.setTextContent(h,j)}return[h]}function h(a,c){if(t&&o)q.selectExtensions.writeValue(b,q.utils.unwrapObservable(d.get("value")),!0);else if(s.length){var e=q.utils.arrayIndexOf(s,q.selectExtensions.readValue(c[0]))>=0;q.utils.setOptionNodeSelectionState(c[0],e),t&&!e&&q.dependencyDetection.ignore(q.utils.triggerEvent,null,[b,"change"])}}var i,j,k=0==b.length,l=b.multiple,m=!k&&l?b.scrollTop:null,n=q.utils.unwrapObservable(c()),o=d.get("valueAllowUnset")&&d.has("value"),p=d.get("optionsIncludeDestroyed"),r={},s=[];o||(l?s=q.utils.arrayMap(e(),q.selectExtensions.readValue):b.selectedIndex>=0&&s.push(q.selectExtensions.readValue(b.options[b.selectedIndex]))),n&&(void 0===n.length&&(n=[n]),j=q.utils.arrayFilter(n,function(b){return p||b===a||null===b||!q.utils.unwrapObservable(b._destroy)}),d.has("optionsCaption")&&null!==(i=q.utils.unwrapObservable(d.get("optionsCaption")))&&i!==a&&j.unshift(E));var t=!1;r.beforeRemove=function(a){b.removeChild(a)};var u=h;d.has("optionsAfterRender")&&"function"==typeof d.get("optionsAfterRender")&&(u=function(b,c){h(b,c),q.dependencyDetection.ignore(d.get("optionsAfterRender"),null,[c[0],b!==E?b:a])}),q.utils.setDomNodeChildrenFromArrayMapping(b,j,g,r,u),q.dependencyDetection.ignore(function(){if(o)q.selectExtensions.writeValue(b,q.utils.unwrapObservable(d.get("value")),!0);else{var a;a=l?s.length&&e().length<s.length:s.length&&b.selectedIndex>=0?q.selectExtensions.readValue(b.options[b.selectedIndex])!==s[0]:s.length||b.selectedIndex>=0,a&&q.utils.triggerEvent(b,"change")}}),q.utils.ensureSelectElementIsRenderedCorrectly(b),m&&Math.abs(m-b.scrollTop)>20&&(b.scrollTop=m)}},q.bindingHandlers.options.optionValueDomDataKey=q.utils.domData.nextKey(),q.bindingHandlers.selectedOptions={after:["options","foreach"],init:function(a,b,c){q.utils.registerEventHandler(a,"change",function(){var d=b(),e=[];q.utils.arrayForEach(a.getElementsByTagName("option"),function(a){a.selected&&e.push(q.selectExtensions.readValue(a))}),q.expressionRewriting.writeValueToProperty(d,c,"selectedOptions",e)})},update:function(a,b){if("select"!=q.utils.tagNameLower(a))throw new Error("values binding applies only to SELECT elements");var c=q.utils.unwrapObservable(b()),d=a.scrollTop;c&&"number"==typeof c.length&&q.utils.arrayForEach(a.getElementsByTagName("option"),function(a){var b=q.utils.arrayIndexOf(c,q.selectExtensions.readValue(a))>=0;a.selected!=b&&q.utils.setOptionNodeSelectionState(a,b)}),a.scrollTop=d}},q.expressionRewriting.twoWayBindings.selectedOptions=!0,q.bindingHandlers.style={update:function(b,c){var d=q.utils.unwrapObservable(c()||{});q.utils.objectForEach(d,function(c,d){d=q.utils.unwrapObservable(d),null!==d&&d!==a&&!1!==d||(d=""),b.style[c]=d})}},q.bindingHandlers.submit={init:function(a,b,c,d,e){if("function"!=typeof b())throw new Error("The value for a submit binding must be a function");q.utils.registerEventHandler(a,"submit",function(c){var d,f=b();try{d=f.call(e.$data,a)}finally{!0!==d&&(c.preventDefault?c.preventDefault():c.returnValue=!1)}})}},q.bindingHandlers.text={init:function(){return{controlsDescendantBindings:!0}},update:function(a,b){q.utils.setTextContent(a,b())}},q.virtualElements.allowedBindings.text=!0,function(){if(b&&b.navigator)var c=function(a){if(a)return parseFloat(a[1])},d=b.opera&&b.opera.version&&parseInt(b.opera.version()),e=b.navigator.userAgent,f=c(e.match(/^(?:(?!chrome).)*version\/([^ ]*) safari/i)),g=c(e.match(/Firefox\/([^ ]*)/));if(q.utils.ieVersion<10)var h=q.utils.domData.nextKey(),i=q.utils.domData.nextKey(),j=function(a){var b=this.activeElement,c=b&&q.utils.domData.get(b,i);c&&c(a)},k=function(a,b){var c=a.ownerDocument;q.utils.domData.get(c,h)||(q.utils.domData.set(c,h,!0),q.utils.registerEventHandler(c,"selectionchange",j)),q.utils.domData.set(a,i,b)};q.bindingHandlers.textInput={init:function(b,c,e){var h,i,j=b.value,l=function(d){clearTimeout(h),i=h=a;var f=b.value;j!==f&&(j=f,q.expressionRewriting.writeValueToProperty(c(),e,"textInput",f))},m=function(a){if(!h){i=b.value;var c=l;h=q.utils.setTimeout(c,4)}},n=9==q.utils.ieVersion?m:l,o=function(){var d=q.utils.unwrapObservable(c());if(null!==d&&d!==a||(d=""),i!==a&&d===i)return void q.utils.setTimeout(o,4);b.value!==d&&(j=d,b.value=d)},p=function(a,c){q.utils.registerEventHandler(b,a,c)};q.utils.ieVersion<10?(p("propertychange",function(a){"value"===a.propertyName&&n(a)}),8==q.utils.ieVersion&&(p("keyup",l),p("keydown",l)),q.utils.ieVersion>=8&&(k(b,n),p("dragend",m))):(p("input",l),f<5&&"textarea"===q.utils.tagNameLower(b)?(p("keydown",m),p("paste",m),p("cut",m)):d<11?p("keydown",m):g<4&&(p("DOMAutoComplete",l),p("dragdrop",l),p("drop",l))),p("change",l),q.computed(o,null,{disposeWhenNodeIsRemoved:b})}},q.expressionRewriting.twoWayBindings.textInput=!0,q.bindingHandlers.textinput={preprocess:function(a,b,c){c("textInput",a)}}}(),q.bindingHandlers.uniqueName={init:function(a,b){if(b()){var c="ko_unique_"+ ++q.bindingHandlers.uniqueName.currentIndex;q.utils.setElementName(a,c)}}},q.bindingHandlers.uniqueName.currentIndex=0,q.bindingHandlers.value={after:["options","foreach"],init:function(a,b,c){if("input"==a.tagName.toLowerCase()&&("checkbox"==a.type||"radio"==a.type))return void q.applyBindingAccessorsToNode(a,{checkedValue:b});var d=["change"],e=c.get("valueUpdate"),f=!1,g=null;e&&("string"==typeof e&&(e=[e]),q.utils.arrayPushAll(d,e),d=q.utils.arrayGetDistinctValues(d));var h=function(){g=null,f=!1;var d=b(),e=q.selectExtensions.readValue(a);q.expressionRewriting.writeValueToProperty(d,c,"value",e)};q.utils.ieVersion&&"input"==a.tagName.toLowerCase()&&"text"==a.type&&"off"!=a.autocomplete&&(!a.form||"off"!=a.form.autocomplete)&&-1==q.utils.arrayIndexOf(d,"propertychange")&&(q.utils.registerEventHandler(a,"propertychange",function(){f=!0}),q.utils.registerEventHandler(a,"focus",function(){f=!1}),q.utils.registerEventHandler(a,"blur",function(){f&&h()})),q.utils.arrayForEach(d,function(b){var c=h;q.utils.stringStartsWith(b,"after")&&(c=function(){g=q.selectExtensions.readValue(a),q.utils.setTimeout(h,0)},b=b.substring("after".length)),q.utils.registerEventHandler(a,b,c)});var i=function(){var d=q.utils.unwrapObservable(b()),e=q.selectExtensions.readValue(a);if(null!==g&&d===g)return void q.utils.setTimeout(i,0);if(d!==e)if("select"===q.utils.tagNameLower(a)){var f=c.get("valueAllowUnset"),h=function(){q.selectExtensions.writeValue(a,d,f)};h(),f||d===q.selectExtensions.readValue(a)?q.utils.setTimeout(h,0):q.dependencyDetection.ignore(q.utils.triggerEvent,null,[a,"change"])}else q.selectExtensions.writeValue(a,d)};q.computed(i,null,{disposeWhenNodeIsRemoved:a})},update:function(){}},q.expressionRewriting.twoWayBindings.value=!0,q.bindingHandlers.visible={update:function(a,b){var c=q.utils.unwrapObservable(b()),d=!("none"==a.style.display);c&&!d?a.style.display="":!c&&d&&(a.style.display="none")}},function(a){q.bindingHandlers[a]={init:function(b,c,d,e,f){var g=function(){var b={};return b[a]=c(),b};return q.bindingHandlers.event.init.call(this,b,g,d,e,f)}}}("click"),q.templateEngine=function(){},q.templateEngine.prototype.renderTemplateSource=function(a,b,c,d){throw new Error("Override renderTemplateSource")},q.templateEngine.prototype.createJavaScriptEvaluatorBlock=function(a){throw new Error("Override createJavaScriptEvaluatorBlock")},q.templateEngine.prototype.makeTemplateSource=function(a,b){if("string"==typeof a){b=b||c;var d=b.getElementById(a);if(!d)throw new Error("Cannot find template with ID "+a);return new q.templateSources.domElement(d)}if(1==a.nodeType||8==a.nodeType)return new q.templateSources.anonymousTemplate(a);throw new Error("Unknown template type: "+a)},q.templateEngine.prototype.renderTemplate=function(a,b,c,d){var e=this.makeTemplateSource(a,d);return this.renderTemplateSource(e,b,c,d)},q.templateEngine.prototype.isTemplateRewritten=function(a,b){return!1===this.allowTemplateRewriting||this.makeTemplateSource(a,b).data("isRewritten")},q.templateEngine.prototype.rewriteTemplate=function(a,b,c){var d=this.makeTemplateSource(a,c),e=b(d.text());d.text(e),d.data("isRewritten",!0)},q.exportSymbol("templateEngine",q.templateEngine),q.templateRewriting=function(){function a(a){for(var b=q.expressionRewriting.bindingRewriteValidators,c=0;c<a.length;c++){var d=a[c].key;if(b.hasOwnProperty(d)){var e=b[d];if("function"==typeof e){var f=e(a[c].value);if(f)throw new Error(f)}else if(!e)throw new Error("This template engine does not support the '"+d+"' binding within its templates")}}}function b(b,c,d,e){var f=q.expressionRewriting.parseObjectLiteral(b);a(f);var g=q.expressionRewriting.preProcessBindings(f,{valueAccessors:!0}),h="ko.__tr_ambtns(function($context,$element){return(function(){return{ "+g+" } })()},'"+d.toLowerCase()+"')";return e.createJavaScriptEvaluatorBlock(h)+c}var c=/(<([a-z]+\d*)(?:\s+(?!data-bind\s*=\s*)[a-z0-9\-]+(?:=(?:\"[^\"]*\"|\'[^\']*\'|[^>]*))?)*\s+)data-bind\s*=\s*(["'])([\s\S]*?)\3/gi,d=/<!--\s*ko\b\s*([\s\S]*?)\s*-->/g;return{ensureTemplateIsRewritten:function(a,b,c){b.isTemplateRewritten(a,c)||b.rewriteTemplate(a,function(a){return q.templateRewriting.memoizeBindingAttributeSyntax(a,b)},c)},memoizeBindingAttributeSyntax:function(a,e){return a.replace(c,function(){return b(arguments[4],arguments[1],arguments[2],e)}).replace(d,function(){return b(arguments[1],"\x3c!-- ko --\x3e","#comment",e)})},applyMemoizedBindingsToNextSibling:function(a,b){return q.memoization.memoize(function(c,d){var e=c.nextSibling;e&&e.nodeName.toLowerCase()===b&&q.applyBindingAccessorsToNode(e,a,d)})}}}(),q.exportSymbol("__tr_ambtns",q.templateRewriting.applyMemoizedBindingsToNextSibling),function(){function b(a){return q.utils.domData.get(a,e)||{}}function c(a,b){q.utils.domData.set(a,e,b)}q.templateSources={};q.templateSources.domElement=function(a){if(this.domElement=a,a){var b=q.utils.tagNameLower(a);this.templateType="script"===b?1:"textarea"===b?2:"template"==b&&a.content&&11===a.content.nodeType?3:4}},q.templateSources.domElement.prototype.text=function(){var a=1===this.templateType?"text":2===this.templateType?"value":"innerHTML";if(0==arguments.length)return this.domElement[a];var b=arguments[0];"innerHTML"===a?q.utils.setHtml(this.domElement,b):this.domElement[a]=b};var d=q.utils.domData.nextKey()+"_";q.templateSources.domElement.prototype.data=function(a){if(1===arguments.length)return q.utils.domData.get(this.domElement,d+a);q.utils.domData.set(this.domElement,d+a,arguments[1])};var e=q.utils.domData.nextKey();q.templateSources.domElement.prototype.nodes=function(){var d=this.domElement;if(0==arguments.length){return b(d).containerData||(3===this.templateType?d.content:4===this.templateType?d:a)}c(d,{containerData:arguments[0]})},q.templateSources.anonymousTemplate=function(a){this.domElement=a},q.templateSources.anonymousTemplate.prototype=new q.templateSources.domElement,q.templateSources.anonymousTemplate.prototype.constructor=q.templateSources.anonymousTemplate,q.templateSources.anonymousTemplate.prototype.text=function(){if(0==arguments.length){var d=b(this.domElement);return d.textData===a&&d.containerData&&(d.textData=d.containerData.innerHTML),d.textData}var e=arguments[0];c(this.domElement,{textData:e})},q.exportSymbol("templateSources",q.templateSources),q.exportSymbol("templateSources.domElement",q.templateSources.domElement),q.exportSymbol("templateSources.anonymousTemplate",q.templateSources.anonymousTemplate)}(),function(){function b(a,b,c){for(var d,e=a,f=q.virtualElements.nextSibling(b);e&&(d=e)!==f;)e=q.virtualElements.nextSibling(d),c(d,e)}function c(a,c){if(a.length){var d=a[0],e=a[a.length-1],f=d.parentNode,g=q.bindingProvider.instance,h=g.preprocessNode;if(h){if(b(d,e,function(a,b){var c=a.previousSibling,f=h.call(g,a);f&&(a===d&&(d=f[0]||b),a===e&&(e=f[f.length-1]||c))}),a.length=0,!d)return;d===e?a.push(d):(a.push(d,e),q.utils.fixUpContinuousNodeArray(a,f))}b(d,e,function(a){1!==a.nodeType&&8!==a.nodeType||q.applyBindings(c,a)}),b(d,e,function(a){1!==a.nodeType&&8!==a.nodeType||q.memoization.unmemoizeDomNodeAndDescendants(a,[c])}),q.utils.fixUpContinuousNodeArray(a,f)}}function d(a){return a.nodeType?a:a.length>0?a[0]:null}function e(a,b,e,f,g){g=g||{};var i=a&&d(a),j=(i||e||{}).ownerDocument,k=g.templateEngine||h;q.templateRewriting.ensureTemplateIsRewritten(e,k,j);var l=k.renderTemplate(e,f,g,j);if("number"!=typeof l.length||l.length>0&&"number"!=typeof l[0].nodeType)throw new Error("Template engine must return an array of DOM nodes");var m=!1;switch(b){case"replaceChildren":q.virtualElements.setDomNodeChildren(a,l),m=!0;break;case"replaceNode":q.utils.replaceDomNodes(a,l),m=!0;break;case"ignoreTargetNode":break;default:throw new Error("Unknown renderMode: "+b)}return m&&(c(l,f),g.afterRender&&q.dependencyDetection.ignore(g.afterRender,null,[l,f.$data])),l}function f(a,b,c){return q.isObservable(a)?a():"function"==typeof a?a(b,c):a}function g(b,c){var d=q.utils.domData.get(b,i);d&&"function"==typeof d.dispose&&d.dispose(),q.utils.domData.set(b,i,c&&c.isActive()?c:a)}var h;q.setTemplateEngine=function(b){if(b!=a&&!(b instanceof q.templateEngine))throw new Error("templateEngine must inherit from ko.templateEngine");h=b},q.renderTemplate=function(b,c,g,i,j){if(g=g||{},(g.templateEngine||h)==a)throw new Error("Set a template engine before calling renderTemplate");if(j=j||"replaceChildren",i){var k=d(i),l=function(){return!k||!q.utils.domNodeIsAttachedToDocument(k)},m=k&&"replaceNode"==j?k.parentNode:k;return q.dependentObservable(function(){var a=c&&c instanceof q.bindingContext?c:new q.bindingContext(q.utils.unwrapObservable(c)),h=f(b,a.$data,a),l=e(i,j,h,a,g);"replaceNode"==j&&(i=l,k=d(i))},null,{disposeWhen:l,disposeWhenNodeIsRemoved:m})}return q.memoization.memoize(function(a){q.renderTemplate(b,c,g,a,"replaceNode")})},q.renderTemplateForEach=function(b,d,g,h,i){var j,k=function(a,c){return j=i.createChildContext(a,g.as,function(a){a.$index=c}),e(null,"ignoreTargetNode",f(b,a,j),j,g)},l=function(a,b,d){c(b,j),g.afterRender&&g.afterRender(b,a),j=null};return q.dependentObservable(function(){var b=q.utils.unwrapObservable(d)||[];void 0===b.length&&(b=[b]);var c=q.utils.arrayFilter(b,function(b){return g.includeDestroyed||b===a||null===b||!q.utils.unwrapObservable(b._destroy)});q.dependencyDetection.ignore(q.utils.setDomNodeChildrenFromArrayMapping,null,[h,c,k,g,l])},null,{disposeWhenNodeIsRemoved:h})};var i=q.utils.domData.nextKey();q.bindingHandlers.template={init:function(a,b){var c=q.utils.unwrapObservable(b());if("string"==typeof c||c.name)q.virtualElements.emptyNode(a);else if("nodes"in c){var d=c.nodes||[];if(q.isObservable(d))throw new Error('The "nodes" option must be a plain, non-observable array.');var e=q.utils.moveCleanedNodesToContainerElement(d);new q.templateSources.anonymousTemplate(a).nodes(e)}else{var f=q.virtualElements.childNodes(a),e=q.utils.moveCleanedNodesToContainerElement(f);new q.templateSources.anonymousTemplate(a).nodes(e)}return{controlsDescendantBindings:!0}},update:function(a,b,c,d,e){var f,h,i=b(),j=q.utils.unwrapObservable(i),k=!0,l=null;if("string"==typeof j?(h=i,j={}):(h=j.name,"if"in j&&(k=q.utils.unwrapObservable(j.if)),k&&"ifnot"in j&&(k=!q.utils.unwrapObservable(j.ifnot)),f=q.utils.unwrapObservable(j.data)),"foreach"in j){var m=k&&j.foreach||[];l=q.renderTemplateForEach(h||a,m,j,a,e)}else if(k){var n="data"in j?e.createChildContext(f,j.as):e;l=q.renderTemplate(h||a,n,j,a)}else q.virtualElements.emptyNode(a);g(a,l)}},q.expressionRewriting.bindingRewriteValidators.template=function(a){var b=q.expressionRewriting.parseObjectLiteral(a);return 1==b.length&&b[0].unknown?null:q.expressionRewriting.keyValueArrayContainsKey(b,"name")?null:"This template engine does not support anonymous templates nested within its templates"},q.virtualElements.allowedBindings.template=!0}(),q.exportSymbol("setTemplateEngine",q.setTemplateEngine),q.exportSymbol("renderTemplate",q.renderTemplate),q.utils.findMovesInArrayComparison=function(a,b,c){if(a.length&&b.length){var d,e,f,g,h;for(d=e=0;(!c||d<c)&&(g=a[e]);++e){for(f=0;h=b[f];++f)if(g.value===h.value){g.moved=h.index,h.moved=g.index,b.splice(f,1),d=f=0;break}d+=f}}},q.utils.compareArrays=function(){function a(a,e,f){return f="boolean"==typeof f?{dontLimitMoves:f}:f||{},a=a||[],e=e||[],a.length<e.length?b(a,e,c,d,f):b(e,a,d,c,f)}function b(a,b,c,d,e){var f,g,h,i,j,k,l=Math.min,m=Math.max,n=[],o=a.length,p=b.length,r=p-o||1,s=o+p+1;for(f=0;f<=o;f++)for(i=h,n.push(h=[]),j=l(p,f+r),k=m(0,f-1),g=k;g<=j;g++)if(g)if(f)if(a[f-1]===b[g-1])h[g]=i[g-1];else{var t=i[g]||s,u=h[g-1]||s;h[g]=l(t,u)+1}else h[g]=g+1;else h[g]=f+1;var v,w=[],x=[],y=[];for(f=o,g=p;f||g;)v=n[f][g]-1,g&&v===n[f][g-1]?x.push(w[w.length]={status:c,value:b[--g],index:g}):f&&v===n[f-1][g]?y.push(w[w.length]={status:d,value:a[--f],index:f}):(--g,--f,e.sparse||w.push({status:"retained",value:b[g]}));return q.utils.findMovesInArrayComparison(y,x,!e.dontLimitMoves&&10*o),w.reverse()}var c="added",d="deleted";return a}(),q.exportSymbol("utils.compareArrays",q.utils.compareArrays),function(){function b(b,c,d,e,f){var g=[],h=q.dependentObservable(function(){var a=c(d,f,q.utils.fixUpContinuousNodeArray(g,b))||[];g.length>0&&(q.utils.replaceDomNodes(g,a),e&&q.dependencyDetection.ignore(e,null,[d,a,f])),g.length=0,q.utils.arrayPushAll(g,a)},null,{disposeWhenNodeIsRemoved:b,disposeWhen:function(){return!q.utils.anyDomNodeIsAttachedToDocument(g)}});return{mappedNodes:g,dependentObservable:h.isActive()?h:a}}var c=q.utils.domData.nextKey(),d=q.utils.domData.nextKey();q.utils.setDomNodeChildrenFromArrayMapping=function(e,f,g,h,i){function j(a,b){l=p[b],v!==b&&(z[a]=l),l.indexObservable(v++),q.utils.fixUpContinuousNodeArray(l.mappedNodes,e),t.push(l),x.push(l)}function k(a,b){if(a)for(var c=0,d=b.length;c<d;c++)b[c]&&q.utils.arrayForEach(b[c].mappedNodes,function(d){a(d,c,b[c].arrayEntry)})}f=f||[],h=h||{};for(var l,m,n,o=q.utils.domData.get(e,c)===a,p=q.utils.domData.get(e,c)||[],r=q.utils.arrayMap(p,function(a){return a.arrayEntry}),s=q.utils.compareArrays(r,f,h.dontLimitMoves),t=[],u=0,v=0,w=[],x=[],y=[],z=[],A=[],B=0;m=s[B];B++)switch(n=m.moved,m.status){case"deleted":n===a&&(l=p[u],l.dependentObservable&&(l.dependentObservable.dispose(),l.dependentObservable=a),q.utils.fixUpContinuousNodeArray(l.mappedNodes,e).length&&(h.beforeRemove&&(t.push(l),x.push(l),l.arrayEntry===d?l=null:y[B]=l),l&&w.push.apply(w,l.mappedNodes))),u++;break;case"retained":j(B,u++);break;case"added":n!==a?j(B,n):(l={arrayEntry:m.value,indexObservable:q.observable(v++)},t.push(l),x.push(l),o||(A[B]=l))}q.utils.domData.set(e,c,t),k(h.beforeMove,z),q.utils.arrayForEach(w,h.beforeRemove?q.cleanNode:q.removeNode);for(var C,D,B=0,E=q.virtualElements.firstChild(e);l=x[B];B++){l.mappedNodes||q.utils.extend(l,b(e,g,l.arrayEntry,i,l.indexObservable));for(var F=0;D=l.mappedNodes[F];E=D.nextSibling,C=D,F++)D!==E&&q.virtualElements.insertAfter(e,D,C);!l.initialized&&i&&(i(l.arrayEntry,l.mappedNodes,l.indexObservable),l.initialized=!0)}for(k(h.beforeRemove,y),B=0;B<y.length;++B)y[B]&&(y[B].arrayEntry=d);k(h.afterMove,z),k(h.afterAdd,A)}}(),q.exportSymbol("utils.setDomNodeChildrenFromArrayMapping",q.utils.setDomNodeChildrenFromArrayMapping),q.nativeTemplateEngine=function(){this.allowTemplateRewriting=!1},q.nativeTemplateEngine.prototype=new q.templateEngine,q.nativeTemplateEngine.prototype.constructor=q.nativeTemplateEngine,q.nativeTemplateEngine.prototype.renderTemplateSource=function(a,b,c,d){var e=!(q.utils.ieVersion<9),f=e?a.nodes:null,g=f?a.nodes():null;if(g)return q.utils.makeArray(g.cloneNode(!0).childNodes);var h=a.text();return q.utils.parseHtmlFragment(h,d)},q.nativeTemplateEngine.instance=new q.nativeTemplateEngine,q.setTemplateEngine(q.nativeTemplateEngine.instance),q.exportSymbol("nativeTemplateEngine",q.nativeTemplateEngine),function(){q.jqueryTmplTemplateEngine=function(){function a(){if(d<2)throw new Error("Your version of jQuery.tmpl is too old. Please upgrade to jQuery.tmpl 1.0.0pre or later.")}function b(a,b,c){return e.tmpl(a,b,c)}var d=this.jQueryTmplVersion=function(){if(!e||!e.tmpl)return 0;try{if(e.tmpl.tag.tmpl.open.toString().indexOf("__")>=0)return 2}catch(a){}return 1}();this.renderTemplateSource=function(d,f,g,h){h=h||c,g=g||{},a();var i=d.data("precompiled");if(!i){var j=d.text()||"";j="{{ko_with $item.koBindingContext}}"+j+"{{/ko_with}}",i=e.template(null,j),d.data("precompiled",i)}var k=[f.$data],l=e.extend({koBindingContext:f},g.templateOptions),m=b(i,k,l);return m.appendTo(h.createElement("div")),e.fragments={},m},this.createJavaScriptEvaluatorBlock=function(a){return"{{ko_code ((function() { return "+a+" })()) }}"},this.addTemplate=function(a,b){c.write("<script type='text/html' id='"+a+"'>"+b+"<\/script>")},d>0&&(e.tmpl.tag.ko_code={open:"__.push($1 || '');"},e.tmpl.tag.ko_with={open:"with($1) {",close:"} "})},q.jqueryTmplTemplateEngine.prototype=new q.templateEngine,q.jqueryTmplTemplateEngine.prototype.constructor=q.jqueryTmplTemplateEngine;var a=new q.jqueryTmplTemplateEngine;a.jQueryTmplVersion>0&&q.setTemplateEngine(a),q.exportSymbol("jqueryTmplTemplateEngine",q.jqueryTmplTemplateEngine)}()})}()}(),Array.prototype.forEach||(Array.prototype.forEach=function(a,b){var c,d;if(null==this)throw new TypeError(" this is null or not defined");var e=Object(this),f=e.length>>>0;if("function"!=typeof a)throw new TypeError(a+" is not a function");for(arguments.length>1&&(c=b),d=0;d<f;){var g;d in e&&(g=e[d],a.call(c,g,d,e)),d++}}),Array.prototype.reduce||(Array.prototype.reduce=function(a){if(null==this)throw new TypeError("Array.prototype.reduce called on null or undefined");if("function"!=typeof a)throw new TypeError(a+" is not a function");var b,c=Object(this),d=c.length>>>0,e=0;if(2==arguments.length)b=arguments[1];else{for(;e<d&&!(e in c);)e++;if(e>=d)throw new TypeError("Reduce of empty array with no initial value");b=c[e++]}for(;e<d;e++)e in c&&(b=a(b,c[e],e,c));return b}),function(){var a=Function.bind.call(Function.call,Array.prototype.reduce),b=Function.bind.call(Function.call,Object.prototype.propertyIsEnumerable),c=Function.bind.call(Function.call,Array.prototype.concat),d=function(a){var b,c=[];for(b in a)a.hasOwnProperty(b)&&c.push(b);return c};Object.values||(Object.values=function(e){return a(d(e),function(a,d){return c(a,"string"==typeof d&&b(e,d)?[e[d]]:[])},[])}),Object.entries||(Object.entries=function(e){return a(d(e),function(a,d){return c(a,"string"==typeof d&&b(e,d)?[[d,e[d]]]:[])},[])})}(),Function.prototype.bind||(Function.prototype.bind=function(a){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var b=Array.prototype.slice.call(arguments,1),c=this,d=function(){},e=function(){return c.apply(this instanceof d?this:a,b.concat(Array.prototype.slice.call(arguments)))};return this.prototype&&(d.prototype=this.prototype),e.prototype=new d,e}),Array.prototype.find||Object.defineProperty(Array.prototype,"find",{value:function(a){if(null==this)throw new TypeError('"this" is null or not defined');var b=Object(this),c=b.length>>>0;if("function"!=typeof a)throw new TypeError("predicate must be a function");for(var d=arguments[1],e=0;e<c;){var f=b[e];if(a.call(d,f,e,b))return f;e++}}}),Array.from||(Array.from=function(){var a=Object.prototype.toString,b=function(b){return"function"==typeof b||"[object Function]"===a.call(b)},c=function(a){var b=Number(a);return isNaN(b)?0:0!==b&&isFinite(b)?(b>0?1:-1)*Math.floor(Math.abs(b)):b},d=Math.pow(2,53)-1,e=function(a){var b=c(a);return Math.min(Math.max(b,0),d)};return function(a){var c=this,d=Object(a);if(null==a)throw new TypeError("Array.from requires an array-like object - not null or undefined");var f,g=arguments.length>1?arguments[1]:void 0;if(void 0!==g){
if(!b(g))throw new TypeError("Array.from: when provided, the second argument must be a function");arguments.length>2&&(f=arguments[2])}for(var h,i=e(d.length),j=b(c)?Object(new c(i)):new Array(i),k=0;k<i;)h=d[k],j[k]=g?void 0===f?g(h,k):g.call(f,h,k):h,k+=1;return j.length=i,j}}());var J=function(){function a(a){throw new RangeError(t[a])}function b(a,b){for(var c=a.length,d=[];c--;)d[c]=b(a[c]);return d}function c(a,c){var d=a.split("@"),e="";return d.length>1&&(e=d[0]+"@",a=d[1]),a=a.replace(s,"."),e+b(a.split("."),c).join(".")}function d(a){return b(a,function(a){var b="";return a>65535&&(a-=65536,b+=w(a>>>10&1023|55296),a=56320|1023&a),b+=w(a)}).join("")}function e(a){return a-48<10?a-22:a-65<26?a-65:a-97<26?a-97:j}function f(a,b,c){var d=0;for(a=c?v(a/n):a>>1,a+=v(a/b);a>u*l>>1;d+=j)a=v(a/u);return v(d+(u+1)*a/(a+m))}function g(b){var c,g,h,m,n,r,s,t,u,w,x=[],y=b.length,z=0,A=p,B=o;for(g=b.lastIndexOf(q),g<0&&(g=0),h=0;h<g;++h)b.charCodeAt(h)>=128&&a("not-basic"),x.push(b.charCodeAt(h));for(m=g>0?g+1:0;m<y;){for(n=z,r=1,s=j;m>=y&&a("invalid-input"),t=e(b.charCodeAt(m++)),(t>=j||t>v((i-z)/r))&&a("overflow"),z+=t*r,u=s<=B?k:s>=B+l?l:s-B,!(t<u);s+=j)w=j-u,r>v(i/w)&&a("overflow"),r*=w;c=x.length+1,B=f(z-n,c,0==n),v(z/c)>i-A&&a("overflow"),A+=v(z/c),z%=c,x.splice(z++,0,A)}return d(x)}function h(a){return c(a,function(a){return r.test(a)?g(a.slice(4).toLowerCase()):a})}var i=2147483647,j=36,k=1,l=26,m=38,n=700,o=72,p=128,q="-",r=/^xn--/,s=/[\x2E\u3002\uFF0E\uFF61]/g,t={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},u=j-k,v=Math.floor,w=String.fromCharCode;return{version:"1.4.1",ucs2:{encode:d},decode:g,toUnicode:h}}(),K=function(a,b){return CBHCore.lang.translate(a,b)},L=function(a){this.__=a};L.prototype._=function(a){return void 0===a||null===a?"":a},L.prototype.background=function(a){a=a||{};return'\x3c!-- ko if: hasCarrousel --\x3e<div class="bg animated" data-bind="css: {fallback: fallback,active: !oddCounter()}"><div data-bind="style: {backgroundImage: backgroundImage}"></div></div><div class="bg animated" data-bind="css: {fallback: fallback,active: oddCounter}"><div data-bind="style: {backgroundImage: backgroundImageNext}"></div></div>\x3c!-- /ko --\x3e\x3c!-- ko ifnot: hasCarrousel --\x3e<div class="bg active"><div data-bind="style: {backgroundImage: backgroundImage,backgroundColor: backgroundColor}"></div></div>\x3c!-- /ko --\x3e'},L.prototype.builtin=function(a){a=a||{};var b=this;return'<div class="chat-header"><div class="person-meta" data-bind="style: {backgroundImage: $root.sliderBackgroundImage,backgroundColor: $root.sliderBackgroundColor,color: $root.sliderTextColor}"><div class="img" data-bind="style: { backgroundImage: manager.avatar }, css: { \'custom\': manager.avatar() }"></div><div class="h2" data-bind="text: manager.name"></div><div class="p">'+b.__("builtin.manager_title",a)+'</div></div></div><div class="chat-body" data-bind="ref: msgContainer,css: {empty: messages().length === 0},event: {scroll: onScroll}"><ul><li class="bg" data-bind="style: { minHeight: (parseInt($root.builtinHeight()) - 151) + \'px\' }"></li>\x3c!-- ko foreach: messages --\x3e<li class="chat-msg" data-bind="css: {\'manager\': !own,\'inner\': position() === \'inner\',\'only\': position() === \'only\',\'first\': position() === \'first\' || position() === \'only\',\'last\': position() === \'last\'}"><div class="day" data-bind="text: day, visible: day"></div><div class="msg-container">\x3c!-- ko if: !own && (position() === \'last\' || position() === \'only\') --\x3e<div class="avatar" data-bind="style: {backgroundImage: $parent.manager.avatar},css: {\'custom\':  $parent.manager.avatar}"></div>\x3c!-- /ko --\x3e<div class="msg" data-bind="html: text"></div><div class="ts" data-bind="text: time"></div></div></li>\x3c!-- /ko --\x3e</ul></div><div class="chat-text-field"><input type="text" placeholder="'+b.__("builtin.prompt",a)+'" data-bind="hasFocus: inputFocused,textInput: message,event: {keypress: onKeypress}"/><div class="controls"><div class="send" data-bind="click: send"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M2 21l21-9L2 3v7l15 2-15 2v7z"/></svg></div></div></div>\x3c!-- ko component: {params: { key: "builtin" },name: "powered-by"} --\x3e\x3c!-- /ko --\x3e'},L.prototype.button=function(a){a=a||{};return'<div class="buttons" data-bind="css: {\'left-side\': [\'tl\', \'bl\'].indexOf(quadrant()) !== -1,catch: caught}">\x3c!-- ko component: {name: "main-button",params: {caught: caught,activeSlide: activeSlide,sliderOpen: sliderOpen,sliderOpenedByDelay: sliderOpenedByDelay,changeSliderOpenState: changeSliderOpenState,sliderVisible: sliderVisible,channelsVisible: channelsVisible,priorityChannel: priorityChannel,hasChats: hasChats,hasCalls: hasCalls}} --\x3e\x3c!-- /ko --\x3e<div class="channels" data-bind="visible: sliderOpen() && channelsVisible(),component: {name: \'channels\',params: {visible: caught() || commList.length > 1 || hasCalls && commList.length > 0,caught: caught,channels: commList,deeplinks: deeplinks,activeSlide: activeSlide,activeSocial: activeSocial,sliderOpen: sliderOpen,sliderOpenedByDelay: sliderOpenedByDelay,changeSliderOpenState: changeSliderOpenState}}"></div></div>'},L.prototype.channels=function(a){a=a||{};return"<ul data-bind=\"visible: visible,foreach: channels,css: {'active': $root.sliderOpen()}\"><li data-bind=\"attr: {'class': ['channel-icon',$data.name + '-icon',(!$parent.denyActiveButtonState&& ($root.activeSlide() === $data.name|| ($root.activeSlide() === 'social' && $root.activeSocial() === $data.name))) ? 'active' : ''].join(' ')},click: $data.action\">\x3c!-- ko if: $data.name === 'builtin' && $root.unreadMessagesCount() > 0 --\x3e\x3c!-- ko component: {params: { count: $root.unreadMessagesCount },name: \"unread-messages-counter\"} --\x3e\x3c!-- /ko --\x3e\x3c!-- /ko --\x3e</li></ul>"},L.prototype.checkbox=function(a){a=a||{};return'<div class="checkbox-container"><input type="checkbox" data-bind="attr: { id: id }, checked: checked"/><label data-bind="attr: { for: id }, html: text"></label></div>'},L.prototype.email=function(a){a=a||{};var b=this;return'<div class="chat-header"><div class="person-meta" data-bind="style: {backgroundImage: $root.sliderBackgroundImage,backgroundColor: $root.sliderBackgroundColor,color: $root.sliderTextColor}"><div class="img"></div><div class="p">'+b.__("email.title",a)+'</div></div></div><div class="email-body">\x3c!-- ko if: activeSubslide() === \'email_exit\' --\x3e<div class="overlay"><div class="title">'+b.__("email.you_sure",a)+'</div><div class="buttons"><div class="button"><button class="empty" data-bind="click: close">'+b.__("email.yes_close",a)+'</button></div><div class="button"><button data-bind="click: show">'+b.__("email.no_close",a)+'</button></div></div></div>\x3c!-- /ko --\x3e<div class="content" data-bind="css: { blur: activeSubslide() === \'email_exit\' }"><div class="textarea" data-bind="css: {required: emailText().length === 0,error: !textOk() && sendAttempt()}"><div class="placeholder" data-bind="if: emailText().length === 0">'+b.__("email.text_placeholder",a)+'</div><textarea data-bind="textInput: emailText"></textarea></div><div class="text" data-bind="css: {required: user.email().length === 0,error: !emailOk() && sendAttempt()}"><div class="placeholder" data-bind="if: user.email().length === 0">'+b.__("email.email_placeholder",a)+'</div><input type="email" name="email" autocomplete="on" data-bind="textInput: user.email"/></div><div class="text"><input type="text" name="name" autocomplete="on" data-bind="attr: { placeholder: __(\'email.name_placeholder\') },textInput: user.name"/></div><div class="text"><input type="tel" data-bind="masked: user.phone"/></div><div class="buttons" data-bind="visible: activeSubslide() !== \'email_exit\'"><div class="button"><button data-bind="enable: dataAgreement,click: send">'+b.__("email.send",a)+'</button></div><div class="data-collection" data-bind="component: {name: \'checkbox\',params: {checked: dataAgreement,text: $root.showDataCollectionText}}"></div></div></div></div>\x3c!-- ko component: {params: { key: "email" },name: "powered-by"} --\x3e\x3c!-- /ko --\x3e'},L.prototype["main-button"]=function(a){a=a||{};return"\x3c!-- ko if: sliderOpen --\x3e<div class=\"main-button close\" data-bind=\"click: closeSlider\"></div>\x3c!-- /ko --\x3e\x3c!-- ko if: !sliderOpen() || hasCalls --\x3e<div class=\"main-button\" data-bind=\"ref: $root.mainButtonRef,css: {'active': !sliderOpen() || activeSlide() === 'callback','slider-open': sliderOpen() || !channelsVisible(),'callback': alternativeButton() && hasCalls,'logo': alternativeButton() && !hasCalls,'custom-logo': alternativeButton() && !hasCalls && customBrandLogo()},style: { backgroundImage: (alternativeButton() && !hasCalls) ? customBrandLogo : '' },click: click\">\x3c!-- ko component: {params: { count: $root.unreadMessagesCount },name: \"unread-messages-counter\"} --\x3e\x3c!-- /ko --\x3e\x3c!-- ko foreach: callbackIcons --\x3e<i data-bind=\"attr: {'class': ['icon',$data,$data === 'logo' && $parent.customBrandLogo() ? 'custom' : '',($parent.rotatingCallIcon() === $data) ? 'rotate-icon' : ''].join(' ')},style: { backgroundImage: $data === 'logo' ? $parent.customBrandLogo : '' }\"></i>\x3c!-- /ko --\x3e</div>\x3c!-- /ko --\x3e"},L.prototype.main=function(a){a=a||{};return"<div class=\"cbh-body-fade\" data-bind=\"visible: caught() && catchVisible(),click: closeCatchDialog\"></div><div class=\"cbh-slider\" data-bind=\"ref: builtinRef,visible: caught() || positioningFinished() && isSliderAllowed() && sliderOpen(),css: {'cbh-builtin': activeSlide() === 'builtin' || activeSlide() === 'email','cbh-fixed': isFixedButton,'cbh-catch': caught},style: {height: (activeSlide() === 'builtin' || activeSlide() === 'email') ? builtinHeight() : null,bottom: sliderBottom(),top: sliderTop(),right: sliderRight(),left: sliderLeft()}\"></div><div class=\"cbh-button\" data-bind=\"visible: isMainButtonsPlankVisible(),style: {width: (sliderWidth() + 8) + 'px',height: (btnSize() + 8) + 'px',bottom: bottom(),top: top(),right: right(),left: left()},css: {'cbh-only-button': !sliderOpen(),'cbh-fixed': isFixedButton,'cbh-catch': caught}\"><div class=\"cbh-ph-circle\"></div><div class=\"cbh-ph-circle-fill\"></div></div>"},L.prototype["powered-by"]=function(a){a=a||{};return'\x3c!-- ko if: showPoweredBy --\x3e<div class="powered-by" data-bind="html: poweredByContent, click: poweredByClicked"></div>\x3c!-- /ko --\x3e'},L.prototype.rating=function(a){a=a||{};return'<ul class="rating" data-bind="foreach: [1,2,3,4,5]"><li data-bind="click: $parent.onRate.bind($parent),style: { color: $parent.textColor }"></li></ul>'},L.prototype.select=function(a){a=a||{};return'<div class="select" data-bind="click: showPopup"><select><option data-bind="text: selectedText"></option></select></div><ul class="select-popup" data-bind="visible: popupVisible, foreach: options"><li data-bind="text: text, click: $parent.pick.bind($parent)"></li></ul>'},L.prototype.slider__index=function(a){return a=a||{},'\x3c!-- ko component: {params: {backgroundImage: backgroundImage,backgroundColor: backgroundColor,textColor: textColor,caught: caught},name: "background"} --\x3e\x3c!-- /ko --\x3e<i class="logo" data-bind="style: {backgroundImage: logoImage},visible: activeSubslide() !== \'sms_mesage\',css: {social: showSocialAvatar,custom: logoImage}"></i><div class="body">\x3c!-- ko if: content --\x3e<div class="content" data-bind="template: content"></div>\x3c!-- /ko --\x3e</div><div class="footer"><div class="data-collection" data-bind="component: {name: \'checkbox\',params: {checked: dataAgreement,text: $root.showDataCollectionText}}"></div>\x3c!-- ko component: {params: { key: \'slider\' },name: "powered-by"} --\x3e\x3c!-- /ko --\x3e</div>'+this._(a.templates)},L.prototype.slider_call_later=function(a){a=a||{};var b=this;return'<div class="title" data-bind="text: title,style: { color: textColor }"></div><div class="form"><div class="form-row"><div class="pick day" data-bind="component: {name: \'select\',params: {options: availableDays,selected: selectedDay}}"></div><div class="pick time" data-bind="component: {name: \'select\',params: {options: availableHours,selected: selectedHour}}"></div><div class="buttons-block">\x3c!-- ko if: allowTimeSelection --\x3e<button class="call-now" data-bind="click: showCommunicationSlide,style: { color: textColor }">'+b.__("slider.call_later.call_now",a)+'</button>\x3c!-- /ko --\x3e<button data-bind="click: callDeferred">'+b.__("slider.call_later.button",a)+"</button></div></div></div>"},L.prototype.slider_call_now=function(a){return a=a||{},'<div class="title" data-bind="text: title,style: { color: textColor }"></div><div class="form"><div class="form-row"><input type="tel" data-bind="masked: user.phone"/><div class="buttons-block">\x3c!-- ko if: allowTimeSelection --\x3e<button class="pick-time" data-bind="click: callLater,style: { color: textColor }">'+this.__("slider.call_now.pick_time",a)+"</button>\x3c!-- /ko --\x3e<button data-bind=\"enable: callAllowed,click: call,text: caught() ? ___('catch.waiting_call') : ___('slider.waiting_call')\"></button></div></div></div>"},L.prototype.slider_social=function(a){a=a||{};return'<div class="form"><div class="form-row"><div class="social"><div class="text" data-bind="html: text,style: { color: textColor }"></div><div class="buttons-block"><button data-bind="attr: { \'class\': activeSocial },click: socialButtonOnClick(),text: socialButtonText"></button></div></div></div></div>'},L.prototype.slider=function(a){a=a||{};return"<div class=\"builtin-container\" data-bind=\"visible: slideVisible('builtin'),component: {name: 'builtin',params: {enabled: builtinChatEnabled,unreadMessagesCount: unreadMessagesCount,visible: slideVisible('builtin'),user: user}}\"></div><div class=\"email-container\" data-bind=\"visible: slideVisible('email'),component: {name: 'email',params: {user: user,sliderOpen: sliderOpen,channelsVisible: channelsVisible,activeSlide: activeSlide,activeSubslide: activeSubslide}}\"></div><div class=\"slider\" data-bind=\"visible: caught() || isSliderAllowed() && slideInvisible('builtin')() && slideInvisible('email')() && sliderVisible(),css: { catch: caught },component: {name: 'slider',params: {visible: slideInvisible('builtin') && slideInvisible('email'),channelsVisible: channelsVisible}}\"></div>"},L.prototype["unread-messages-counter"]=function(a){a=a||{};return"<i class='cbh-new-messages' data-bind=\"text: unreadMessagesPresentation,css: {'cbh-visible': visible}\"></i>"},L.prototype.widget_call_disabled=function(a){return a=a||{},'<div class="title" data-bind="style: { color: textColor }"><div data-bind="html: title"></div><div class="sub_title" data-bind="visible: channels.length > 1">'+this.__("slider.call_disabled.sub_title",a)+"</div></div>"},L.prototype.widget_call_failure=function(a){a=a||{};var b=this;return'<div class="title" data-bind="text: __(\'call_failure.title\'),style: { color: textColor }"></div><div class="form"><div class="form-row"><button data-bind="click: showCommunicationSlide" class="yes">'+b.__("yes",a)+'</button><button class="no empty" data-bind="click: close,style: { color: textColor }">'+b.__("close",a)+"</button></div></div>"},L.prototype.widget_call_free_success=function(a){return a=a||{},'<div class="title no-margin" data-bind="text: __(\'free_success.title\'),style: { color: textColor }"></div><div class="form"><div class="form-row"><div class="buttons-block"><button data-bind="click: afterSuccess">'+this.__("close_widget",a)+"</button></div></div></div>"},L.prototype.widget_call_later_success=function(a){return a=a||{},'<div class="title" data-bind="text: title,style: { color: textColor }"></div><div class="form"><div class="form-row"><div class="text" data-bind="text: text,style: { color: textColor }"></div><div class="buttons-block"><button data-bind="click: afterSuccess">'+this.__("close_widget",a)+"</button></div></div></div>"},L.prototype.widget_call_rating=function(a){a=a||{};return'<div class="title" data-bind="text: __(\'rating.title\'),style: { color: textColor }"></div>\x3c!-- ko component: {name: \'rating\',params: {onRate: onRate.bind($data),textColor: textColor}} --\x3e\x3c!-- /ko --\x3e<div class="text" data-bind="text: __(\'rating.text\'),style: { color: textColor }"></div>'},L.prototype.widget_call_result=function(a){a=a||{};var b=this;return'<div class="title" data-bind="text: __(\'call_result.title\'),style: { color: textColor }"></div><div class="form"><div class="form-row"><button data-bind="click: callSuccess" class="yes">'+b.__("yes",a)+'</button><button class="no empty" data-bind="click: callFailure,style: { color: textColor }">'+b.__("no",a)+"</button></div></div>"},L.prototype.widget_call_timer=function(a){a=a||{};return'<div class="title" data-bind="text: title,style: { color: textColor }"></div><div class="timer" data-bind="countdown: countdown,style: { color: textColor }"></div>'},L.prototype.widget_catch=function(a){a=a||{};var b=this;return'<div class="title" data-bind="style: { color: textColor }"><div data-bind="html: title"></div><div style="line-height: 1.1;">'+b.__("catch.main.title_static",a)+'</div></div><div class="form" style="margin-top: 1px;"><div class="form-row"><button class="yes" data-bind="click: prioritySocial">'+b.__("yes",a)+'</button><button class="no empty" data-bind="click: prioritySocial,style: { color: textColor }">'+b.__("no",a)+"</button></div></div>"},L.prototype.widget_email_failure=function(a){a=a||{};return'<div class="title" data-bind="text: ___(\'email.failure\'),style: { color: textColor }"></div><div class="form"><div class="form-row"><button class="long" data-bind="click: email,text: ___(\'email.again_failure\')"></button><button class="no empty standard-width" data-bind="click: close,text: ___(\'email.close\'),style: { color: textColor }"></button></div></div>'},L.prototype.widget_email_success=function(a){a=a||{};return'<div class="title" data-bind="text: ___(\'email.success\'),style: { color: textColor }"></div><div class="form"><div class="form-row"><button class="no empty standard-width" data-bind="click: close,text: ___(\'email.close\'),style: { color: textColor }"></button></div></div>'},L.prototype.widget_enter_phone=function(a){return a=a||{},'<div class="title" data-bind="text: title,style: { color: textColor }"></div><div class="form"><div class="form-row"><input type="tel" data-bind="masked: user.phone"/><div class="buttons-block"><button data-bind="enable: callAllowed, click: next()">'+this.__("slider.waiting_call",a)+"</button></div></div></div>"},L.prototype.widget_select_office=function(a){a=a||{};return'<div class="title" data-bind="text: title,style: { color: textColor }"></div><div class="form"><div class="form-row"><div class="pick office" data-bind="component: {name: \'select\',params: {options: officeSelectionList,selected: selectedOffice}}"></div><div class="buttons-block"><button data-bind="click: next(),text: __(\'select_office.button\')"></button></div></div></div>'},L.prototype.widget_sms_failure=function(a){a=a||{};return'<div class="title" data-bind="text: __(\'sms_failure.title\'),style: { color: textColor }"></div><div class="form"><div class="form-row"><button class="long" data-bind="click: smsPhone,text: __(\'sms_failure.again\')"></button><button class="no empty standard-width" data-bind="click: close,text: __(\'sms_failure.close\'),style: { color: textColor }"></button></div></div>'},L.prototype.widget_sms_message=function(a){a=a||{};return'<div class="form"><div class="form-row"><div class="textarea-container"><div class="textarea"><textarea data-bind="attr: { placeholder: __(\'sms_phone.placeholder\') },textInput: smsText"></textarea></div><button class="floated" data-bind="enable: callAllowed() && smsAllowed(),click: sms,text: __(\'sms_phone.send\')"></button></div></div></div>'},L.prototype.widget_sms_phone=function(a){a=a||{};return'<div class="title" data-bind="text: __(\'sms_phone.title\'),style: { color: textColor }"></div><div class="form"><div class="form-row"><input type="tel" data-bind="masked: user.phone"/><div class="buttons-block"><button data-bind="enable: callAllowed,click: smsMessage,text: __(\'sms_phone.button\')"></button></div></div></div>'},L.prototype.widget_sms_success=function(a){a=a||{};return'<div class="title" data-bind="text: __(\'sms_success.title\'),style: { color: textColor }"></div><div class="form"><div class="form-row"><button class="empty long" data-bind="click: smsPhone,text: __(\'sms_success.again\'),style: { color: textColor }"></button><button data-bind="click: close,text: __(\'sms_success.close\')"></button></div></div>'};var M=new L(K),N=CBHCore.db_params;N.valueEquals=function(a,b){return void 0!==N[a]&&N[a]===b};var O="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},P=(function(){var a="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103}(),function(){function a(a){this.value=a}function b(b){function c(a,b){return new Promise(function(c,e){var h={key:a,arg:b,resolve:c,reject:e,next:null};g?g=g.next=h:(f=g=h,d(a,b))})}function d(c,f){try{var g=b[c](f),h=g.value;h instanceof a?Promise.resolve(h.value).then(function(a){d("next",a)},function(a){d("throw",a)}):e(g.done?"return":"normal",g.value)}catch(a){e("throw",a)}}function e(a,b){switch(a){case"return":f.resolve({value:b,done:!0});break;case"throw":f.reject(b);break;default:f.resolve({value:b,done:!1})}f=f.next,f?d(f.key,f.arg):g=null}var f,g;this._invoke=c,"function"!=typeof b.return&&(this.return=void 0)}"function"==typeof Symbol&&Symbol.asyncIterator&&(b.prototype[Symbol.asyncIterator]=function(){return this}),b.prototype.next=function(a){return this._invoke("next",a)},b.prototype.throw=function(a){return this._invoke("throw",a)},b.prototype.return=function(a){return this._invoke("return",a)}}(),function(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}),Q=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),R=(Object.assign,function(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}),S=function(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b},T=("undefined"==typeof global?self:global,function(){function a(a,b){var c=[],d=!0,e=!1,f=void 0;try{for(var g,h=a[Symbol.iterator]();!(d=(g=h.next()).done)&&(c.push(g.value),!b||c.length!==b);d=!0);}catch(a){e=!0,f=a}finally{try{!d&&h.return&&h.return()}finally{if(e)throw f}}return c}return function(b,c){if(Array.isArray(b))return b;if(Symbol.iterator in Object(b))return a(b,c);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}()),U=function(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}return Array.from(a)},V=function(){function a(){P(this,a),this.scheduleValues=CBHCore.params.mainSchedule.getValues()}return Q(a,[{key:"reduce",value:function(a,b){if("function"!=typeof b)throw new TypeError(b+" is not a function");var c=Object(a),d=a.length>>>0,e=0,f=void 0;if(3===arguments.length)f=arguments[2];else{for(;e<d&&!(e in c);)e++;if(e>=d)throw new TypeError("Reduce of empty array with no initial value");f=c[e++]}for(;e<d;e++)e in c&&(f=b(f,c[e],e,c));return f}},{key:"savePriorityChannel",value:function(a){CBHCore.savePriorityChannel(a)}},{key:"renderDay",value:function(a,b){var c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"%day%, %date%",d=this.getCalendarDic(),e=new H.StrongDate(Number(a));e.setHours(0),e.setMinutes(0),e.setSeconds(0),e.setMilliseconds(0);var f="",g="",h="",i=d.monthes[a.getMonth()];if(f=this.toLocaleStringSupportsLocales()?e.toLocaleString(CBHCore.lang.langCode,{month:"long",day:"numeric"}):e.getDate()+" "+K("when.monthes."+i),b){var j=new H.StrongDate;j.setHours(0),j.setMinutes(0),j.setSeconds(0),j.setMilliseconds(0);var k=(Number(e)-Number(j))/864e5;void 0!==d.days[k]?g=K("when.days."+d.days[k]):k<7&&(g=K("when.daysOfWeek."+d.daysOfWeek[a.getDay()])),h=c.replace("%day%",g).replace("%date%",f)}else h=f;return h}},{key:"getCalendarDic",value:function(){return{days:["today","tomorrow"],daysOfWeek:["sun","mon","tue","wed","thu","fri","sat"],monthes:["jan","feb","mar","apr","may","jun","jul","aug","sep","oct","nov","dec"]}}},{key:"getShortWhen",value:function(a){var b=new H.StrongDate;b.setHours(0),b.setMinutes(0),b.setSeconds(0),b.setMilliseconds(0);var c=new H.StrongDate(Number(a));c.setHours(0),c.setMinutes(0),c.setSeconds(0),c.setMilliseconds(0);var d=this.getCalendarDic(),e=(Number(c)-Number(b))/864e5;return void 0!==d.days[e]?K("when.days."+d.days[e]):e<4&&K("when.daysOfWeek."+d.daysOfWeek[a.getDay()])}},{key:"capitalizeFirstLetter",value:function(a){return a.charAt(0).toUpperCase()+a.slice(1)}},{key:"toLocaleStringSupportsLocales",value:function(){try{(new Date).toLocaleString("i")}catch(a){return"RangeError"===a.name}return!1}},{key:"generateDaySelects",value:function(){var a=this;return this.daySelects(!1,function(b){return a.renderDay(b,!0,"%date%")})}},{key:"daySelects",value:function(a,b){var c=this,d=!0,e=[],f="",g="",h=0;return Object.keys(this.scheduleValues).forEach(function(i){var j=new H.StrongDate(Number(i)),k=b(j);a&&(k=c.capitalizeFirstLetter(k));var l=c.getShortWhen(j);d&&(f=k,g=l,h=Number(i)),e.push({shortText:l,text:k,value:Number(i),selected:d}),d=!1}),{data:e,firstName:f,firstVal:h,firstShort:g}}},{key:"generateHourSelects",value:function(){var a=this,b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:CBHCore.params.mainSchedule.getNextWorkingDay(),c=[],d=!0,e="",f=0;return Object.keys(this.scheduleValues[b]).forEach(function(g){a.scheduleValues[b][g].forEach(function(b){var g=void 0;g=a.toLocaleStringSupportsLocales()?b.toLocaleString(CBHCore.lang.langCode,{hour:"2-digit",minute:"2-digit"}):b.toTimeString().substr(0,5),d&&(e=g,f=Number(b)),c.push({text:g,value:Number(b),selected:d}),d=!1})}),{data:c,firstName:e,firstVal:f}}},{key:"shadeColor",value:function(a,b){function c(a){return Math.round((e-a)*f)+a}var d=parseInt(a.slice(1),16),e=b<0?0:255,f=b<0?-1*b:b,g=d>>16,h=d>>8&255,i=255&d;return"#"+(16777216+65536*c(g)+256*c(h)+c(i)).toString(16).slice(1)}},{key:"stripTags",value:function(a){var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",c=(String(b||"").toLowerCase().match(/<[a-z][a-z0-9]*>/g)||[]).join(""),d=/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi,e=/<!--[\s\S]*?-->|<\?(?:php)?[\s\S]*?\?>/gi;return a.replace(e,"").replace(d,function(a,b){return c.indexOf("<"+b.toLowerCase()+">")>-1?a:""})}},{key:"debounce",value:function(a,b,c){var d=void 0;return function(){var e=c&&!d,f=arguments,g=function(){d=null,c||a.apply(void 0,U(f))};clearTimeout(d),d=setTimeout(g,b),e&&a.apply(void 0,U(f))}}},{key:"arrayRemove",value:function(a,b,c){var d=a.slice((c||b)+1||a.length);return a.length=b<0?a.length+b:b,a.push.apply(a,d)}},{key:"rC",value:function(a,b){a.classList?a.classList.remove(b):a.className=a.className.replace(new RegExp("(^|\\b)"+b.split(" ").join("|")+"(\\b|$)","gi")," ")}},{key:"aC",value:function(a,b){a.classList?a.classList.add(b):a.className+=" "+b}},{key:"bodyHasHorizontalScroll",value:function(){return document.documentElement.scrollWidth>document.documentElement.clientWidth}},{key:"getColorBrightness",value:function(a){var b=parseInt(a.slice(1),16);return.299*(b>>16)+.587*(b>>8&255)+.114*(255&b)}},{key:"areClipPathShapesSupported",value:function(){for(var a="clipPath",b=["webkit","moz","ms","o"],c=[a],d=document.createElement("testelement"),e=0,f=b.length;e<f;e++){var g=b[e]+a.charAt(0).toUpperCase()+a.slice(1);c.push(g)}for(var h=0,i=c.length;h<i;h++){var j=c[h];if(""===d.style[j]&&(d.style[j]="polygon(50% 0%, 0% 100%, 100% 100%)",""!==d.style[j]))return!0}return!1}}]),a}(),W=new V,X=CBHCore.Masked,Y=function(){function a(b){var c=this;P(this,a),this.pic=ko.observable(""),this.phone=ko.observable(""),this.phoneFallback=ko.observable(""),this.email=ko.observable(""),this.emailFallback=ko.observable(""),this.name=ko.observable(""),b||(this.phone(CBHCore.user.client_phone?CBHCore.user.client_phone:CBHCore.getDefaultPhoneCode()),this.phoneFallback(CBHCore.user.client_phone_fallback?CBHCore.user.client_phone_fallback:CBHCore.getDefaultPhoneCode()),this.email(CBHCore.user.email||""),this.emailFallback(CBHCore.user.email_fallback||""),this.name(CBHCore.user.name||"")),this.initSocial(),this.phoneIsInvalid=ko.observable(!1),this.phoneChanged=!1,this.phone.subscribe(function(){c.phoneIsInvalid(!1),c.phoneChanged=!0}),this.beautifulPhone=ko.computed(function(){return X.getPhone(c.phone())||c.phone()}),this.nameTooLong=ko.computed(function(){return c.name().split(/\s/)[0].length>a.MAX_NAME_LENGTH}),this.nameTooShort=ko.computed(function(){return 0===c.name().length}),this.setupServer()}return Q(a,[{key:"initSocial",value:function(){function a(a){return void 0!==CBHCore.user[a]&&CBHCore.user[a]?CBHCore.user[a]:""}var b=this,c={};["vk","fb","vb","tg","sk"].forEach(function(d){var e=d+"_avatar",f=d+"_id";b[d]=ko.observable(a(f)),c[d]=a(e)}),this.avatars=ko.observable(c)}},{key:"setupServer",value:function(){var a=this;this.phoneFallback.subscribe(W.debounce(function(){CBHCore.helpers.savePhoneFallback(a.phoneFallback())},500)),this.name.subscribe(W.debounce(function(){CBHCore.helpers.saveName(a.name())},500)),this.email.subscribe(W.debounce(function(){CBHCore.helpers.saveEmail(a.email())},500)),this.emailFallback.subscribe(W.debounce(function(){CBHCore.helpers.saveEmailFallback(a.emailFallback())},500)),this.sk.subscribe(W.debounce(function(){CBHCore.helpers.saveSkId(a.sk())},500))}},{key:"isPhoneValid",value:function(a){return this.phoneIsInvalid((this.phoneChanged||a)&&(!CBHCore.helpers.isValidPhone(this.phone())||!X.isValid(this.phone()))),!this.phoneIsInvalid()}},{key:"isEmailValid",value:function(){var a=this.email();return a.length>0&&-1!==a.indexOf("@")&&-1!==a.indexOf(".")}},{key:"injectNameIfAvailable",value:function(a,b){var c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(this.nameTooLong()||this.nameTooShort())return K(b,c);var e=void 0;return e=d>0?this.getShortName(d):this.name(),K(a,CBHCore.helpers.extend(c,{name:CBHCore.helpers.escapeHtml(e)}))}},{key:"getShortName",value:function(a){var b=this.name().trim();return b.length<=a||a<=0?b:(b=b.split(/\s/)[0],b.length<=a?b:b.substr(0,a-1)+"…")}}]),a}();Y.MAX_NAME_LENGTH=9;var Z=function(){function a(b){var c=this;P(this,a),this.options=b.options,this.selected=b.selected,this.popupVisible=ko.observable(!1),this.selectedText=ko.computed(function(){return c.selected()?c.selected().text:""}),CBHCore.helpers.isFunction(this.options)&&this.options().length>0&&this.selected(this.options()[0])}return Q(a,[{key:"showPopup",value:function(){this.popupVisible(!0)}},{key:"pick",value:function(a){this.selected(a),this.popupVisible(!1)}}]),a}(),$=function a(b){P(this,a),this.onRate=b.onRate,this.textColor=b.textColor,this.index=ko.observable(!1)},_=function(){function a(){var b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};P(this,a),CBHCore.helpers.isArray(b.elemId)||(b.elemId=[b.elemId]),this.elemId=b.elemId,this.elems=[];var c=void 0,d=void 0
;for(var e in this.elemId)this.elemId.hasOwnProperty(e)&&("string"==typeof b.elemId[e]?(c=document.getElementById(b.elemId[e]),d=b.elemId[e]):b.elemId[e]&&(c=b.elemId[e],d="cbh_cntdwn_"+Math.floor(1e3*Math.random())),c&&(this.elems[d]=c));this.time=b.time,this.currentTime=this.time,this.template=b.template,this.msNumbers=b.msNumbers||2,this.delta=b.delta||33,this.reset()}return Q(a,[{key:"addContainer",value:function(a){var b=void 0,c=void 0;"string"==typeof a?(b=a,c=document.getElementById(b)):void 0===a.elements?(b=a.id||"cbh_cntdwn_"+Math.floor(1e3*Math.random()),c=a):(b=a.getAttr("id"),c=a.elements[0]),c&&b&&-1===this.elems.indexOf(c)&&(this.elems[b]=c,this.reset(!1))}},{key:"divide",value:function(a){var b={};b.hours=Math.floor(a/36e5),b.minutes=Math.floor((a-36e5*b.hours)/6e4),b.seconds=Math.floor((a-(36e5*b.hours+6e4*b.minutes))/1e3),b.ms=a-(36e5*b.hours+6e4*b.minutes+1e3*b.seconds),b.ms=b.ms.toString().substr(0,this.msNumbers);var c=Math.floor(a/1e3);return CBHCore.is_mobile?b.text=c<=86400?K("countdown.tomorrow"):c<=172800?K("countdown.afterTomorrow"):K("countdown.after")+" "+this.secondsToString(c,0):b.text=b.hours>23?this.secondsToString(c,0,1):this.secondsToString(c,1,2),b}},{key:"set",value:function(a){this.currentTime=a;var b=this.divide(this.currentTime);for(var c in this.elems)if(this.elems.hasOwnProperty(c))for(var d in b)b.hasOwnProperty(d)&&("text"!==d&&(b[d]=String("0"+b[d]).slice(-2)),void 0===this.elems[c].placeholders[d]&&(this.elems[c].placeholders[d]=document.getElementById(c+"_"+d)||this.elems[c].querySelector("#"+c+"_"+d)),this.elems[c].placeholders[d]&&(this.elems[c].placeholders[d].innerHTML=b[d]))}},{key:"reset",value:function(){var a=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];a&&this.stop();for(var b in this.elems)this.elems.hasOwnProperty(b)&&(this.elems[b].innerHTML=this.template.replace(/%(.+?)%/g,'<span id="'+b+'_$1"></span>'),this.elems[b].placeholders={});this.set(a?this.time-10:this.currentTime)}},{key:"start",value:function(a){if(!this.running){this.running=!0;var b=Number(new Date);this.countdownInterval=setInterval(function(){var c=Number(new Date),d=this.time-(c-b);if(d>0)this.set(d);else if(this.set(0),this.stop(),CBHCore.helpers.isFunction(a))return a()}.bind(this),this.delta)}}},{key:"stop",value:function(){clearInterval(this.countdownInterval),this.running=!1}},{key:"secondsToString",value:function(a,b,c){var d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:" ",e=parseInt(a,10),f="string"==typeof d?d:" ",g=-1===[0,1,2,3].indexOf(parseInt(b,10))?1:parseInt(b,10),h=-1===[0,1,2,3].indexOf(parseInt(c,10))?1:parseInt(c,10),i=["days","hours","minutes","seconds"];if(3===h)return K(i[3],{num:e});for(var j=[Math.floor(e/86400),Math.floor(e%86400/3600),Math.floor(e%86400%3600/60),e%86400%3600%60],k=1;k<3;k++)k>h&&(j[k+1]+=j[1]*(0===k?24:60),j[k]=0);0===g&&0===j[0]&&j[1]>0&&(j[0]=1,j[1]=0);var l=[];for(var m in j)if(j.hasOwnProperty(m)&&(l.push(K(i[m],{num:j[m]})),m>g))break;return l.join(f)}}]),a}(),aa=null,ba=function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},b=a.element,c=void 0===b?null:b,e=a.valueAccessor,f=void 0===e?null:e;return c&&aa&&aa.addContainer(c),aa||d({element:c,valueAccessor:f})},ca=CBHCore.lib.StrongDate,da=!1,ea=!1,fa=0,ga=void 0,ha=void 0,ia=void 0,ja=!1,ka=!1,la=function(){var a=0,b=null;return function(c){var d=(new H.StrongDate).getTime(),e=d-pa.lastTs;if(pa.lastTs=d,!(d-pa.lastTs>1e4||e<5)&&p()){if(null===b)return void(b=c.screenY);var f=Math.round((c.screenY-b)/e*100),g=Math.round((f-a)/e*100);g<0&&Math.round(-1e3*g/4e3)>1e3&&(ClbhObject.showWidgetExit(),pa.blockAutoPopup=!0),a=f,b=c.screenY}}}(),ma=!1;CBHCore.telemetry.on("activity",function(){da=!0}),CBHCore.telemetry.on("inputFocus",function(){ea=!0});var na=0,oa=void 0,pa={blockAutoPopup:!1,lastTs:(new H.StrongDate).getTime()},qa=function(){function a(){P(this,a),this.clientChannel=void 0!==N.clientChannel&&N.clientChannel,this.socials=["fb","vk","vb","tg","sk"]}return Q(a,[{key:"make",value:function(a){for(var b={},c=0;c<this.socials.length;c++){var d=this.socials[c];void 0!==a[d]&&(this[d+"params"]=q(a[d])),CBHCore.helpers.isFunction(this[d+"Setup"])&&this[d+"Setup"](this.getChannel(d+"_g"))}for(var e=0;e<this.socials.length;e++){var f=this.socials[e];void 0!==this[f+"params"]&&(b[f]=q(this[f+"params"]))}return b}},{key:"getChannel",value:function(a){return this.clientChannel&&void 0!==this.clientChannel[a]?this.clientChannel[a]:null}},{key:"fbSetup",value:function(a){a?(this.fbparams.customGroup=!0,this.fbparams.pageId=a.id,this.fbparams.chatLink="https://m.me/"+this.fbparams.pageId,s()&&r()&&(this.fbparams.chatLink+="?ref="+r()),this.fbparams.pageLink=this.clientChannel.fb_g.link):this.fbparams.pageId=null}},{key:"vkSetup",value:function(a){a?(this.vkparams.pageId=a.id,this.vkparams.chatLink="https://vk.com/im?sel=-"+a.id,this.vkparams.customGroup=!0):(this.vkparams.pageId=null,this.vkparams.chatLink="")}},{key:"vbSetup",value:function(a){var b=this.vbparams.pageId;if(this.vbparams.chatLink="",!(CBHCore.helpers.isWindowsPhone()||null===a&&s())){a&&a.id&&(b=a.id);var c=JSON.stringify({sid:CBHCore.user.session_id,hcode:CBHCore.hunter_code});s()&&r()&&(c=r()),this.vbparams.chatLink="viber://pa?"+CBHCore.helpers.makeQueryString({chatURI:b,context:c})}}},{key:"tgSetup",value:function(a){if(a&&(this.tgparams.pageId=a.id),(null!==a||!s())&&N.client_data&&N.client_data.id){var b=CBHCore.hunter_code;s()&&r()&&(b=r()),this.tgparams.chatLink="tg://resolve?domain="+this.tgparams.pageId+"&start="+b+"-"+N.client_data.id}}},{key:"skSetup",value:function(a){a&&(this.skparams.pageId=a.id,this.skparams.chatLink+=this.skparams.pageId)}}]),a}(),ra=new qa,sa=ra.make({fb:{pageId:H.fbPageId,chatLink:H.fbChatLink},vk:{pageId:H.vkGroupId,chatLink:H.vkChatLink},vb:{pageId:H.viberPA_URI,chatLink:null},tg:{pageId:H.tgDomain,chatLink:null},sk:{pageId:null,chatLink:H.skPageLink}}),ta=function(){function a(b){P(this,a),this.config=b}return Q(a,[{key:"fb",value:function(){void 0!==this.config.fb&&(this.sendSocialButtonEvent("fb"),window.open(this.config.fb.chatLink))}},{key:"vk",value:function(){void 0!==this.config.vk&&(this.sendSocialButtonEvent("vk"),window.open("https://vk.com/im?sel=-"+this.config.vk.pageId,"blank"))}},{key:"vb",value:function(){void 0!==this.config.vb&&(this.sendSocialButtonEvent("vb"),G.open(this.config.vb.chatLink,{windows:{appId:"9wzdncrfj46z",appName:"viber"},desktop:{appUrl:"https://www.viber.com/ru/"}}))}},{key:"tg",value:function(){if(void 0!==this.config.tg){this.sendSocialButtonEvent("tg");var a={desktop:{appUrl:"https://desktop.telegram.org/"}};CBHCore.helpers.isWindowsPhone()&&(a.windows={appId:"9wzdncrdzhs0",appName:"telegram-messenger"}),G.open(this.config.tg.chatLink,a)}}},{key:"sk",value:function(){void 0!==this.config.sk&&(this.sendSocialButtonEvent("sk"),G.open(this.config.sk.chatLink,{}))}},{key:"sendSocialButtonEvent",value:function(a){return k("Callbackhunter_SOCIAL_BUTTON_"+a.toUpperCase(),"clicked"),!0}}]),a}(),ua=function(){function a(b){P(this,a),this.enabledChats=N.chat_channels||[],this.enabledChannels=N.cbh_channels||[],this.commList=[],this.priorityChannel=null,this.chatsConfig=sa,this.deeplinks=new ta(sa),this.hasManagerBot=void 0!==N.has_manager_bot&&N.has_manager_bot,this.clientChannel=void 0!==N.clientChannel&&N.clientChannel,this.builtinChatEnabled=ko.observable(!1),this.sms=b.hasSms(),this.generateCommList(),this.hasCalls=this.isChannelEnabled("callback"),this.hasChats=this.commList.length>0}return Q(a,[{key:"isChatEnabled",value:function(a){return!this.enabledChats.length||-1!==this.enabledChats.indexOf(a)}},{key:"isChannelEnabled",value:function(a){var b=this.enabledChannels;if(0===b.length)return!0;var c="desc_"+a;return b.hasOwnProperty(c)}},{key:"generateCommList",value:function(){var a=[],b=["builtin"];this.hasManagerBot&&(N.client_data&&CBHCore.helpers.isArray(N.client_data.comm_rating)&&(b=N.client_data.comm_rating.slice(),-1!==b.indexOf("builtin")&&W.arrayRemove(b,b.indexOf("builtin")),b.unshift("builtin")),this.isChatEnabled("builtin")&&this.isChannelEnabled("builtin")?(a.push("builtin"),this.builtinChatEnabled(!0)):this.builtinChatEnabled(!1),this.chatsConfig.vk.chatLink&&this.chatsConfig.vk.pageId&&this.isChatEnabled("vk")&&this.isChannelEnabled("vk")&&a.push("vk"),(this.chatsConfig.fb.chatLink||this.chatsConfig.fb.pageLink)&&this.chatsConfig.fb.pageId&&this.isChatEnabled("fb")&&this.isChannelEnabled("fb")&&a.push("fb"),this.chatsConfig.sk.pageId&&this.chatsConfig.sk.chatLink&&this.isChatEnabled("sk")&&this.isChannelEnabled("sk")&&a.push("sk"),this.chatsConfig.tg.chatLink&&this.isChatEnabled("tg")&&this.isChannelEnabled("tg")&&a.push("tg"),this.sms&&this.isChatEnabled("sms")&&this.isChannelEnabled("sms")&&a.push("sms"),this.isChatEnabled("email")&&this.isChannelEnabled("email")&&a.push("email"),b.slice().forEach(function(c){var d=a.indexOf(c);-1===d?W.arrayRemove(b,b.indexOf(c)):W.arrayRemove(a,d)}),this.commList=b.concat(a),N.client_data&&N.client_data.priority_channel&&-1!==this.commList.indexOf(N.client_data.priority_channel)?this.priorityChannel=N.client_data.priority_channel:this.isChannelEnabled("callback")?this.priorityChannel="callback":this.priorityChannel=this.commList[0])}}],[{key:"supportedPriorityChannel",value:function(a){return-1!==["fb","vk","tg","vb","builtin","email"].indexOf(a)}}]),a}(),va=140,wa=function(){function a(b,c,d,e){var f=this;P(this,a),this.___=K,this.prefix=e,this.visible=b.visible,this.user=c.user,this.countdown=c.countdown,this.activeSlide=c.activeSlide,this.activeSubslide=c.activeSubslide,this.activeSocial=c.activeSocial,this.sliderOpen=c.sliderOpen,this.sliderOpenedByDelay=c.sliderOpenedByDelay,this.changeSliderOpenState=c.changeSliderOpenState,this.channelsVisible=c.channelsVisible,this.channels=c.commList,this.showReason=c.showReason,this.freeMode=c.freeMode,this.worktime=c.worktime,this.hasCalls=c.hasCalls,this.caught=c.caught,this.deeplinks=c.deeplinks,this.priorityChannel=c.priorityChannel,this.setupOffices(c),this.setupTime(c),this.setupTextColor(),this.setupBackground(c),this.setupLogo(),["catch","slider"].forEach(function(a){return f.addLangVariables(a)}),this.allowTimeSelection=ko.computed(function(){return f.worktime()&&!f.freeMode()}),this.dataAgreement=ko.observable(!0),this.socialButtonOnClick=ko.observable(),this.socialAvatar=ko.observable(),this.title=ko.observable(),this.text=ko.observable(),this.rating=ko.observable(),this.next=ko.observable(),this.smsText=ko.observable(""),this.socialButtonText=ko.observable(""),this.disableCatchFirstStep=void 0!==N.disable_catch_first_step&&parseInt(N.disable_catch_first_step,10),this.smsText.subscribe(function(){f.smsText().length>va&&f.smsText(f.smsText().substr(0,va))}),this.content=ko.computed(function(){if(!f.activeSubslide()||!f.visible())return null;var a="widget_"+f.activeSubslide();return CBHCore.helpers.isFunction(d[a])?a:(a=e+"_"+f.activeSubslide(),"slider_catch"===a&&f.disableCatchFirstStep&&(a="slider_call_now",f.showCommunicationSlide()),CBHCore.helpers.isFunction(d[a])?a:null)}),this.callAllowed=ko.computed(function(){return f.user.isPhoneValid()&&f.dataAgreement()}),this.smsAllowed=ko.computed(function(){return f.smsText().length>0&&f.smsText().length<=va}),this.user.phone.valueHasMutated(),this.activeSlide.subscribe(function(){f.activeSlide()&&("call-now"===f.activeSlide()?setTimeout(function(){return f.call()}):"callback"===f.activeSlide()?CBHCore.helpers.isFunction(f.defaultSubslide)&&setTimeout(function(){return f.defaultSubslide()}):"sms"===f.activeSlide()?setTimeout(function(){return f.smsPhone()}):"social"===f.activeSlide()?setTimeout(function(){return f.prioritySocial()}):f.changeSliderOpenState(!0))});var g=function(){f.channelsVisible(-1!==["call_now","call_disabled","catch","sms_phone","social","email_main"].indexOf(f.activeSubslide()))};this.activeSubslide.subscribe(g),this.activeSlide.subscribe(g),this.caught.subscribe(function(){return f.catch()}),this.activeSlide.notifySubscribers(),this.visible.notifySubscribers()}return Q(a,[{key:"addLangVariables",value:function(a){if(!this.freeMode()){var b=K(a+".call_now.title")||"";b&&(b="#{name}, "+b.charAt(0).toLowerCase()+b.slice(1)),CBHCore.lang.addLangRow(a+".call_now.title_name",b)}}},{key:"setupTextColor",value:function(){function a(a){return a.replace(/[^0-9a-fA-F]/g,"").substr(0,6)}var b=this;this.textColor=ko.observable(),this.caught.subscribe(function(){var c=b.caught()?"catcher_text_color":"slider_text_color",d="#ffffff";c&&N[c]&&(d="#"+a(N[c])),b.textColor(d)}),this.caught.valueHasMutated()}},{key:"setupBackground",value:function(a){this.backgroundImage=a.sliderBackgroundImage,this.backgroundColor=a.sliderBackgroundColor}},{key:"setupLogo",value:function(){var a=this;this.showSocialAvatar=ko.observable(!1),this.logoImage=ko.computed(function(){if("social"===a.activeSubslide()){var b=a.socialAvatar();if(b)return a.showSocialAvatar(!0),b}if(a.showSocialAvatar(!1),!CBHCore.helpers.brandingEnabled()||"sms_message"===a.activeSubslide())return null;var c=a.caught()?"catcher_logo":"slider_logo",d=CBHCore[c]||N[c];return d?"url(//"+CBHCore.opt.static_domain+"/uploads/brand_large_logo/"+d+")":void 0})}},{key:"setupOffices",value:function(a){this.selectedOffice=a.selectedOffice,this.officeSelectionList=a.officeSelectionList}},{key:"setupTime",value:function(a){this.availableDays=a.availableDays,this.selectedDay=a.selectedDay,this.availableHours=a.availableHours,this.selectedHour=a.selectedHour}},{key:"__",value:function(a){for(var b=arguments.length,c=Array(b>1?b-1:0),d=1;d<b;d++)c[d-1]=arguments[d];return K.apply(void 0,[this.prefix+"."+a].concat(c))}},{key:"getNewRandId",value:function(){return CBHCore.helpers.rand(16)}},{key:"getCallParams",value:function(){return this.callRandId=this.getNewRandId(),{phone:this.user.phone(),client_name:this.user.name(),wp_code:void 0===N.wp_code?"":N.wp_code,lang:CBHCore.lang.langCode,office_id:this.selectedOffice()?this.selectedOffice().value:0,call_rand_id:this.callRandId,phone_manager_tracked:CBHCore.callTracking.catchManagerPhone(),widget_show_reason:this.showReason(),url:window.location.href}}},{key:"call",value:function(){var a=this;return this.worktime()||this.selectedDay()&&this.selectedHour()?this.officeSelectionList().length>0&&!this.selectedOffice()?this.selectOffice(function(){return a.call()}):this.selectedDay()&&this.selectedHour()?this.callDeferred():this.user.isPhoneValid(!0)?(CBHCore.server.send(this.getCallParams()),k("Callbackhunter_CAUGHT_PHONE","clicked"),k("Callbackhunter_CALL_BUTTON","clicked"),void this.callTimer()):this.enterPhone(function(){return a.call()}):this.callLater()}},{key:"enterPhone",value:function(a){this.activeSubslide("enter_phone"),this.next(a)}},{key:"callDeferred",value:function(){var a=this;return this.officeSelectionList().length>0&&!this.selectedOffice()?void this.selectOffice(function(){return a.callDeferred()}):this.user.isPhoneValid(!0)?(k("Callbackhunter_CALL_LATER_BUTTON","clicked"),CBHCore.server.send(CBHCore.helpers.extend(this.getCallParams(),{night_time:this.selectedHour().value,user_date:JSON.stringify({utc:(new Date).toUTCString(),local:String(new Date),utc_strong:(new ca).toUTCString(),local_strong:(new ca).toString()})})),void this.laterSuccess()):void this.enterPhone(function(){return a.callDeferred()})}},{key:"sms",value:function(){var a=this,b=this.smsText();this.callAllowed()&&this.smsAllowed()&&(k("cbh_desktop_sms","sent"),k("Callbackhunter_SEND_SMS","sent"),this.smsSuccess(),CBHCore.server.send({lang:CBHCore.lang.langCode,question:JSON.stringify({question:b.trim(),phone:this.user.phone(),email:this.user.email(),type:"sms"})},"/hunter/",function(b){"success"!==b.result&&a.smsFailure()}))}},{key:"prioritySocial",value:function(){ua.supportedPriorityChannel(this.priorityChannel)&&"builtin"!==this.priorityChannel&&"email"!==this.priorityChannel?this.social(this.priorityChannel):this.showCommunicationSlide()}},{key:"social",value:function(a){var b=this;this.activeSubslide("social"),this.activeSocial(a);var c=K(this.prefix+".social.channels."+a);this.text(this.user.injectNameIfAvailable(this.prefix+".social.text",this.prefix+".social.text_no_name",{social:c},Y.MAX_NAME_LENGTH)),this.user.avatars()[a]&&this.socialAvatar("url("+this.user.avatars()[a]+")"),this.socialButtonOnClick(function(){!CBHCore.helpers.empty(b.deeplinks.config[a])&&CBHCore.helpers.isFunction(b.deeplinks[a])?b.deeplinks[a]():b.activeSlide(a),k("Callbackhunter_SOCIAL_BUTTON_"+a.toUpperCase(),"clicked")}),this.socialButtonText(K(this.prefix+".social.button",{social:c}))}},{key:"callTimer",value:function(){var a=this;if(this.freeMode())return this.callSuccessFree();this.activeSubslide("call_timer"),this.title(this.user.injectNameIfAvailable(this.prefix+".timer.title_name",this.prefix+".timer.title",{},Y.MAX_NAME_LENGTH)),setTimeout(function(){return ba().start(function(){return a.callResult()})})}},{key:"callResult",value:function(){this.activeSubslide("call_result")}},{key:"laterSuccess",value:function(){var a=new Date(this.selectedDay().value);this.title(this.__("later_success.title",{day:W.renderDay(a,!0,"%day%")})),this.text(this.__("later_success.text",{date:W.renderDay(a,!0,"%date%"),time:this.selectedHour().text})),this.activeSubslide("call_later_success")}},{key:"callSuccess",value:function(){if(!this.rating())return void this.callRating();this.afterSuccess()}},{key:"callSuccessFree",value:function(){var a=this;this.activeSubslide("call_free_success"),setTimeout(function(){return a.afterSuccess()},5e3)}},{key:"afterSuccess",value:function(){this.rating(0),this.close(),this.defaultSubslide()}},{key:"callRating",value:function(){this.activeSubslide("call_rating")}},{key:"callFailure",value:function(){this.activeSubslide("call_failure")}},{key:"catch",value:function(){if(this.disableCatchFirstStep||!this.caught()||ba&&ba().running)return void this.showCommunicationSlide();this.recalcTimeOnSite(),this.activeSubslide("catch")}},{key:"showCommunicationSlide",value:function(){if(this.selectedOffice(0),this.selectedDay(0),this.selectedHour(0),ba&&ba().running)return void this.callTimer();if(!this.hasCalls)return void this.callDisabled();if(!this.worktime())return void this.callNight();var a=this.caught()?"catch":"slider";this.freeMode()?this.title(K(a+".call_now.title_free",{countdown:this.countdown})):this.title(this.user.injectNameIfAvailable(a+".call_now.title_name",a+".call_now.title",{countdown:this.countdown},Y.MAX_NAME_LENGTH)),this.activeSubslide("call_now")}},{key:"callNight",value:function(){this.selectedOffice(0),this.title(this.__("call_night.title")),this.activeSubslide("call_now")}},{key:"callLater",value:function(){this.selectedOffice(0),this.title(this.__("call_later.title")),this.activeSubslide("call_later")}},{key:"callDisabled",value:function(){this.selectedOffice(0),this.title(this.__("call_disabled.title")),this.activeSubslide("call_disabled")}},{key:"smsPhone",value:function(){this.activeSubslide("sms_phone")}},{key:"email",value:function(){this.activeSubslide("call_now"),this.activeSlide("email")}},{key:"smsMessage",value:function(){this.smsText(""),this.activeSubslide("sms_message")}},{key:"smsFailure",value:function(){this.activeSubslide("sms_failure")}},{key:"smsSuccess",value:function(){this.activeSubslide("sms_success")}},{key:"selectOffice",value:function(a){this.title(this.__("select_office.title")),this.activeSubslide("select_office"),this.next(a)}},{key:"onRate",value:function(a){this.rating(a),this.callSuccess()}}]),a}(),xa=function(a,b){return function(c){function d(c){P(this,d);var e=S(this,(d.__proto__||Object.getPrototypeOf(d)).call(this,c,a,b,"slider"));return e.visible.subscribe(function(){e.visible()||e.disableCatchFirstStep||"main"!==e.activeSubslide()||e.recalcTimeOnSite()}),e}return R(d,c),Q(d,[{key:"recalcTimeOnSite",value:function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"when.time",b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],c=CBHCore.helpers.getTimeFromStart(),d=T(c,3),e=d[0],f=d[1],g=d[2],h=[],i=0;if(!isNaN(g)&&g>0&&(h.push(K(a+".hours",{num:g})),i+=60*g*60),!isNaN(e)&&e>0&&(h.push(K(a+".minutes",{num:e})),i+=60*e),!isNaN(f)&&f>0&&0===g&&(0===g&&h.push(K(a+".seconds",{num:f})),i+=f),i<10&&(h=[]),h.length>0?this.title(K("catch.main.title_time",{time:h.join(" ")}).replace("..",".")):this.title(""),this.title().length>35&&!b)return this.recalcTimeOnSite("when.time_short",!0)}},{key:"defaultSubslide",value:function(){this.showCommunicationSlide()}},{key:"close",value:function(){this.channelsVisible(!0),this.caught(!1),this.defaultSubslide(),this.changeSliderOpenState(!1)}}]),d}(wa)},ya=function(){function a(b){var c=b.key,d=b.utm_source,e=void 0===d?"":d;P(this,a),this.showPoweredBy=Boolean(parseInt(N.show_powered_by,10)),this.poweredByContent=CBHCore.helpers.compilePoweredBy("powered_by."+c,e)}return Q(a,[{key:"poweredByClicked",value:function(a,b){return b.stopPropagation(),k("cbh_powered_by","clicked"),!0}}]),a}(),za=0,Aa=function a(b){P(this,a),this.text=b.text,this.checked=b.checked,this.id="checkbox_"+ ++za},Ba=function a(b){P(this,a);var c=CBHCore.helpers.isFunction,d=CBHCore.helpers.empty,e=ko.observableArray(b.channels||[]),f=b.deeplinks,g=b.caught;this.denyActiveButtonState=b.denyActiveButtonState||!1,this.visible=b.visible,this.channels=ko.observableArray(ko.utils.arrayMap(e(),function(a){return{name:a,action:function(){W.savePriorityChannel(a),"builtin"!==a&&"email"!==a||g(!1),b.activeSlide()===a&&c(b.sliderOpen)||"social"===b.activeSlide()&&c(b.activeSocial)&&b.activeSocial()===a?(b.changeSliderOpenState(!1),"builtin"!==a&&"sms"!==a&&"email"!==a||k("Callbackhunter_WIDGET","clicked"),"builtin"!==b.activeSlide()&&"email"!==b.activeSlide()||b.activeSlide("")):c(b.activeSlide)&&(!d(b.deeplinks.config[a])&&c(f[a])?f[a]():(b.activeSlide(a),k("Callbackhunter_SOCIAL_BUTTON_"+a.toUpperCase(),"clicked")))}}}))},Ca={connected:!1,inProcess:!1,endpoint:H.socketIOEndpoint.url,opts:{path:H.socketIOEndpoint.path},setup:function(a,b){this.connected=!1,this.inProcess=!1,this.endpoint=a,this.opts=b||{}},connect:function(a){return this.connected?a():this.inProcess?this.io.on("initFinish",a):(this.inProcess=!0,this.io=CBHCore.io(this.endpoint,this.opts),this.io.on("connect",function(){this.io.emit("init",{sid:CBHCore.user.session_id,hcode:CBHCore.hunter_code})}.bind(this)),void this.io.on("initFinish",function(){this.connected=!0,this.inProcess=!1,a()}.bind(this)))}};Object.create(Ca).setup(CBHCore.opt.socketIOEndpoint);var Da={},Ea=function(a){return null!==a&&a===a.window};Da.getStyle=function(a){var b=window.getComputedStyle(this.elements[0]);return!!b&&b.getPropertyValue(a)};var Fa=CBHCore.lib.Sweety(Da),Ga=[];"Boolean Number String Function Array Date RegExp Object Error Symbol".split(" ").forEach(function(a){Ga["[object "+a+"]"]=a.toLowerCase()});var Ha={Height:"height",Width:"width"};for(var Ia in Ha){(function(a){if(!Ha.hasOwnProperty(a))return"continue";var b=Ha[a],c={padding:"inner"+a,content:b,"":"outer"+a};for(var d in c){(function(d){if(!c.hasOwnProperty(d))return"continue";var e=c[d];Da[e]=function(c){var f=arguments.length&&(d||"boolean"!=typeof c);return Ja(this.elements,function(b,c,d){if(Ea(b))return 0===e.indexOf("outer")?b["inner"+a]:b.document.documentElement["client"+a];if(9===b.nodeType){var f=b.documentElement;return Math.max(b.body["scroll"+a],f["scroll"+a],b.body["offset"+a],f["offset"+a],f["client"+a])}return void 0===d?parseFloat(Fa(b).getStyle(c)):Fa(b).addStyle(c,d)},b,f?c:void 0,f)}})(d)}})(Ia)}var Ja=function a(b,c,d,e,f,g,h){var i=b.length,j=h,k=c,l=f,m=0,n=null==d;if("object"===function(a){return null==a?String(a):"object"===(void 0===a?"undefined":O(a))||"function"==typeof a?Ga[toString.call(a)]||"object":void 0===a?"undefined":O(a)}(d)){l=!0;for(m in d)d.hasOwnProperty(m)&&a(b,k,m,d[m],!0,g,j)}else if(void 0!==e&&(l=!0,isFunction(e)||(j=!0),n&&(j?(k.call(b,e),k=null):(n=k,k=function(a,b,c){return n.call(Fa(a),c)})),k))for(;m<i;m++)k(b[m],d,j?e:e.call(b[m],m,k(b[m],d)));return l?b:n?k.call(b):i?k(b[0],d):g},Ka=CBHCore.lib.Sweety(Da),La=function(){function a(b,c){var d=c.name,e=c.avatar;P(this,a),this.name=ko.observable(d),this.avatar=ko.observable(e),this.storage=b,this.name.subscribe(this.save.bind(this)),this.avatar.subscribe(this.save.bind(this))}return Q(a,[{key:"save",value:function(){this.storage.saveManager({name:this.name,avatar:this.avatar})}}]),a}(),Ma=function(){function a(b){var c=b.text,d=b.ts,e=void 0===d?Number(new Date):d,f=b.own,g=void 0!==f&&f,h=b.from,i=void 0===h?"":h;P(this,a),this.ts=e,this.own=g||"client"===i,this.text=this.filterText(c),this.day=ko.observable(),this.time=ko.observable(),this.position=ko.observable(),this.prepareTime()}return Q(a,[{key:"filterText",value:function(a){var b=W.stripTags(a);return b=b.replace(/(https?:\/\/(www\.)?[-a-zA-Z0-9@:%._+~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:%_+.~#?&\/\/=]*))/,"<a class='cbh-a' href='$1' rel='noopener' target='_blank'>$1</a>")}},{key:"prepareTime",value:function(){var a=new Date(this.ts),b=a.getHours(),c=a.getMinutes();this.day(W.renderDay(a)),this.time((b<10?"0"+b:b)+":"+(c<10?"0"+c:c))}}]),a}(),Na=function(){var a=function(a){return new t(function(b){var c=b(a);return!1===c&&(CBHCore.opt.dev_mode||Ca.io.emit("history")),c||[]},function(b,c){return c(a,b)})}("cbh-builtin-messages"),b=function(a){var b=J.toUnicode(document.location.hostname);return new t(function(c){var d=c(a)||{};return{name:d.name?d.name:b,avatar:d.avatar?d.avatar:""}},function(b,c){var d={};return CBHCore.helpers.isFunction(b.name)?d.name=b.name():d.name=b.name,CBHCore.helpers.isFunction(b.avatar)?d.avatar=b.avatar():d.avatar=b.avatar,c(a,d)})}("cbh-builtin-manager");return{getHistory:a.get,saveHistory:a.save,getManager:b.get,saveManager:b.save}}(),Oa=function(){function a(b){var c=this;P(this,a),this.messages=ko.observableArray(),this.messageLengthLimit=1e3,this.__=K,this.user=b.user,this.visible=b.visible,this.unreadMessagesCount=b.unreadMessagesCount,this.connected=!1,this.moved=!1,this.fullScreenContainer=ko.observable(null),this.msgContainer=ko.observable(null),this.chatEnded=ko.observable(!1),this.inputFocused=ko.observable(!1),this.autoScrolling=ko.observable(!0),this.manager=new La(Na,Na.getManager()),this.browser=CBHCore.helpers.browser(),this.message=ko.observable(""),this.messages.subscribe(function(a){return Na.saveHistory(a)}),this.inputFocused.subscribe(function(a){a&&setTimeout(function(){c.scrollChatToBottom()},500)}),this.visible.subscribe(function(a){a&&c.unreadMessagesCount(0)}),b.enabled()&&(H.fakeChatMessages?this.setupDevFakeMessages():this.setupIO())}return Q(a,[{key:"setupDevFakeMessages",value:function(){var a=this,b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1500;this.addMessages([{ts:Number(new Date("2017-08-09T12:35:00")),own:!1,text:"Lorem ipsum dolor sit amet"},{ts:Number(new Date("2017-08-09T12:35:00")),own:!0,text:"Lorem ipsum dolor sit amet"},{ts:Number(new Date("2017-08-09T12:37:30")),own:!0,text:"quis rhoncus"},{ts:Number(new Date("2017-08-09T12:37:31")),own:!0,text:"dictumst nec velit turpis"},{ts:Number(new Date("2017-08-10T13:37:32")),own:!1,text:"Euismod"},{ts:Number(new Date("2017-08-10T13:38:30")),own:!0,text:"Sagittis"},{ts:Number(new Date("2017-08-10T15:37:30")),own:!1,text:"Orci nibh at cursus, eget velit blandit sodales odio et turpis"},{ts:Number(new Date("2017-08-10T15:37:30")),own:!1,text:"Vel erat"},{ts:Number(new Date("2017-08-10T15:37:31")),own:!1,text:"Cursus turpis quisque"},{ts:Number(new Date("2017-08-10T15:37:32")),own:!0,text:"Mauris auctor dictumst vel, wisi ligula metus et wisi vivamus, suscipit ornare, volutpat quisque ut vel sit consectetuer, amet at porttitor nec velit varius purus. Nibh turpis platea leo id, id eleifend amet lobortis, id molestie cursus"}]);var c=function(){for(var a=function(a,b){return parseInt(Math.random()*(b-1)+a,10)},b=a(5,100),c=0,d=[];c<b;){var e=function(){return CBHCore.helpers.rand(a(1,15))}();c+=e.length,d.push(e)}return d.join(" ")},d=setInterval(function(){a.messages().length<20?a.onMessageReceived({text:c()}):clearInterval(d)},b)}},{key:"setupIO",value:function(){var a=this;CBHCore.loadFile("js",H.socketIOLib,!0,function(){Ca.connect(function(){a.connected||(a.connected=!0,Ca.io.on("message",function(b){b&&a.onMessageReceived({text:b.text,name:b.name,avatar:b.avatar})}),Ca.io.on("history",function(b){a.addMessages(b,!0),Na.saveHistory(b)}),a.addMessages(Na.getHistory(),!0))})})}},{key:"onScroll",value:function(a,b){b.stopPropagation();var c=b.target;return c!==this.msgContainer()||(c.scrollHeight-(c.scrollTop+Ka(c).outerHeight())<5?this.autoScrolling(!0):this.autoScrolling(!1),!0)}},{key:"autoScrollChatToBottom",value:function(){this.autoScrolling()&&y(this.msgContainer())}},{key:"scrollChatToBottom",value:function(){y(this.msgContainer())}},{key:"onMessageReceived",value:function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},b=a.text,c=void 0===b?"":b,d=a.name,e=void 0===d?"":d,f=a.avatar,g=void 0===f?"":f;c&&this.addMessage({text:c}),e&&this.manager.name(e),g?this.manager.avatar("url("+g+")"):this.manager.avatar(null)}},{key:"addMessages",value:function(a){var b=this,c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];ko.utils.arrayForEach(a,function(a){return b.addMessage(a,c)})}},{key:"addMessage",value:function(a){var b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.messages(x(this.messages().concat(u([new Ma({ts:a.ts,from:a.from,own:a.own,text:a.text})],this.messageLengthLimit)))),this.visible()||b||this.unreadMessagesCount(this.unreadMessagesCount()+1),this.autoScrollChatToBottom()}},{key:"chatLength",value:function(a){var b=Na.getHistory();return CBHCore.helpers.isArray(b)?!0!==a?b.length:b.filter(function(a){return a.own&&!0===a.own}).length:null}},{key:"send",value:function(){var a=this.message().substring(0,this.messageLengthLimit),b=0===this.chatLength(!0);a.length&&(H.fakeChatMessages||Ca.io.emit("message",{text:a}),this.addMessage({text:a,own:!0}),this.message(""),this.inputFocused(!0),this.scrollChatToBottom(),b&&k("Callbackhunter_SEND_BUILTIN","sent"))}},{key:"close",value:function(){this.inputFocused(!1),this.visible(!1)}},{key:"toggleChatEnded",value:function(){this.chatEnded(!this.chatEnded())}},{key:"onKeypress",value:function(a,b){return 13===b.keyCode&&this.send(),!(this.message().length>this.messageLengthLimit)}}]),a}(),Pa=1e3,Qa=function(){function a(b){var c=this;P(this,a),this.__=K,this.user=b.user,this.activeSlide=b.activeSlide,this.sliderOpen=b.sliderOpen,this.channelsVisible=b.channelsVisible,this.activeSubslide=b.activeSubslide,this.dataAgreement=ko.observable(!0),this.emailText=ko.observable(""),this.sendAttempt=ko.observable(!1),this.textOk=ko.computed(function(){return c.emailText().length>0&&c.emailText().length<Pa}),this.emailOk=ko.computed(function(){return c.user.isEmailValid()}),this.initExitPrevention()}return Q(a,[{key:"initExitPrevention",value:function(){var a=this,b=function(b,c){!a.exitTarget&&c&&b&&a.emailText().length>0?setTimeout(function(){a.sliderOpen(!0),a.activeSlide("email"),a.channelsVisible(!1),setTimeout(function(){a.activeSubslide("email_exit"),a.exitTarget=c})}):a.exitTarget=null},c=null;this.exitTarget=null,this.activeSlide.subscribe(function(a){c=a},null,"beforeChange"),this.activeSlide.subscribe(function(){var d=a.activeSlide();a.sendAttempt()||"email"===d||"email"!==c||b(a.sliderOpen(),d),c=d}),this.sliderOpen.subscribe(function(a){"email"===c&&b(a,"close")},null,"beforeChange")}},{key:"show",value:function(){var a=this;this.exitTarget=null,this.channelsVisible(!0),this.activeSlide("email"),setTimeout(function(){return a.activeSubslide("email_main")})}},{key:"close",value:function(){var a=this;if(this.activeSubslide("email_main"),"close"!==this.exitTarget)return this.sliderOpen(!0),void setTimeout(function(){a.activeSlide(a.exitTarget),a.sliderOpen(!0),a.exitTarget=null});this.channelsVisible(!0),
setTimeout(function(){return a.sliderOpen(!1)})}},{key:"send",value:function(){var a=this;if(this.sendAttempt(!0),this.textOk()&&this.emailOk()){k("cbh_desktop_email","sent"),k("Callbackhunter_SEND_EMAIL","sent");var b=this.emailText().trim().substr(0,Pa);this.activeSlide("call"),this.activeSubslide("email_success"),this.sendAttempt(!1),CBHCore.server.send({lang:CBHCore.lang.langCode,question:JSON.stringify({question:b,name:this.user.name(),phone:this.user.phone(),email:this.user.email(),type:"email"})},"/hunter/",function(b){"success"===b.result?a.emailText(""):a.activeSubslide("email_failure")})}}}]),a}(),Ra=function a(b){var c=this;P(this,a),this.count=b.count,this.visible=ko.computed(function(){return c.count()>0}),this.unreadMessagesPresentation=ko.computed(function(){return Math.min(99,c.count())})},Sa=function(){function a(b){var c=this;P(this,a),this.priorityChannel=b.priorityChannel,this.hasCalls=b.hasCalls,this.caught=b.caught,this.hasChats=b.hasChats,this.sliderOpen=b.sliderOpen,this.sliderOpenedByDelay=b.sliderOpenedByDelay,this.changeSliderOpenState=b.changeSliderOpenState,this.activeSlide=b.activeSlide,this.sliderVisible=b.sliderVisible,this.channelsVisible=b.channelsVisible,this.alternativeButton=ko.computed(function(){return c.sliderOpen()&&"callback"!==c.activeSlide()&&c.channelsVisible()}),this.setupLogo(),this.setupAnimation()}return Q(a,[{key:"setupLogo",value:function(){if(this.customBrandLogo=ko.observable(),CBHCore.helpers.brandingEnabled()){var a=CBHCore.brand_logo||N.brand_logo;a&&this.customBrandLogo("url(//"+CBHCore.opt.static_domain+"/uploads/brand_logo/"+a+")")}}},{key:"setupAnimation",value:function(){var a=this;this.rotatingCallIcon=ko.observable(),this.activeRotatingIcons=ko.observable(),this.animatePhoneIcon=ko.observable();var b=["logo"];this.hasChats&&b.unshift("chat"),this.hasCalls&&b.unshift("phone"),this.callbackIcons=ko.observableArray(b),this.rotatingCallIcon(this.callbackIcons()&&this.callbackIcons()[0]),setInterval(function(){a.callbackIcons().length>1&&a.rotatingCallIcon(z(a.callbackIcons(),a.rotatingCallIcon()))},5e3),this.activeRotatingIcons(!1),setInterval(function(){a.activeRotatingIcons(!0),setTimeout(function(){a.activeRotatingIcons(!1)},3e3)},7e3),this.animatePhoneIcon(!1),setInterval(function(){a.animatePhoneIcon(!0),setTimeout(function(){a.animatePhoneIcon(!1)},3e3)},9e3)}},{key:"toggleSlider",value:function(a){var b=this;this.changeSliderOpenState(a),a?setTimeout(function(){return b.sliderVisible(!0)}):(this.caught(!1),this.channelsVisible(!0),this.changeSliderOpenState(!1))}},{key:"closeSlider",value:function(){this.toggleSlider(!1)}},{key:"click",value:function(){var a="Callbackhunter_WIDGET",b="callback",c=!1;ua.supportedPriorityChannel(this.priorityChannel)&&(b="builtin"===this.priorityChannel||"email"===this.priorityChannel?this.priorityChannel:"social"),this.sliderOpen()?(W.savePriorityChannel("callback"),"social"===this.activeSlide()?(this.activeSlide("callback"),a="Callbackhunter_PHONEICON",c=!0):-1===["social","callback"].indexOf(this.activeSlide())?(this.activeSlide("callback"),a="Callbackhunter_PHONEICON",c=!0):(this.channelsVisible(!0),a="Callbackhunter_WIDGET")):(this.activeSlide(b),a="Callbackhunter_PHONEICON",c=!0),this.toggleSlider(c),k(a,"clicked"),this.activeSlide.notifySubscribers()}}]),a}(),Ta=function(){function a(b){var c=this;P(this,a),this.backgroundImage=b.backgroundImage,this.backgroundColor=b.backgroundColor,this.textColor=b.textColor,this.caught=b.caught,this.backgroundImage(null),this.backgroundColor(null),this.hasCarrousel=-1!==H.bgCarrouselHostname.indexOf(window.location.hostname),this.key=ko.computed(function(){return c.caught()?"catcher":"slider"}),this.hasCarrousel?this.setupBgCarrousel():this.setupBackground()}return Q(a,[{key:"setupBackground",value:function(){var a=this,b=this.key();if(void 0!==N[b+"_bg_choice"]){switch(N[b+"_bg_choice"]){case"preset":this.setBg(this.backgroundImage,N[b+"_bg_preset"],!0);break;case"file":this.setBg(this.backgroundImage,N[b+"_bg_image"],!1);break;case"color":this.backgroundColor("#"+N[b+"_bg_color_code"])}this.caught.subscribe(function(){a.setupBackground()})}}},{key:"getPresetName",value:function(a){return a+"_"+((arguments.length>1&&void 0!==arguments[1]?arguments[1]:0)+1)+".png"}},{key:"getImageURL",value:function(a,b){var c="//"+CBHCore.opt.static_domain+"/uploads/slide_image";return b&&(c+="/preset"),c+="/"+a}},{key:"setBg",value:function(a,b,c){a("url("+this.getImageURL(b,c)+")")}},{key:"nextCarrousel",value:function(){var a=this,b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,c=this.key();8===b?this.textColor("#000000"):this.textColor(this.originalTextColor),this.presetCounter(b);var d=void 0,e=void 0;this.oddCounter()?(d=this.backgroundImageNext,e=this.backgroundImage):(d=this.backgroundImage,e=this.backgroundImageNext),this.setBg(d,this.getPresetName(c,b),!0);var f=(b+1)%H.bgCarrouselCount,g=this.getPresetName(c,f);(new Image).src=this.getImageURL(g,!0),this.setBgTimeoutId=setTimeout(function(){return a.setBg(e,g,!0)},H.bgCarrouselInterval+500),this.nextCarrouselTimeoutId=setTimeout(function(){return a.nextCarrousel(f)},H.bgCarrouselInterval)}},{key:"setupBgCarrousel",value:function(){var a=this;this.backgroundImageNext=ko.observable(),this.originalTextColor=this.textColor(),this.presetCounter=ko.observable(),this.oddCounter=ko.computed(function(){return Boolean(a.presetCounter()%2)}),this.fallback=!W.areClipPathShapesSupported(),this.caught.subscribe(function(){window.clearTimeout(a.nextCarrouselTimeoutId),window.clearTimeout(a.setBgTimeoutId),a.nextCarrousel()}),this.caught.notifySubscribers()}}]),a}(),Ua=function(a,b){function c(a){return CBHCore.helpers.isFunction(b[a])?'<script type="text/html" id="'+a+'">'+b[a]()+"<\/script>":null}var d=["social","enter_phone","sms_phone","sms_message","sms_success","sms_failure","email_success","email_failure","call_disabled","call_now","call_later","select_office","call_result","call_failure","call_rating","call_later_success","call_free_success","call_timer","catch"];ko.components.register("slider",{viewModel:xa(a,b),template:b.slider__index({templates:function(a,b){return ko.utils.arrayMap(b,function(b){var d=c("widget_"+b);return d||c(a+"_"+b)}).join("")}("slider",d)})}),ko.components.register("powered-by",{viewModel:ya,template:b["powered-by"]()}),ko.components.register("checkbox",{viewModel:Aa,template:b.checkbox()}),ko.components.register("builtin",{viewModel:Oa,template:b.builtin()}),ko.components.register("email",{viewModel:Qa,template:b.email()}),ko.components.register("channels",{viewModel:Ba,template:b.channels()}),ko.components.register("unread-messages-counter",{viewModel:Ra,template:b["unread-messages-counter"]()}),ko.components.register("main-button",{viewModel:Sa,template:b["main-button"]()}),ko.components.register("select",{viewModel:Z,template:b.select()}),ko.components.register("rating",{viewModel:$,template:b.rating()}),ko.components.register("background",{viewModel:Ta,template:b.background()})},Va="auto",Wa="auto",Xa="25px",Ya="25px",Za=625,$a=function(){function a(b){function c(){return-1!==["builtin","email"].indexOf(h())}var d=this,e=b.mainButtonRef,f=b.builtinRef,g=b.buttonSize,h=b.activeSlide,i=b.hasCalls,j=b.commList,k=b.caught,l=b.channelsVisible,m=b.sliderOpen,n=b.activeSubslide;P(this,a),this.mainButtonRef=e,this.builtinRef=f,this.caught=k,this.commList=j,this.sliderOpen=m,this.channelsVisible=l,this.activeSubslide=n,this.hasCalls=i,this.right=ko.observable(),this.left=ko.observable(),this.bottom=ko.observable(),this.top=ko.observable(),this.builtinHeight=ko.observable(),this.btnSize=ko.observable(g),this.calcSizes(),this.quadrant=ko.observable(),k()?(this.right(null),this.left(null),this.bottom(null),this.top(null)):(this.right(Xa),this.left(Va),this.bottom(Ya),this.top(Wa)),this.builtinHeight(Za),this.sliderTop=ko.computed(function(){return k()?null:c()?A(d.btnSize()+8,d.top):A(d.btnSize()+24,d.top)}),this.sliderBottom=ko.computed(function(){return k()?null:c()?A(d.btnSize()+9,d.bottom):A(d.btnSize()+12,d.bottom)}),this.sliderRight=ko.computed(function(){return k()?null:c()?A(-13,d.right):A(d.sliderOpen()?31:4,d.right)}),this.sliderLeft=ko.computed(function(){return k()?null:c()?A(-16,d.left):A(d.sliderOpen()?33:0,d.left)}),this.calcSizes(),ko.utils.registerEventHandler(window,"resize",W.debounce(function(){d.reposition()},50))}return Q(a,[{key:"calcSizes",value:function(){var a=this,b=ko.computed(function(){return a.btnSize()/64});this.newMessagesSize=ko.computed(function(){return Math.ceil(21*b())}),this.newMessagesPosition=ko.computed(function(){return Math.ceil(3*b())}),this.newMessagesFontSize=ko.computed(function(){return.75*b()}),this.smallBtnSize=ko.computed(function(){return Math.ceil(46*b())}),this.smallBtnMarginRight=ko.computed(function(){return Math.ceil(7*b())}),this.smallBtnLastMarginRight=ko.computed(function(){return Math.ceil(9*b())}),this.smallBtnMarginTop=ko.computed(function(){return(a.btnSize()-a.smallBtnSize())/2}),this.iconFontSize=ko.computed(function(){return Math.ceil(16*b())}),this.mainButtonCloseOverlap=ko.computed(function(){return a.hasCalls?Math.ceil(8*b()):0}),this.sliderWidth=ko.computed(function(){return a.sliderOpen()&&a.channelsVisible()?a.commList.length*(a.smallBtnSize()+a.smallBtnMarginRight()+a.smallBtnLastMarginRight())+2*a.btnSize():a.sliderOpen()&&-1!==["enter_phone","select_office","call_timer","call_later","call_later_success","call_free_success","call_result","call_rating","call_failure","sms_message","sms_failure","sms_success","email_exit","email_failure","email_success"].indexOf(a.activeSubslide())?2*a.btnSize():a.btnSize()})}},{key:"reposition",value:function(){this.setViewportsize();var a=this.getButtonSize(),b=a.width,c=a.height;this.btnSize(b);var d=!1,e=!1;if(this.caught())this.right(null),this.left("calc(50% + "+((550-this.sliderWidth())/2-3)+"px)"),this.bottom(null),this.top(null);else{var f=void 0,g=void 0,h=void 0,i=void 0,j=void 0;void 0!==N.phoneicon_x&&0<=N.phoneicon_x&&N.phoneicon_x<=100&&(j=CBHCore.helpers.clamp(N.phoneicon_x,0,100),j<50?(e=!0,f=(this.viewportSize.width-b)*(j/100)+"px",g="auto"):(e=!1,f="auto",g=(this.viewportSize.width-b)*(1-j/100)+"px")),void 0!==N.phoneicon_y&&(j=CBHCore.helpers.clamp(N.phoneicon_y,0,100),j<50?(d=!0,i=(this.viewportSize.height-c)*(j/100)+"px",h="auto"):(d=!1,i="auto",h=(this.viewportSize.height-c)*(1-j/100)+"px")),this.right(g),this.left(f),this.bottom(h),this.top(i)}this.setQuadrant(d,e),this.setBuiltinHeight(d)}},{key:"getButtonSize",value:function(){var a=void 0,b=void 0;if(this.mainButtonRef()&&CBHCore.helpers.isFunction(window.getComputedStyle)){var c=window.getComputedStyle(this.mainButtonRef());a=parseInt(c.getPropertyValue("width"),10),b=parseInt(c.getPropertyValue("height"),10)}return(!a||isNaN(a)||a<0)&&(a=64),(!b||isNaN(b)||b<0)&&(b=64),{width:a,height:b}}},{key:"setViewportsize",value:function(){this.viewportSize=CBHCore.helpers.viewportSize()}},{key:"setQuadrant",value:function(a,b){a&&b?this.quadrant("tl"):a&&!b?this.quadrant("tr"):!a&&b?this.quadrant("bl"):this.quadrant("br")}},{key:"setBuiltinHeight",value:function(a){if(this.builtinRef()&&CBHCore.helpers.isFunction(this.builtinRef().getBoundingClientRect)){var b=this.builtinRef().getBoundingClientRect(),c=a?this.viewportSize.height-b.top:b.bottom;0===c&&(c=Za),this.builtinHeight(CBHCore.helpers.clamp(c,250,Za)+"px")}}}]),a}(),_a=function(){function a(b){var c=this;P(this,a),this.__=K,this.tpl=b,this.showReason=ko.observable(1),this.worktime=ko.observable(CBHCore.isWorkTime()),this.freeMode=ko.observable(CBHCore.helpers.freeMode()),this.hasSms=ko.observable(CBHCore.helpers.hasSms()),this.user=new Y(this.freeMode()),this.countdown=parseInt(N.time_connection,10),this.sliderCallOpenDelay=this.getSliderCallOpenDelay(),this.sliderOpenedByDelay=ko.observable(null),this.activeSlide=ko.observable("callback"),this.activeSubslide=ko.observable(),this.activeSocial=ko.observable(),this.sliderOpen=ko.observable(!1),this.caught=ko.observable(!1),this.slideVisibleComputed=[],this.slideInvisibleComputed=[],this.hidePill=void 0===N.phone_icon||0===N.phone_icon||CBHCore.hidePill,this.caught.subscribe(function(){(c.hasCalls||c.hasChats)&&(c.caught()?(W.aC(document.body,"cbh-no-scroll"),setTimeout(function(){return c.catchVisible(!0)}),c.changeSliderOpenState(!0)):W.rC(document.body,"cbh-no-scroll"))}),this.setup(),this.sliderOpen.subscribe(function(a){a&&l()}),Ua(this,b)}return Q(a,[{key:"getSliderCallOpenDelay",value:function(){var a=H.knownPhoneSliderShowDelay/1e3,b=parseInt(N.slider_call_open_delay,10);return isNaN(b)?a:b}},{key:"changeSliderOpenState",value:function(a){var b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];void 0!==b?this.sliderOpenedByDelay(b):a&&this.sliderOpenedByDelay(!1),this.sliderOpen(a)}},{key:"computeIsMainButtonsPlankVisible",value:function(){return!(!this.hasCalls&&!this.hasChats)&&(!(void 0!==this.positioningFinished&&!this.positioningFinished())&&(!this.hidePill||!!this.sliderOpen()))}},{key:"slideVisible",value:function(a){var b=this;return this.slideVisibleComputed[a]||(this.slideVisibleComputed[a]=ko.computed(function(){return b.sliderOpen()&&b.activeSlide()===a})),this.slideVisibleComputed[a]}},{key:"slideInvisible",value:function(a){var b=this;return this.slideInvisibleComputed[a]||(this.slideInvisibleComputed[a]=ko.computed(function(){return!b.sliderOpen()||b.activeSlide()!==a})),this.slideInvisibleComputed[a]}},{key:"setup",value:function(){this.setupColors(),this.setupBranding(),this.setupChats(),this.setupPositioning(),this.setupOffices(),this.setupTime(),this.setUpInitialSliderOpenState(),this.setupMisc()}},{key:"setupBranding",value:function(){this.sliderBackgroundImage=ko.observable()}},{key:"setupPositioning",value:function(){var a=this;this.positioningFinished=ko.observable(!1),this.sliderVisible=ko.observable(!1),this.catchVisible=ko.observable(!1),this.mainButtonRef=ko.observable(),this.builtinRef=ko.observable(),this.right=ko.observable(),this.bottom=ko.observable(),this.isFixedButton=ko.observable(Boolean(N.is_fixed_button));var b=void 0;N.button_size&&(b=parseInt(N.button_size,10));var c=new $a({mainButtonRef:this.mainButtonRef,builtinRef:this.builtinRef,buttonSize:b,activeSlide:this.activeSlide,commList:this.commList,hasCalls:this.hasCalls,caught:this.caught,sliderOpen:this.sliderOpen,channelsVisible:this.channelsVisible,activeSubslide:this.activeSubslide});this.quadrant=c.quadrant,this.right=c.right,this.left=c.left,this.bottom=c.bottom,this.top=c.top,this.sliderTop=c.sliderTop,this.sliderBottom=c.sliderBottom,this.sliderRight=c.sliderRight,this.sliderLeft=c.sliderLeft,this.builtinHeight=c.builtinHeight,this.btnSize=c.btnSize;var d=c.newMessagesSize(),e=c.newMessagesPosition(),f=c.newMessagesFontSize(),g=c.smallBtnSize(),h=c.smallBtnMarginRight(),i=c.smallBtnLastMarginRight(),j=c.smallBtnMarginTop(),k=c.iconFontSize(),l=c.mainButtonCloseOverlap();this.sliderWidth=c.sliderWidth,this.mainButtonRef.subscribe(function(){return c.reposition()}),this.activeSlide.subscribe(function(){"builtin"!==a.activeSlide()&&"email"!==a.activeSlide()||setTimeout(function(){return c.reposition()},250)}),this.caught.subscribe(function(){!a.caught()||"builtin"!==a.activeSlide()&&"email"!==a.activeSlide()||a.caught(!1),window.requestAnimationFrame(function(){return c.reposition()})}),this.activeSubslide.subscribe(function(){window.requestAnimationFrame(function(){return c.reposition()})}),this.addCSSRules([".main-button"],"width: "+this.btnSize()+"px; height: "+this.btnSize()+"px;"),this.addCSSRules([".main-button.slider-open",".buttons .channels"],"left: auto; right: -"+l+"px;"),this.addCSSRules([".left-side .main-button.slider-open"],"left: -"+l+"px;"),this.addCSSRules([".left-side.buttons .channels"],"right: auto; left: -"+h+"px;"),this.addCSSRules([".buttons .channels ul",".main-button",".main-button i"],"font-size: "+k+"px;"),this.addCSSRules([".buttons .channels ul li"],"\n      width: "+g+"px; \n      height: "+g+"px; \n      margin-right: "+h+"px;\n    "),this.addCSSRules([".buttons .channels ul li:last-child"],"\n      margin-right: "+i+"px;\n    "),this.addCSSRules([".buttons.left-side .channels ul li"],"\n      margin-left: "+h+"px;\n    "),this.addCSSRules([".buttons .channels ul"],"\n      margin: "+j+"px 0;\n    "),this.addCSSRules([".buttons"],"height: "+(this.btnSize()+2)+"px; line-height: "+(this.btnSize()+2)+"px;"),this.addCSSRules([".buttons .channels ul li .cbh-new-messages.cbh-visible, .main-button .cbh-new-messages"],"\n      width: "+d+"px; \n      height: "+d+"px; \n      line-height: "+d+"px;\n      font-size: "+f+"em;\n    "),this.addCSSRules([".buttons .channels ul li .cbh-new-messages.cbh-visible"],"\n      top: -"+e+"px;\n      right: -"+e+"px;\n    "),W.bodyHasHorizontalScroll()||this.isFixedButton()||W.aC(document.body,"cbh-no-horizontal-scroll"),setTimeout(function(){return a.positioningFinished(!0)},500)}},{key:"setUpInitialSliderOpenState",value:function(){var a=this;this.isSliderAllowed=ko.computed(function(){return a.caught()||a.hasCalls||a.isChannelEnabled("sms")||a.isChannelEnabled("email")||a.isChannelEnabled("builtin")||ua.supportedPriorityChannel(a.priorityChannel)}),this.user.phone()&&this.user.isPhoneValid()&&this.isSliderAllowed()&&setTimeout(function(){a.changeSliderOpenState(!0,!0),setTimeout(function(){return a.sliderVisible(!0)})},1e3*this.sliderCallOpenDelay)}},{key:"setupMisc",value:function(){this.showDataCollectionText=ko.computed(function(){return"ru"!==CBHCore.lang.langCode?"":K("data_collection.tpl",{link:CBHCore.helpers.getDataCollectionUrl(K("data_collection.default_link"))})})}},{key:"setupChats",value:function(){var a=this;this.unreadMessagesCount=ko.observable(0);var b=new ua(this);this.priorityChannel=b.priorityChannel,this.commList=b.commList,this.hasChats=b.hasChats,this.hasCalls=b.hasCalls,this.builtinChatEnabled=b.builtinChatEnabled,this.deeplinks=b.deeplinks,this.deeplinks=b.deeplinks,this.isChannelEnabled=b.isChannelEnabled.bind(b),this.channelsVisible=ko.observable(!0),ua.supportedPriorityChannel(this.priorityChannel)&&"builtin"!==this.priorityChannel&&"email"!==this.priorityChannel&&this.activeSlide("social"),this.isMainButtonsPlankVisible=ko.computed(function(){return a.computeIsMainButtonsPlankVisible()})}},{key:"setupOffices",value:function(){var a=this;this.officeList=ko.observableArray([]),this.officeSelectionList=ko.computed(function(){return ko.utils.arrayMap(a.officeList(),function(a){return{text:a.name,value:a.id}})}),this.selectedOffice=ko.observable(null),this.officeSelectionTitle=ko.observable(K("select_office")),this.selectedOffice.subscribe(function(b){if(N.show_office_choice){var c=CBHCore.helpers.getOfficeList(b?b.value:null);c.length>0&&a.selectedOffice()?c[0].promt&&a.officeSelectionTitle(c[0].promt):c.length&&a.officeList(c)}}),this.selectedOffice(0)}},{key:"setupTime",value:function(){var a=this,b=W.generateDaySelects();this.availableDays=ko.observableArray(b.data),this.selectedDay=ko.observable(null),this.selectedDay.subscribe(function(b){if(b){var c=W.generateHourSelects(b&&b.value||b);a.availableHours(c.data);var d=c.data.find(function(b){return a.selectedHour()&&b&&a.selectedHour().text===b.text});a.selectedHour(d||{value:c.firstVal,text:c.firstName})}}),this.selectedHour=ko.observable(null),this.selectedHourValue=ko.computed(function(){return a.selectedHour()&&a.selectedHour().value}),this.availableHours=ko.observableArray([]),this.selectedDay({value:b.firstVal,text:b.firstName,shortText:b.firstShort})}},{key:"setupColors",value:function(){this.sliderBackgroundColor=ko.observable(),this.customCSSRules=[],H.disableCustomColors||(N.catcher_icon_color_code&&this.setupCustomColor("catch","#"+N.catcher_icon_color_code),N.phone_icon_color_code&&(this.setupCustomColor("slider","#"+N.phone_icon_color_code),this.setupCustomColor("email-container","#"+N.phone_icon_color_code)),N.catcher_icons_color&&this.setupIconsColor("catch","#"+N.catcher_icons_color),N.slider_icons_color&&this.setupIconsColor("slider","#"+N.slider_icons_color))}},{key:"setupIconsColor",value:function(a,b){b&&(this.addCSSRules([".channels ul li:after"],"\n      color: "+b+";\n    ","."+a),this.addCSSRules(["button"],"\n      color: "+b+";\n    ","."+a),"slider"===a&&(this.addCSSRules([".main-button i:after"],"\n        color: "+b+";\n      "),a="buttons"),this.addCSSRules([".main-button.slider-open:after",".main-button.close:after"],"\n      color: "+b+";\n    ","."+a),this.addCSSRules([".channels ul li:after"],"\n      color: "+b+";\n    ","."+a))}},{key:"setupCustomColor",value:function(a,b){var c=W.getColorBrightness(b),d=void 0;d=c>60?W.shadeColor(b,-.2):W.shadeColor(b,.2);var e=W.shadeColor(b,-.2);this.addCSSRules(["button"],"background-color: "+b+";","."+a),this.addCSSRules(["button:not(.empty):not(.pick-time):not(.call-now):not([disabled]):hover"],"background-color: "+d+";","."+a),this.addCSSRules(["ul.rating:hover li:after"],"color: "+b+";","."+a),this.addCSSRules(["button"],"border-color: "+b+";","."+a),this.addCSSRules(["button"],"box-shadow: inset 0px -2px 3px 1px "+e+";","."+a),this.addCSSRules(["button:disabled"],"border: solid 1px "+e+";","."+a);var f=".buttons";"slider"===a?(CBHCore.helpers.addCSSRules([".cbh-button.cbh-only-button .cbh-ph-circle"],"border-color: "+b+" !important;"),CBHCore.helpers.addCSSRules([".cbh-button.cbh-only-button .cbh-ph-circle-fill"],"background-color: "+b+" !important;")):f=".catch.buttons",this.addCSSRules([".main-button",".channels ul li"],"\n      background-color: "+b+" !important;\n    ",f),this.addCSSRules([".main-button i.custom",".main-button.slider-open.custom-logo"],"\n      border-color: "+b+" !important;\n    ",f)}},{key:"addCSSRules",value:function(a,b){var c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";if(b&&CBHCore.helpers.isString(b)&&CBHCore.helpers.isArray(a)){var d=a.map(function(a){return c+" "+a});return this.addCSSRules(function(a,b){return W.reduce(a,function(a,c){return a[c]=b,a},{})}(d,b))}for(var e in a)a.hasOwnProperty(e)&&this.customCSSRules.push({selector:e,rule:a[e]})}},{key:"isInnerChannelVisible",value:function(){return this.slideVisible("builtin")||this.slideVisible("email")||this.slideVisible("sms")}},{key:"closeCatchDialog",value:function(){this.caught(!1),this.sliderVisible()||this.changeSliderOpenState(!1),k("Callbackhunter_WIDGET","clicked")}}]),a}(),ab=function(){function a(b,c,d){P(this,a),this.tpl=b,this.viewmodel=c,this.activityFlags=d}return Q(a,[{key:"createIframe",value:function(a,b,c,d){var e=this,f=document.createElement("iframe");f.id=a,f.setAttribute("frameborder",0),f.setAttribute("sandbox",["allow-same-origin","allow-scripts","allow-top-navigation","allow-popups-to-escape-sandbox","allow-popups"].join(" ")),d.appendChild(f),f.contentWindow.document.open(),f.contentWindow.document.write('\n      <head><link type="text/css" href="'+c+'" rel="stylesheet"></head>\n    ');var g=f.contentWindow.document.createElement("style");f.contentWindow.document.head.appendChild(g),this.viewmodel.customCSSRules.forEach(function(a){var b=a.selector,c=a.rule;B(g.sheet,b,c)}),setTimeout(function(){f.contentWindow.document.write("\n        <body>"+b+"</body>\n      "),f.contentWindow.document.close(),ko.applyBindings(e.viewmodel,f.contentWindow.document.body)},50)}},{key:"draw",value:function(){var a=document.createElement("div");a.innerHTML=this.tpl.main(),ko.applyBindings(this.viewmodel,a);var b=document.createElement("div");b.id="cbh";var c=a.childNodes[0];b.appendChild(c);var d=a.childNodes[0];b.appendChild(d);var e=a.childNodes[0];b.appendChild(e),document.body.appendChild(b);var f=void 0===CBHCore.opt.use_minimized_css||!0===CBHCore.opt.use_minimized_css;this.createIframe("cbh_slider_container",this.tpl.slider(),f?"//"+CBHCore.opt.static_domain+"/widgets/v9/slider.min.css":"//"+CBHCore.opt.static_domain+"/widgets/v9/slider.css",d),this.createIframe("cbh_button_container",this.tpl.button(),f?"//"+CBHCore.opt.static_domain+"/widgets/v9/slider.min.css":"//"+CBHCore.opt.static_domain+"/widgets/v9/slider.css",e)}},{key:"showExit",value:function(a){var b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(CBHCore.logger.debug("showExit attempt"),this.activityFlags.blockAutoPopup&&!b)return CBHCore.logger.debug({"showExit prevented":this.activityFlags}),null;a||k("cbh_desktop_catch","exit"),this.viewmodel.showReason(3),this.doCatch()}},{key:"showEnter",value:function(){var a=arguments.length>0&&void 0!==arguments[0]&&arguments[0],b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(CBHCore.logger.debug("showEnter attempt"),this.activityFlags.blockAutoPopup&&!b)return CBHCore.logger.debug({"showEnter prevented":this.activityFlags}),null;a||k("cbh_desktop_catch","enter"),this.viewmodel.showReason(2),this.doCatch()}},{key:"showDialog",value:function(a){if(CBHCore.logger.debug("showDialog attempt"),!a&&this.activityFlags.blockAutoPopup)return CBHCore.logger.debug({"showDialog prevented":this.activityFlags}),null;this.viewmodel.showReason(2),this.doCatch()}},{key:"startCallback",value:function(){this.showDialog(!0),this.viewmodel.user.isPhoneValid(!0)&&this.viewmodel.activeSlide("call-now")}},{key:"sliderCatchAllowed",value:function(){return Boolean(this.viewmodel.user.phone())}},{key:"doCatch",value:function(){var a=this;if("popup"===N.catch_method)this.viewmodel.caught(!0);else{if(!this.sliderCatchAllowed())return;this.viewmodel.changeSliderOpenState(!0),setTimeout(function(){return a.viewmodel.sliderVisible(!0)})}n()}}]),a}(),bb=CBHCore.Masked,cb=function(){function a(){return void 0!==N.enable_masks&&1===parseInt(N.enable_masks,10)}ko.bindingHandlers.masked={init:function(b,c){var d=c(),e=void 0;if(e=CBHCore.helpers.isFunction(d)?d:d.phone,!a())return void ko.utils.registerEventHandler(b,"keyup",function(){e(this.value)});var f=!1,g=!1;CBHCore.helpers.empty(N.fixed_country)||(g=N.fixed_country,!CBHCore.helpers.empty(N.country_call_binding)&&N.fixed_country&&(f=N.country_call_binding));var h=new bb({initial_focus:!1,selector:b,show_validation_errors:!0,one_country:g,country_binding:f,country:CBHCore.db_params.iso_code,phone:e(),onValueChanged:function(a){return e(a)},onSend:d.onSend||function(){},onToggleList:d.onToggleList||function(){},onHideList:function(){return bb.getInst(b).focused()},i18n:{ru:{errors:{phone_is_empty:K("phone_error"),phone_not_exists:K("phone_error")}}}});b.maskInitInProcess=!0,void 0===ko.bindingHandlers.masked.masks&&(ko.bindingHandlers.masked.masks=[]),ko.bindingHandlers.masked.masks.push(h)},update:function(b,c){var d=c(),e=void 0;if(e=CBHCore.helpers.isFunction(d)?ko.utils.unwrapObservable(d):ko.utils.unwrapObservable(d.phone),isNaN(e)&&(e=""),!a())return void(b.value=e);for(var f=0;f<ko.bindingHandlers.masked.masks.length;f++){ko.bindingHandlers.masked.masks[f].setPhone(e)}}},ko.bindingHandlers.countdown={init:function(a,b){ba({element:a,valueAccessor:b})}},ko.bindingHandlers.ref={update:function(a,b){b()(a)}}},db=function(){E();var a=new _a(M),b=new ab(M,a,pa);return cb(),C(a,b),b},eb=null;return{init:function(){eb=db()},showSimpleDialog:function(a){eb&&eb.showDialog(a)},showWidgetEnter:CBHCore.tryExternalCallback("showWidgetEnter",function(a){eb&&eb.showEnter(!1,a)}),showWidgetExit:CBHCore.tryExternalCallback("showWidgetExit",function(a){eb&&eb.showExit(!1,a)})}}(0,this.document);